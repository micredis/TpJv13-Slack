Grigory Kislin [2:26 AM]
joined #hw2.

Grigory Kislin [2:28 AM]
Добро пожаловать на 2й (достаточно сложный) урок, где мы будем делать архитектурные слои нашего приложения:
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md (edited)

Pavel Zaitcev [2:38 AM]
joined #hw2 along with 18 others.

realcorwin [10:39 AM]
ссылка на 5. Обзор Spring Framework. Spring Context. не работает
"Sorry, the file you have requested does not exist."

pro [1:56 PM]
патч 2 0 add fix принялся?

Aleksey Vra [2:03 PM]
кто нибудь уже приступил к выполнению?)
посмотрел все видео, вопрос к патчу 2 5 dependency injection.
получили контекст, далее получаем bean:
```UserService userService = appCtx.getBean(UserService.class);
userService.create(new User(null, "userName", "email", "password", Role.ROLE_ADMIN));```
в spring-app.xml указываем бин mockUserRepository и UserServiceImpl(с инжектом mockUser)
Правильно ли я понял, что спринг сам автоматом каким то образом userService присваивает новый объект UserServiceImpl, только потому что в контексте единственный бин унаследованный от этого интерфейса?
И аннотаций никаких нет, а интерфейс уже сам связался с бином. И получается, что если бы у нас допустим был еще 1 бин унаследованный от UserService, то
```UserService userService = appCtx.getBean(UserService.class);```
уже автоматом не свяжется и выдаст ошибку? (edited)
до 5 патча пока все норм принялось
пытюсь пока на 5 патче эксперементировать, код поизменял, как бы потом 2 и 6 патч не встал

pro [2:05 PM]
у меня 108 строка конфликтует MealsUtil, показывает ее одинаковой в обоих случаях, только табуляция на один спейс смещена

Aleksey Vra [2:06 PM]
там public на private поменялся

Dmitry Neustupov [2:25 PM]
@Aleksey Vra выдаст ошибку, при нескольких имплементациях можно использовать аннотацию @Qualifier
@Aleksey Vra для точного определения, какой из бинов инжектить

Aleksey Vra [2:28 PM]
меня просто вот эта строчка смущает
```UserService userService = appCtx.getBean(UserService.class);```
допустим  унас много интерфейсов и бинов, лезть в хмл и смотреть кто инжектиться? легко запутаться (edited)

aleksey [9 hours ago]
Там есть перегруженный метод с указанием имени,
Service service = context.getBean(Service.class, "myService");
или можно выставит primary у нужной имплементации (edited)


Aleksey Vra [9 hours ago]
точно, спасибо
глянул доки, только аргументы наоборот


aleksey [7 hours ago]
Я строчку вроде с доков копировал, странно :relaxed:


Aleksey Vra [2:36 PM]
действительно эксепшн вылетает

roma [2:59 PM]
Народ тут пытался создать похожий на  наш проект через архитипы мавена. И убил часа полтора так как не мог получить параметры на .jsp через ${meals} в итоге выяснилось что в web.xml было просто
```<web-app>...</web-app>```
а не как у нас
```<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
  http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
  version="3.1">...</web-app>```
Кто подскажет что это за Шемы и почему без них не работал  ${meals} ?

pro [3:02 PM]
@roma в каком теге ты пытался вывести ${meals} ?

roma [3:03 PM]
td
ну точнее как у нас
```   <c:forEach items="${meals}" var="meals">
        <tr class="${meals.isExceed()}">.....```
```<td>${meals.getCalories()}</td>```
в итоге заполнялась только одна строка со значениями в ячейках типо ${meals.getCalories()}
@pro объяснишь?

pro [3:22 PM]
пространство имен прописываешь в корневом теге
там просто версия спецификации

pro [4:09 PM]
можешь представить себе, что твой web-app - это книга; а спецификация - это год в котором она была написана; пускай язык будет английский; если книга написана на английском 14 века, а ты пытаешься парсить ее в 21, у тебя могут возникнуть проблемы с миграцией понятий: одно и то же слово в 14 и 21 веке может иметь разное значение. Если ты не указываешь версию спецификации, твой парсер не знает, в рамках каких правил он должен интерпретировать то, что вложено в корневой тег, и может сделать это не так как ты ожидаешь от него (edited)

roma [4:39 PM]
спасибо за доступное объяснение ) стало яснее )

pro [7 hours ago]
http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html


pro [7 hours ago]
https://www.w3schools.com/xml/schema_schema.asp
w3schools.com
XML schema Element
Well organized and easy to understand Web building tutorials with lots of examples of how to use HTML, CSS, JavaScript, SQL, PHP, and XML.


Grigory Kislin [5:39 PM]
> ссылка на 5. Обзор Spring Framework. Spring Context. не работает
спасибо, поправил
> 2 0 add fix принялся
см. https://github.com/JavaOPs/topjava/wiki/git#patch-%D0%BD%D0%B5-%D0%BD%D0%B0%D0%BA%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B5%D0%B4%D0%BB%D0%B0%D0%B3%D0%B0%D0%B5%D1%82-merge

Grigory Kislin [5:42 PM]
> Правильно ли я понял, что спринг сам автоматом каким то образом userService присваивает новый объект UserServiceImpl, только по тотому что в контексте единственный бин унаследованный от этого интерфейса?
Spring не "каким-то образом", а смотрит что у него в контексте есть (обычные мапы). Пересмотрите видео, если это непонятно. Далее берет оттуда имплементацию UserService. Тк она одна конфликта нет

Aleksey Vra [6 hours ago]
спасибо, разобрался, когда еще 1 реализацию UserService написал и попробовал несколько вариантов получения бина


roma [7:12 PM]
Вот эта строка меня  немного убивает:
```return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);```
в части
```(id, oldMeal) -> meal)```
из документации вроде понимаю BiFunction - но как оно работает не понимаю... Полагаю что
```if ((oldValue = get(key)) != null) {
            V newValue = remappingFunction.apply(key, oldValue);```
тут у нас newValue станет meal (так как в нашей функции на выходе у нас -> meal) и потом мы кладем в нашу мапу это новое значение
```if (newValue != null) {
                put(key, newValue);
                return newValue; //еще и возвращает этот new валью зараза```

Aleksey Vra [4 hours ago]
```(key, val) -> meal```
так key - это просто ключ мапы куда положим новое значение


roma [4 hours ago]
вроде разобрался - спасибо - функциональное программирование тяжко дается


roma [9:23 AM]
Всем доброе утро

roma [9:24 AM]
```switch (action == null ? "all" : action) ```
all и соответствующую секцию case добавляем для удобочитаемости кода?

Aleksey Vra [14 hours ago]
привет.
ну вот у меня внешний if был с проверкой на null и выводом списка,  а тут проверка в том же свитче, гораздо проще


roma [13 hours ago]
@Aleksey Vra Это я понимаю прото all мы могли бы и не прикреплять - всеравно он проскакивает в дефулт потом - я только про это )


Aleksey Vra [13 hours ago]
у меня action мог быть null, поэтому проверка нужна в любом случае


roma [13 hours ago]
```switch (action)```
и без проверки бы улетала в секцию default - PS у нас она тоже равна null когда мы с index.html переходим (edited)


Aleksey Vra [12 hours ago]
если action==null вылетит NullPointException


roma [6 hours ago]
Точняк ) нельзя использовать null в свитч кейсе - спасибо


Vladimir [10:01 AM]
Добрый день у кого нибудь были проблемы с патчeм 2_1_HW_1?
Скинте пожалуйста весь класс MealsUtil.

Vladimir [10:40 AM]
Спасибо уже не надо

Yevhen Maksymovych [12:45 PM]
ребят, я чего-то пропустил в видео? зачем мы так делаем?
```        // treat case: update, but absent in storage
        return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);```

Yevhen Maksymovych [12:45 PM]
почему не просто map.put()?

Aleksey Vra [11 hours ago]
тоже обратил внимание.. 
может для удобства, ведь put возвращает oldValue
а compute newValue.. а мы сразу получили и вернули


Yevhen Maksymovych [11 hours ago]
да, но у нас перед этим код
```if (meal.isNew()) {
            meal.setId(counter.incrementAndGet());
            repository.put(meal.getId(), meal);
            return meal;
        }```


Yevhen Maksymovych [11 hours ago]
почему не сделать так?
```        if (meal.isNew()) {
            meal.setId(counter.incrementAndGet());
        }
        repository.put(meal.getId(), meal);
        return meal;```


Alexander Sinayko [11 hours ago]
Ну лично я думаю, что нам самим надо ответить на данный вопрос. Гуглим метод, что дает, какие +. Ребят, Григорий покажет нам кунг-фу, но махать кулаками за нас никто не будет! Не ленимся и вникаем.



Dennis [11 hours ago]
Григорий не зря делает ремарки:
>Поправил InMemoryMealRepositoryImpl.save(). Если обновляется еда, которой нет в хранилище (c несуществующим id), вставка не >происходит.
(edited)



Yevhen Maksymovych [11 hours ago]
во, спасибо!


Yevhen Maksymovych [11 hours ago]
смотрю в книгу, вижу фигу :slightly_smiling_face:


Alexander Sinayko [11 hours ago]
Внимательность важная черта для разработчика!



Aleksey Vra [11 hours ago]
а в каких случаех будет обновляться еда, которой нет в хранилище? редактируем еду, которая отображается, значит она точно есть в хранилище..
что то не пойму


Dennis [11 hours ago]
Об этом Григорий то-же говорил: кто вам мешает отправить POST запрос с несуществующим Id?


Aleksey Vra [10 hours ago]
спасибо, понял


Yevhen Maksymovych [1:59 PM]
а в джаве нет встроенных предикатов, которые умеют проверять на равенство?
ну, типа как есть встроенные компараторы для простых типов и для компараблов

Yevhen Maksymovych [3:32 PM]
ребят, ещё вопрос, в задании две фразы немного противоречат друг другу:
```4.2: AuthorizedUser известен только на слое web (см. реализацию ProfileRestController). MealService можно тестировать без подмены логики авторизации, принимаем в методах сервиса и репозитория параметр userId: id владельца еды.
4.3: если еда не принадлежит авторизированному пользователю или отсутствует, в MealServiceImpl бросать NotFoundException.```
```В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.```

Yevhen Maksymovych [3:35 PM]
так надо в MealServiceImpl передавать в каждый метод userId или таки надо глядеть в статический AuthorizedUser.id()?

Dmitry Makarov [8 hours ago]
надо передавать из контроллера (edited)


Evgeniy [8 hours ago]
я так понял: надо глядеть в статический AuthorizedUser.id() в контроллере и передавать в каждый метод сервиса userId


Mikhail Makar [7:18 PM]
кто-нибудь сортировал список юзеров через стримы?

Dennis [5 hours ago]
Да


dustnfox [5 hours ago]
А зачем через стримы? Не легче просто сортировку на коллекции запустить? Но если так уж хочется именно в стриме, то там есть sorted. Принимает компаратор.  То есть будет что-то вроде `.stream().sorted(Comparator.comparing(User::getName))...`


Mikhail Makar [5 hours ago]
Благодарю!


dustnfox [5 hours ago]
На всякий случай: метод не терминальный. То есть после него еще нужно в коллекцию собирать. или преобразовывать в результат


Mikhail Makar [4 hours ago]
да, конечно, .collect(Collectors.toList());
Спасибо)


Grigory Kislin [7:46 PM]
@Yevhen Maksymovych
> так надо в MealServiceImpl передавать в каждый метод userId или таки надо глядеть в статический AuthorizedUser.id()?
ну да, именно так: глядеть в статический AuthorizedUser.id() И  передавать в каждый метод userId

DimaV [9:03 PM]
Добрый вечер!
может кто-нибудь подсказать по поводу thymeleaf? 
в idea нет стандартной поддержки
как добавить?

Anton_Bodyakin [9:21 PM]
Добрый вечер
Никто не столкнулся с проблемой накатки патча 2_1_HW1?
После накатки присутствуют ошибки компиляции, в ru.javawebinar.topjava.util.MealsUtil отсутствуют описанные на страничке проекта изменения (edited)

VictorStatko [9:21 PM]
Добрый вечер, кто подскажет, для чего в User поле enabled?

Yevhen Maksymovych [9:27 PM]
на случай, если админ захочет деактивировать этого пользователя
из базы удалять его нельзя, вдруг там есть милы, которые содержает его ид
нарушится целостность бд (edited)
потому просто деактивируем

VictorStatko [9:28 PM]
понял, спасибо


Aleksei Kirillov [9:17 AM]
Привет! Кто может сказать почему контроллеры создаются не через интерфейсы? В отличие от репозитория и сервисов.

pro [1 day ago]
https://ru.stackoverflow.com/questions/783866/%D0%9A%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D0%BB%D0%B5%D1%80-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%B0-%D0%B2-java
ru.stackoverflow.com
Контроллер для интерфейса в java?
Хорошая ли идея для контроллера создавать интерфейс? Если да, то как лучше сделать аннотацию @RequestMapping()? Прописать ее в интерфейсе, или в контроллере, либо и там и там?
 


Aleksei Kirillov [1 day ago]
Спасибо! Т.е. есть случаи когда нужны интерфейсы для контроллеров.


Artem Murk [12:15 PM]
Кто может подсказать, зачем у Юзера id в конструкторе обязательно указывать, в то время как у meal мы через сеттер устанавливаем?

Edgar Zed [1 day ago]
meal мы можем создавать на клиенте и id ему назначится только когда его в базу будем заносить)


Artem Murk [1 day ago]
А юзера когда мы создаём? Вроде как реализация создания юзера тоже на клиенте есть в будущем, или я не прав? Юзер с админ правами на сервере создаётся, то понятно.


Edgar Zed [1 day ago]
Если будет с юзером аналогичные действия, то и у него наверно добавится сеттер :face_with_rolling_eyes:


Artem Murk [1 day ago]
Вот и я так думаю, пока хардово сам добавляю юзеров


dmitry_ov [12:18 PM]
@Grigory Kislin  
Видео 2_5_spring.mp4, время 45,01
“Мы рассмотрели внедрение зависимости через setter и reflection в поля, остался 3-й вид - через конструктор”
А когда мы через reflection рассматривали ? Или Autowared  это и есть reflection (edited)

Artem Murk [12:32 PM]
Прочитал я различия между DAO and Repository и как мне кажется у нас используется паттерн ДАО, а не репозиторий(может я чего прослушал в лекции Григория). Репозиторий как я понял оперирует более высокими уровнями абстракций.

dmitry_ov [1 day ago]
> Репозиторий как я понял оперирует более высокими уровнями абстракций.


Григорий говорил в лекции об этом.
DAO данные из базы тянет. 
А repository предоставляет Entity, который объект бизнес логики


dmitry_ov [1 day ago]
Что бы сформировать Entity может потребоваться несколько объектов DAO


Artem Murk [1 day ago]
Как я понял из прочитанного он не только отдаёт, но и принимает Entity


pro [12:43 PM]
ребят, пункт 3.2 в метод getAll() класса InMemoryMealRepositoryImpl нужно передавать userId (int) ?  или есть другое решение

ivanpobeguts [12:52 PM]
Ребят, подскажите дураку. Зачем нам нужен слой services? Там фактически такие же методы, как и у репозитория. Почему нельзя из контроллера сразу вызывать методы репозитория? Это же дублирование получается. Я понимаю, что дальше будет другая имплементация репозитория в виде бд, но это не меняет картины.


dmitry_ov [1 day ago]
Это каноническое разбиение на слои. *Большинство* приложений разбивают именно на эти слои.


Artem Murk [1 day ago]
Как я понимаю у нас слой сервиса отвечает за логику приложения, расчёты. Пока у нас логики особой нет, поэтому слой сервиса пустует.


dmitry_ov [1 day ago]
Как говорил Григорий: “если приложение на 5 классов, делить на такое количество слоев не нужно… это избыточно ”


Artem Murk [1 day ago]
Контроллер общается с клиентом, а слой репозитория общается с БД. Соответственно они просто передают какие то данные. В то время как сервис обрабатывает их.


ivanpobeguts [1 day ago]
Понял, спасибо.


Pavel Zaitcev [1 day ago]
Слой сервиса = работа с данными из 1/нескольких ДАО (или репозиториев) + некоторая бизнес-логика. Слой сервиса ничего не должен знать о тонкостях реализации доступа к данным, он должен только выполнять какие-то операции с этими данными. Более высокий уровень абстракции.  В нашем случае пока все довольно нетривиально, и выглядит избыточно поэтому.


Anton Kiselev [1:24 PM]
Подскажите, пожалуйста, инициализируем юзера мы просто в jsp? селектором с id 1 или 2? или через форму? или как? и как связан будет его id с Authorized.id?

Dmitry Neustupov [2:13 PM]
@Anton Kiselev в index.html через простую форму, затем в сервлете юзера устанавливаем id у авторизованого юзера и редиректимся на еду

Anton Kiselev [2:24 PM]
@Dmitry Neustupov Спасибо. Т.е полную форму пока не надо? с email, name и проч. Просто как ролями быть...

Dmitry Makarov [1 day ago]
>8: добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать *Select с двумя элементами со значениями 1 и 2* в index.html и AuthorizedUser.setId(userId) в UserServlet). *Настоящая атворизация будет через Spring Security позже*.


Dmitry Makarov [1 day ago]
на роли можно не обращать внимания


Aleksey Vra [2:33 PM]
Расставил аннотации, запускаю SpringMain, получаю bean MealRestController, вызываю у него методы, все работает.
Когда проделываю тоже самое в MealServlet, то InMemoryMealRepositoryImpl оказывается пустым. Подскажите, где может быть косяк?

Dmitry Makarov [1 day ago]
в сервлете достаешь MealRepository также как в SpringMain?


Aleksey Vra [1 day ago]
в SpringMain
```MealRestController mrc = appCtx.getBean(MealRestController.class);
            mrc.getAll(1).forEach(System.out::print);```
список еды у 1 юзера получаю.
тоже самое в MealServlet это не работает.


Aleksey Vra [1 day ago]
разобрался, у нас же в методе init инициализация
```repository = new InMemoryMealRepositoryImpl();```
убрал и заработало


Aleksey Vra [1 day ago]
выходит что repository перезаписывается так как все объекты singleton


Artem Murk [4:31 PM]
У меня вопрос по добавлению нового пользователя. Почему данный метод не должен возвращать null если пользователь с таким именем уже существует. ValidationUtil не обрабатывает null  Который прилетает от создания нового пользователя если имя уже существует. Или мы можем делать пользователей с одинаковым именем?

Dmitry Neustupov [23 hours ago]
По имейлу будет уникальность проверяться.


Artem Murk [23 hours ago]
Благодарю @Dmitry Neustupov


qf05 [4:36 PM]
Подскажите а зачем нам класс SpringMain только для тестирования, или у него ещё какая то задача?

Artem Murk [5:20 PM]
Я в нем тестирую, он нужен только для этого

Yevhen Maksymovych [10:18 PM]
ребят, подскажите, как мне в этой конструкции сделать "option checked", если ид совпадает с ид AuthorizedUser?
```    <select name="userId">
        <option value="1">1</option>
        <option value="2">2</option>
    </select>```
эта штука приходит по гету без параметров. сессиями мы ещё не пользовались
вытаскивать скриплетом - нехорошо

Grigory Kislin [10:19 PM]
@Yevhen Maksymovych я не парился

Yevhen Maksymovych [10:20 PM]
ну, т.е. если при активном юзере 2 мы зайдем на страницу users, и там будет 1 - для домашки пройдёт? не стоит заморачиваться?
главное чтобы при выборе список еды правильно отображался?

Grigory Kislin [10:22 PM]
тогда я не понял- думал ты про красивое отображение активного пользователя
`AuthorizedUser.set(id)`
точнее - вот это не понял: зайдем на страницу users, и там будет 1 (edited)

dmitry_ov [10:23 PM]
Что-то не пойму где хранить связь 
авторизованный юзер <->  еда
В Meal по условию хранить User нельзя. 
А где тогда хранить ? 
В User хранить List из Meals_id? (edited)

Grigory Kislin [10:23 PM]
на странице users отображаются все юзеры (edited)

Yevhen Maksymovych [10:24 PM]
не, я к тому, что мы заходим на вкладку юзер, выбираем там 2, жмём эплай, он попадает в сервлет, у авторизированного юзера меняется ид, список еды фильтруется в соответствии с выбранным юзером. но если мы после этого захотим опять сменить пользователя, и зайдём на стринцу юзеров, там будет в списке выбора гореть все равно 1 (при активном втором), если мы там нажмём эплай, первый станет опять ативным, и список опять отфильтруется верно

Grigory Kislin [10:24 PM]
@dmitry_ov еда хранится в общем репозитории (который у нас пока InMemory)

Yevhen Maksymovych [10:24 PM]
просто в листбоксе будет показан не активный юзер, а первый из оптионов

dmitry_ov [10:25 PM]
Это ясно. Вопрос: где хранить связь юзер--еда
Grigory Kislin
@dmitry_ov еда хранится в общем репозитории (который у нас пока InMemory)

Grigory Kislin [10:25 PM]
@Yevhen Maksymovych тогда см. 1 :slightly_smiling_face: (не парился)

Yevhen Maksymovych [18 hours ago]
ок, спасибо, тогда и я не буду :slightly_smiling_face:


Grigory Kislin [10:27 PM]
@dmitry_ov в этом собственно суть ДЗ 3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей

Yevhen Maksymovych [10:30 PM]
и ещё один вопрос, Григорий, прости, если надоедаю ))
"1.3: предусмотрите случай одинаковых User.name (порядок должен быть зафиксированным)."

dmitry_ov [10:30 PM]
Это тоже ясно.  Подсказка запрещает хранить ссылку на юзерв владельца  в модели meal

Подсказка:
2.1 В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.


Вопрос в реализации:  Если нельяза (нет смысла) хранить user в meal, то где хранить связь этих двух сущностей ? 
В User добавить List<Meal> ?
Grigory Kislin
@dmitry_ov в этом собственно суть ДЗ 3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей

Yevhen Maksymovych [18 hours ago]
не запрещает


Yevhen Maksymovych [18 hours ago]
запрещает только обращаться к AuthorizedUser.id()


Yevhen Maksymovych [18 hours ago]
т.е. мы можем хранить в еде ссылку на пользователя ее создавшего, но не знаем, равен ли этот пользователь текущему


dmitry_ov [18 hours ago]
ок


dmitry_ov [18 hours ago]
Попробую так


Grigory Kislin [18 hours ago]
прочитай все ДЗ внимательно.
3.2: реализовать хранение еды для каждого пользователя можно с добавлением поля userId в Meal ИЛИ без него (как нравится). Напомню, что репозиторий один и приложение может работать одновременно с многими пользователями.


dmitry_ov [18 hours ago]
Прочитал и сделал так


dmitry_ov [18 hours ago]
Но потом посмотрел в подсказку…


Yevhen Maksymovych [10:34 PM]
так вот, по юзерам - исходя из того, что в возможность дублирования User.name нас специально ткнули пальцем, надо ли предполагать, что какое-то другое поле должно быть уникальным кроме id? Т.е. могут ли быть пользователи с одинаковым eMail? Надо ли нам при вставке новых пользователей в БД и изменении существующих проверять, что мы не создаём дублей с уже имеющимися совпадением имени и почтового адреса?

Dmitry Neustupov [10:51 PM]
@Yevhen Maksymovych когда прикрутится БД, будет уникальность по имейлу. Сейчас это не важно.

Yevhen Maksymovych [17 hours ago]
тогда не очень понятно, зачем нам знать об одинаковых User.name. Только для вторичной сортировки по id при выводе?


dustnfox [3 hours ago]
Насколько я понимаю - именно так. Чтобы при сортировке по неуникальному полю не забыли "досортировать" по уникальному :slightly_smiling_face:


Ilya [4:45 AM]
Поясните, пожалуйста, непонимающему за этот пункт -
3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду.

Т.е. изменения нужно пилить и на уровне сервлета и фронтовой части - откуда иначе можно узнать, какой именно юзер пытается сохранить/удалить/изменить еду ?
а то я что-то туплю с восприятием - чего хотят то

Alexander Sinayko [5:59 AM]
чуть ниже идет подсказка что это можно реализовать с userId и без. Обычно когда проектирует такие приложения это все хранится в таблицах БД. Таблицы связаны через foreign key. Добавьте в meal переменную int userId и заполняйте ее в соответсвии какой юзер сделал запись. Отображать так же если meal.userId совпадает с user.getId()

Ilya [6:28 AM]
@Alexander Sinayko да, уже запилил. Спасибо большое за коммент!

Andrew [7:01 AM]
А почему используется Set<Role>, разве чтобы определить роль юзера просто поля Role недостаточно ?

Ilya [7:15 AM]
@Andrew У админа две роли в демо приложении ROLE_USER,ROLE_ADMIN . Наверное с целью, что вдруг ты из обычного юзера за заслуги захочешь админа сделать и тп

Yevhen Maksymovych [8:14 AM]
ребят, вопрос по спрингу: судя по логам при запуске приложения, контекст спринга инстанциируется и без моего участия при старте приложения. Сталобыть, его можно как-то получить, не вычитывая заново из xml?

qf05 [10:20 AM]
"6.1: учесть, что когда будем работать через Spring MVC, MealServlet удалим, те вся логика должна быть в контроллере."
Подскажите, надо/можно ли сейчас передавать в контроллер request, или это надо как то по другому делать?

Pavel Zaitcev [5 hours ago]
Сейчас в MealServlet должна быть только логика обработки запросов, и взаимодействие с контроллером. Никаких расчетов, преобразований дат и т.д. Все это должно происходить в контроллере. Когда перейдем на MVC, будем использовать DispatcherServlet и мапить запросы на контроллер. Вот тогда и могут возникнуть проблемы, если у тебя  сервлет занимался лишними вещами. В MealRestController сейчас, соответственно, никаких запросов обрабатывать не нужно. Мы просто взаимодействуем с сервисным слоем и делаем необходимые преобразования для этого.


qf05 [5 hours ago]
То есть  в  MealServlet мы достаем из request параметры и их отправляем на обработку в MealRestController ?


dmitry_ov [11:18 AM]
Если пользователь не указан, какую еду нужно вернуть из контроллера на запрос без параметров ?
Просто всю еду вернуть какая есть в репозитории ?

“5: Реализация ‘MealRestController’ должен уметь обрабатывать запросы:
5.1: Отдать свою еду (для отображения в таблице, формат List<MealWithExceed>), запрос БЕЗ параметров” (edited)

Yevhen Maksymovych [5 hours ago]
Нет, пользователь есть всегда. Если его вдруг нет потому что он не валидный - возвращаем пустой лист


dmitry_ov [5 hours ago]
Тогда в условии противоречение.
Показывать еду можно только владельцу. 
А т.к. запрос всей еды *без параметров*, а значит без владельца, то показывать впринцыпе будет нечего


dmitry_ov [5 hours ago]
5.1: Отдать свою еду (для отображения в таблице, формат List<MealWithExceed>), запрос БЕЗ параметров


dmitry_ov [5 hours ago]
Вот эти нестыковки тз очень раздражают. Курс обещал познакомить с технологиями. А вместо этого занимаешься телепатией((


Aleksei Kirillov [5 hours ago]
Написано: 8. добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать Select с двумя элементами со значениями 1 и 2 в index.html и AuthorizedUser.setId(userId) в UserServlet). Настоящая атворизация будет через Spring Security позже.
Т.е. инициализируешь значением 1 + делаешь в index.html переключение между пользователями. (edited)


dmitry_ov [5 hours ago]
@Aleksei Kirillov погоди ты п.8
Сейчас речь о п.5


Yevhen Maksymovych [5 hours ago]
откуда противоречие? после добавление в мил userId, у тебя все методы репозитория принимают userId в качестве второго параметра. соответственно, getAll() у тебя превратится в getAll(int userId)


Yevhen Maksymovych [5 hours ago]
т.е. он в любом случае придёт, если такого userId нет в базе, у тебя вернется пустой лист

dmitry_ov [5 hours ago]
@Yevhen Maksymovych все так

Yevhen Maksymovych [5 hours ago]
исходя из того условия, которое тебе говорит, что если надо вернуть лист, а получается нулл - возвращаем пустой лист


dmitry_ov [5 hours ago]
в контроллере должен быть метод, у которого нет параметров. метод должен вернуть чью-то еду, чью именно без параметра userId не узнать

5.1: Отдать свою еду (для отображения в таблице, формат List<MealWithExceed>), запрос БЕЗ параметров


Yevhen Maksymovych [4 hours ago]
да все понятно же

Yevhen Maksymovych [4 hours ago]
у тебя в слое веб доступен AuthorizedUser.id()

Yevhen Maksymovych [4 hours ago]
и в контроллер ты его и передаешь


Yevhen Maksymovych [4 hours ago]
ты ниоткуда из запроса userId не берёшь


dmitry_ov [4 hours ago]
ok. 
Реализую метод, обращаюсь в сервис за едой - getAll.
userId в контролер не пришел, что в getAll сервиса передвать ? (edited)


Yevhen Maksymovych [4 hours ago]
только из AuthorizedUser в слое веб

Yevhen Maksymovych [4 hours ago]
да не может он не прийти в контроллер. ты в MealResstContoller пользуешь везде, где надо передавать в службу MealService userId - AuthorizedUser.id()


Yevhen Maksymovych [4 hours ago]
если его там по какой-то причине нет - не твоя забота

dmitry_ov [4 hours ago]
т.е. запрос в контроллер приходит без userId, а за userId идем в  AuthorizedUser.id()?


Yevhen Maksymovych [4 hours ago]
да, верно

dmitry_ov [4 hours ago]
понял

dmitry_ov [4 hours ago]
@Yevhen Maksymovych Спасибо. Прояснил) (edited)


Yevhen Maksymovych [4 hours ago]
Абстракция, ёпта ))))


Aleksei Kirillov [4 hours ago]
По этому есть еще один пункт: 2.1: В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность. (edited)


Vladimir Gorbatenko [3:29 PM]
Всем приветы! Как-то много у меня вопросов с этим заданием. 
Например как понимать "2: сделать Meal extends AbstractBaseEntity, MealWithExceed перенести в пакет ru.javawebinar.topjava.to (transfer objects)"? 
1) К Meal прикрутить AbstractBaseEntity. Изменить конструктор с учетом super(id). 
2) Создать пакет "to" и в него перенести MealWithExceed. 
Так? (edited)

dmitry_ov [3:32 PM]
так

dmitry_ov [4:00 PM]
Какое поведение системы должно быть если юзер меняет еду которая ему не принадлежит ?
Бросаем из сервиса NotFoundException ?


2.3: Проверьте сценарий: авторизованный пользователь пробует изменить чужую еду (id еды ему не принадлежит).
