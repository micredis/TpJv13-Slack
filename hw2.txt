Grigory Kislin [2:26 AM]
joined #hw2.

Grigory Kislin [2:28 AM]
Добро пожаловать на 2й (достаточно сложный) урок, где мы будем делать архитектурные слои нашего приложения:
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md (edited)

Pavel Zaitcev [2:38 AM]
joined #hw2 along with 18 others.

realcorwin [10:39 AM]
ссылка на 5. Обзор Spring Framework. Spring Context. не работает
"Sorry, the file you have requested does not exist."

pro [1:56 PM]
патч 2 0 add fix принялся?

Aleksey Vra [2:03 PM]
кто нибудь уже приступил к выполнению?)
посмотрел все видео, вопрос к патчу 2 5 dependency injection.
получили контекст, далее получаем bean:
```UserService userService = appCtx.getBean(UserService.class);
userService.create(new User(null, "userName", "email", "password", Role.ROLE_ADMIN));```
в spring-app.xml указываем бин mockUserRepository и UserServiceImpl(с инжектом mockUser)
Правильно ли я понял, что спринг сам автоматом каким то образом userService присваивает новый объект UserServiceImpl, только потому что в контексте единственный бин унаследованный от этого интерфейса?
И аннотаций никаких нет, а интерфейс уже сам связался с бином. И получается, что если бы у нас допустим был еще 1 бин унаследованный от UserService, то
```UserService userService = appCtx.getBean(UserService.class);```
уже автоматом не свяжется и выдаст ошибку? (edited)
до 5 патча пока все норм принялось
пытюсь пока на 5 патче эксперементировать, код поизменял, как бы потом 2 и 6 патч не встал

pro [2:05 PM]
у меня 108 строка конфликтует MealsUtil, показывает ее одинаковой в обоих случаях, только табуляция на один спейс смещена

Aleksey Vra [2:06 PM]
там public на private поменялся

Dmitry Neustupov [2:25 PM]
@Aleksey Vra выдаст ошибку, при нескольких имплементациях можно использовать аннотацию @Qualifier
@Aleksey Vra для точного определения, какой из бинов инжектить

Aleksey Vra [2:28 PM]
меня просто вот эта строчка смущает
```UserService userService = appCtx.getBean(UserService.class);```
допустим  унас много интерфейсов и бинов, лезть в хмл и смотреть кто инжектиться? легко запутаться (edited)

aleksey [9 hours ago]
Там есть перегруженный метод с указанием имени,
Service service = context.getBean(Service.class, "myService");
или можно выставит primary у нужной имплементации (edited)


Aleksey Vra [9 hours ago]
точно, спасибо
глянул доки, только аргументы наоборот


aleksey [7 hours ago]
Я строчку вроде с доков копировал, странно :relaxed:


Aleksey Vra [2:36 PM]
действительно эксепшн вылетает

roma [2:59 PM]
Народ тут пытался создать похожий на  наш проект через архитипы мавена. И убил часа полтора так как не мог получить параметры на .jsp через ${meals} в итоге выяснилось что в web.xml было просто
```<web-app>...</web-app>```
а не как у нас
```<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
  http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
  version="3.1">...</web-app>```
Кто подскажет что это за Шемы и почему без них не работал  ${meals} ?

pro [3:02 PM]
@roma в каком теге ты пытался вывести ${meals} ?

roma [3:03 PM]
td
ну точнее как у нас
```   <c:forEach items="${meals}" var="meals">
        <tr class="${meals.isExceed()}">.....```
```<td>${meals.getCalories()}</td>```
в итоге заполнялась только одна строка со значениями в ячейках типо ${meals.getCalories()}
@pro объяснишь?

pro [3:22 PM]
пространство имен прописываешь в корневом теге
там просто версия спецификации

pro [4:09 PM]
можешь представить себе, что твой web-app - это книга; а спецификация - это год в котором она была написана; пускай язык будет английский; если книга написана на английском 14 века, а ты пытаешься парсить ее в 21, у тебя могут возникнуть проблемы с миграцией понятий: одно и то же слово в 14 и 21 веке может иметь разное значение. Если ты не указываешь версию спецификации, твой парсер не знает, в рамках каких правил он должен интерпретировать то, что вложено в корневой тег, и может сделать это не так как ты ожидаешь от него (edited)

roma [4:39 PM]
спасибо за доступное объяснение ) стало яснее )

pro [7 hours ago]
http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html


pro [7 hours ago]
https://www.w3schools.com/xml/schema_schema.asp
w3schools.com
XML schema Element
Well organized and easy to understand Web building tutorials with lots of examples of how to use HTML, CSS, JavaScript, SQL, PHP, and XML.


Grigory Kislin [5:39 PM]
> ссылка на 5. Обзор Spring Framework. Spring Context. не работает
спасибо, поправил
> 2 0 add fix принялся
см. https://github.com/JavaOPs/topjava/wiki/git#patch-%D0%BD%D0%B5-%D0%BD%D0%B0%D0%BA%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B5%D0%B4%D0%BB%D0%B0%D0%B3%D0%B0%D0%B5%D1%82-merge

Grigory Kislin [5:42 PM]
> Правильно ли я понял, что спринг сам автоматом каким то образом userService присваивает новый объект UserServiceImpl, только по тотому что в контексте единственный бин унаследованный от этого интерфейса?
Spring не "каким-то образом", а смотрит что у него в контексте есть (обычные мапы). Пересмотрите видео, если это непонятно. Далее берет оттуда имплементацию UserService. Тк она одна конфликта нет

Aleksey Vra [6 hours ago]
спасибо, разобрался, когда еще 1 реализацию UserService написал и попробовал несколько вариантов получения бина


roma [7:12 PM]
Вот эта строка меня  немного убивает:
```return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);```
в части
```(id, oldMeal) -> meal)```
из документации вроде понимаю BiFunction - но как оно работает не понимаю... Полагаю что
```if ((oldValue = get(key)) != null) {
            V newValue = remappingFunction.apply(key, oldValue);```
тут у нас newValue станет meal (так как в нашей функции на выходе у нас -> meal) и потом мы кладем в нашу мапу это новое значение
```if (newValue != null) {
                put(key, newValue);
                return newValue; //еще и возвращает этот new валью зараза```

Aleksey Vra [4 hours ago]
```(key, val) -> meal```
так key - это просто ключ мапы куда положим новое значение


roma [4 hours ago]
вроде разобрался - спасибо - функциональное программирование тяжко дается


roma [9:23 AM]
Всем доброе утро

roma [9:24 AM]
```switch (action == null ? "all" : action) ```
all и соответствующую секцию case добавляем для удобочитаемости кода?

Aleksey Vra [14 hours ago]
привет.
ну вот у меня внешний if был с проверкой на null и выводом списка,  а тут проверка в том же свитче, гораздо проще


roma [13 hours ago]
@Aleksey Vra Это я понимаю прото all мы могли бы и не прикреплять - всеравно он проскакивает в дефулт потом - я только про это )


Aleksey Vra [13 hours ago]
у меня action мог быть null, поэтому проверка нужна в любом случае


roma [13 hours ago]
```switch (action)```
и без проверки бы улетала в секцию default - PS у нас она тоже равна null когда мы с index.html переходим (edited)


Aleksey Vra [12 hours ago]
если action==null вылетит NullPointException


roma [6 hours ago]
Точняк ) нельзя использовать null в свитч кейсе - спасибо


Vladimir [10:01 AM]
Добрый день у кого нибудь были проблемы с патчeм 2_1_HW_1?
Скинте пожалуйста весь класс MealsUtil.

Vladimir [10:40 AM]
Спасибо уже не надо

Yevhen Maksymovych [12:45 PM]
ребят, я чего-то пропустил в видео? зачем мы так делаем?
```        // treat case: update, but absent in storage
        return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);```

Yevhen Maksymovych [12:45 PM]
почему не просто map.put()?

Aleksey Vra [11 hours ago]
тоже обратил внимание.. 
может для удобства, ведь put возвращает oldValue
а compute newValue.. а мы сразу получили и вернули


Yevhen Maksymovych [11 hours ago]
да, но у нас перед этим код
```if (meal.isNew()) {
            meal.setId(counter.incrementAndGet());
            repository.put(meal.getId(), meal);
            return meal;
        }```


Yevhen Maksymovych [11 hours ago]
почему не сделать так?
```        if (meal.isNew()) {
            meal.setId(counter.incrementAndGet());
        }
        repository.put(meal.getId(), meal);
        return meal;```


Alexander Sinayko [11 hours ago]
Ну лично я думаю, что нам самим надо ответить на данный вопрос. Гуглим метод, что дает, какие +. Ребят, Григорий покажет нам кунг-фу, но махать кулаками за нас никто не будет! Не ленимся и вникаем.



Dennis [11 hours ago]
Григорий не зря делает ремарки:
>Поправил InMemoryMealRepositoryImpl.save(). Если обновляется еда, которой нет в хранилище (c несуществующим id), вставка не >происходит.
(edited)



Yevhen Maksymovych [11 hours ago]
во, спасибо!


Yevhen Maksymovych [11 hours ago]
смотрю в книгу, вижу фигу :slightly_smiling_face:


Alexander Sinayko [11 hours ago]
Внимательность важная черта для разработчика!



Aleksey Vra [11 hours ago]
а в каких случаех будет обновляться еда, которой нет в хранилище? редактируем еду, которая отображается, значит она точно есть в хранилище..
что то не пойму


Dennis [11 hours ago]
Об этом Григорий то-же говорил: кто вам мешает отправить POST запрос с несуществующим Id?


Aleksey Vra [10 hours ago]
спасибо, понял


Yevhen Maksymovych [1:59 PM]
а в джаве нет встроенных предикатов, которые умеют проверять на равенство?
ну, типа как есть встроенные компараторы для простых типов и для компараблов

Yevhen Maksymovych [3:32 PM]
ребят, ещё вопрос, в задании две фразы немного противоречат друг другу:
```4.2: AuthorizedUser известен только на слое web (см. реализацию ProfileRestController). MealService можно тестировать без подмены логики авторизации, принимаем в методах сервиса и репозитория параметр userId: id владельца еды.
4.3: если еда не принадлежит авторизированному пользователю или отсутствует, в MealServiceImpl бросать NotFoundException.```
```В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.```

Yevhen Maksymovych [3:35 PM]
так надо в MealServiceImpl передавать в каждый метод userId или таки надо глядеть в статический AuthorizedUser.id()?

Dmitry Makarov [8 hours ago]
надо передавать из контроллера (edited)


Evgeniy [8 hours ago]
я так понял: надо глядеть в статический AuthorizedUser.id() в контроллере и передавать в каждый метод сервиса userId


Mikhail Makar [7:18 PM]
кто-нибудь сортировал список юзеров через стримы?

Dennis [5 hours ago]
Да


dustnfox [5 hours ago]
А зачем через стримы? Не легче просто сортировку на коллекции запустить? Но если так уж хочется именно в стриме, то там есть sorted. Принимает компаратор.  То есть будет что-то вроде `.stream().sorted(Comparator.comparing(User::getName))...`


Mikhail Makar [5 hours ago]
Благодарю!


dustnfox [5 hours ago]
На всякий случай: метод не терминальный. То есть после него еще нужно в коллекцию собирать. или преобразовывать в результат


Mikhail Makar [4 hours ago]
да, конечно, .collect(Collectors.toList());
Спасибо)


Grigory Kislin [7:46 PM]
@Yevhen Maksymovych
> так надо в MealServiceImpl передавать в каждый метод userId или таки надо глядеть в статический AuthorizedUser.id()?
ну да, именно так: глядеть в статический AuthorizedUser.id() И  передавать в каждый метод userId

DimaV [9:03 PM]
Добрый вечер!
может кто-нибудь подсказать по поводу thymeleaf? 
в idea нет стандартной поддержки
как добавить?

Anton_Bodyakin [9:21 PM]
Добрый вечер
Никто не столкнулся с проблемой накатки патча 2_1_HW1?
После накатки присутствуют ошибки компиляции, в ru.javawebinar.topjava.util.MealsUtil отсутствуют описанные на страничке проекта изменения (edited)

VictorStatko [9:21 PM]
Добрый вечер, кто подскажет, для чего в User поле enabled?

Yevhen Maksymovych [9:27 PM]
на случай, если админ захочет деактивировать этого пользователя
из базы удалять его нельзя, вдруг там есть милы, которые содержает его ид
нарушится целостность бд (edited)
потому просто деактивируем

VictorStatko [9:28 PM]
понял, спасибо
