Grigory Kislin [2:26 AM]
joined #hw2.

Grigory Kislin [2:28 AM]
Добро пожаловать на 2й (достаточно сложный) урок, где мы будем делать архитектурные слои нашего приложения:
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson02.md (edited)

Pavel Zaitcev [2:38 AM]
joined #hw2 along with 18 others.

realcorwin [10:39 AM]
ссылка на 5. Обзор Spring Framework. Spring Context. не работает
"Sorry, the file you have requested does not exist."

pro [1:56 PM]
патч 2 0 add fix принялся?

Aleksey Vra [2:03 PM]
кто нибудь уже приступил к выполнению?)
посмотрел все видео, вопрос к патчу 2 5 dependency injection.
получили контекст, далее получаем bean:
```UserService userService = appCtx.getBean(UserService.class);
userService.create(new User(null, "userName", "email", "password", Role.ROLE_ADMIN));```
в spring-app.xml указываем бин mockUserRepository и UserServiceImpl(с инжектом mockUser)
Правильно ли я понял, что спринг сам автоматом каким то образом userService присваивает новый объект UserServiceImpl, только потому что в контексте единственный бин унаследованный от этого интерфейса?
И аннотаций никаких нет, а интерфейс уже сам связался с бином. И получается, что если бы у нас допустим был еще 1 бин унаследованный от UserService, то
```UserService userService = appCtx.getBean(UserService.class);```
уже автоматом не свяжется и выдаст ошибку? (edited)
до 5 патча пока все норм принялось
пытюсь пока на 5 патче эксперементировать, код поизменял, как бы потом 2 и 6 патч не встал

pro [2:05 PM]
у меня 108 строка конфликтует MealsUtil, показывает ее одинаковой в обоих случаях, только табуляция на один спейс смещена

Aleksey Vra [2:06 PM]
там public на private поменялся

Dmitry Neustupov [2:25 PM]
@Aleksey Vra выдаст ошибку, при нескольких имплементациях можно использовать аннотацию @Qualifier
@Aleksey Vra для точного определения, какой из бинов инжектить

Aleksey Vra [2:28 PM]
меня просто вот эта строчка смущает
```UserService userService = appCtx.getBean(UserService.class);```
допустим  унас много интерфейсов и бинов, лезть в хмл и смотреть кто инжектиться? легко запутаться (edited)

aleksey [9 hours ago]
Там есть перегруженный метод с указанием имени,
Service service = context.getBean(Service.class, "myService");
или можно выставит primary у нужной имплементации (edited)


Aleksey Vra [9 hours ago]
точно, спасибо
глянул доки, только аргументы наоборот


aleksey [7 hours ago]
Я строчку вроде с доков копировал, странно :relaxed:


Aleksey Vra [2:36 PM]
действительно эксепшн вылетает

roma [2:59 PM]
Народ тут пытался создать похожий на  наш проект через архитипы мавена. И убил часа полтора так как не мог получить параметры на .jsp через ${meals} в итоге выяснилось что в web.xml было просто
```<web-app>...</web-app>```
а не как у нас
```<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
  http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
  version="3.1">...</web-app>```
Кто подскажет что это за Шемы и почему без них не работал  ${meals} ?

pro [3:02 PM]
@roma в каком теге ты пытался вывести ${meals} ?

roma [3:03 PM]
td
ну точнее как у нас
```   <c:forEach items="${meals}" var="meals">
        <tr class="${meals.isExceed()}">.....```
```<td>${meals.getCalories()}</td>```
в итоге заполнялась только одна строка со значениями в ячейках типо ${meals.getCalories()}
@pro объяснишь?

pro [3:22 PM]
пространство имен прописываешь в корневом теге
там просто версия спецификации

pro [4:09 PM]
можешь представить себе, что твой web-app - это книга; а спецификация - это год в котором она была написана; пускай язык будет английский; если книга написана на английском 14 века, а ты пытаешься парсить ее в 21, у тебя могут возникнуть проблемы с миграцией понятий: одно и то же слово в 14 и 21 веке может иметь разное значение. Если ты не указываешь версию спецификации, твой парсер не знает, в рамках каких правил он должен интерпретировать то, что вложено в корневой тег, и может сделать это не так как ты ожидаешь от него (edited)

roma [4:39 PM]
спасибо за доступное объяснение ) стало яснее )

pro [7 hours ago]
http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/index.html


pro [7 hours ago]
https://www.w3schools.com/xml/schema_schema.asp
w3schools.com
XML schema Element
Well organized and easy to understand Web building tutorials with lots of examples of how to use HTML, CSS, JavaScript, SQL, PHP, and XML.


Grigory Kislin [5:39 PM]
> ссылка на 5. Обзор Spring Framework. Spring Context. не работает
спасибо, поправил
> 2 0 add fix принялся
см. https://github.com/JavaOPs/topjava/wiki/git#patch-%D0%BD%D0%B5-%D0%BD%D0%B0%D0%BA%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BF%D1%80%D0%B5%D0%B4%D0%BB%D0%B0%D0%B3%D0%B0%D0%B5%D1%82-merge

Grigory Kislin [5:42 PM]
> Правильно ли я понял, что спринг сам автоматом каким то образом userService присваивает новый объект UserServiceImpl, только по тотому что в контексте единственный бин унаследованный от этого интерфейса?
Spring не "каким-то образом", а смотрит что у него в контексте есть (обычные мапы). Пересмотрите видео, если это непонятно. Далее берет оттуда имплементацию UserService. Тк она одна конфликта нет

Aleksey Vra [6 hours ago]
спасибо, разобрался, когда еще 1 реализацию UserService написал и попробовал несколько вариантов получения бина


roma [7:12 PM]
Вот эта строка меня  немного убивает:
```return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);```
в части
```(id, oldMeal) -> meal)```
из документации вроде понимаю BiFunction - но как оно работает не понимаю... Полагаю что
```if ((oldValue = get(key)) != null) {
            V newValue = remappingFunction.apply(key, oldValue);```
тут у нас newValue станет meal (так как в нашей функции на выходе у нас -> meal) и потом мы кладем в нашу мапу это новое значение
```if (newValue != null) {
                put(key, newValue);
                return newValue; //еще и возвращает этот new валью зараза```

Aleksey Vra [4 hours ago]
```(key, val) -> meal```
так key - это просто ключ мапы куда положим новое значение


roma [4 hours ago]
вроде разобрался - спасибо - функциональное программирование тяжко дается


roma [9:23 AM]
Всем доброе утро

roma [9:24 AM]
```switch (action == null ? "all" : action) ```
all и соответствующую секцию case добавляем для удобочитаемости кода?

Aleksey Vra [14 hours ago]
привет.
ну вот у меня внешний if был с проверкой на null и выводом списка,  а тут проверка в том же свитче, гораздо проще


roma [13 hours ago]
@Aleksey Vra Это я понимаю прото all мы могли бы и не прикреплять - всеравно он проскакивает в дефулт потом - я только про это )


Aleksey Vra [13 hours ago]
у меня action мог быть null, поэтому проверка нужна в любом случае


roma [13 hours ago]
```switch (action)```
и без проверки бы улетала в секцию default - PS у нас она тоже равна null когда мы с index.html переходим (edited)


Aleksey Vra [12 hours ago]
если action==null вылетит NullPointException


roma [6 hours ago]
Точняк ) нельзя использовать null в свитч кейсе - спасибо


Vladimir [10:01 AM]
Добрый день у кого нибудь были проблемы с патчeм 2_1_HW_1?
Скинте пожалуйста весь класс MealsUtil.

Vladimir [10:40 AM]
Спасибо уже не надо

Yevhen Maksymovych [12:45 PM]
ребят, я чего-то пропустил в видео? зачем мы так делаем?
```        // treat case: update, but absent in storage
        return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);```

Yevhen Maksymovych [12:45 PM]
почему не просто map.put()?

Aleksey Vra [11 hours ago]
тоже обратил внимание.. 
может для удобства, ведь put возвращает oldValue
а compute newValue.. а мы сразу получили и вернули


Yevhen Maksymovych [11 hours ago]
да, но у нас перед этим код
```if (meal.isNew()) {
            meal.setId(counter.incrementAndGet());
            repository.put(meal.getId(), meal);
            return meal;
        }```


Yevhen Maksymovych [11 hours ago]
почему не сделать так?
```        if (meal.isNew()) {
            meal.setId(counter.incrementAndGet());
        }
        repository.put(meal.getId(), meal);
        return meal;```


Alexander Sinayko [11 hours ago]
Ну лично я думаю, что нам самим надо ответить на данный вопрос. Гуглим метод, что дает, какие +. Ребят, Григорий покажет нам кунг-фу, но махать кулаками за нас никто не будет! Не ленимся и вникаем.



Dennis [11 hours ago]
Григорий не зря делает ремарки:
>Поправил InMemoryMealRepositoryImpl.save(). Если обновляется еда, которой нет в хранилище (c несуществующим id), вставка не >происходит.
(edited)



Yevhen Maksymovych [11 hours ago]
во, спасибо!


Yevhen Maksymovych [11 hours ago]
смотрю в книгу, вижу фигу :slightly_smiling_face:


Alexander Sinayko [11 hours ago]
Внимательность важная черта для разработчика!



Aleksey Vra [11 hours ago]
а в каких случаех будет обновляться еда, которой нет в хранилище? редактируем еду, которая отображается, значит она точно есть в хранилище..
что то не пойму


Dennis [11 hours ago]
Об этом Григорий то-же говорил: кто вам мешает отправить POST запрос с несуществующим Id?


Aleksey Vra [10 hours ago]
спасибо, понял


Yevhen Maksymovych [1:59 PM]
а в джаве нет встроенных предикатов, которые умеют проверять на равенство?
ну, типа как есть встроенные компараторы для простых типов и для компараблов

Yevhen Maksymovych [3:32 PM]
ребят, ещё вопрос, в задании две фразы немного противоречат друг другу:
```4.2: AuthorizedUser известен только на слое web (см. реализацию ProfileRestController). MealService можно тестировать без подмены логики авторизации, принимаем в методах сервиса и репозитория параметр userId: id владельца еды.
4.3: если еда не принадлежит авторизированному пользователю или отсутствует, в MealServiceImpl бросать NotFoundException.```
```В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.```

Yevhen Maksymovych [3:35 PM]
так надо в MealServiceImpl передавать в каждый метод userId или таки надо глядеть в статический AuthorizedUser.id()?

Dmitry Makarov [8 hours ago]
надо передавать из контроллера (edited)


Evgeniy [8 hours ago]
я так понял: надо глядеть в статический AuthorizedUser.id() в контроллере и передавать в каждый метод сервиса userId


Mikhail Makar [7:18 PM]
кто-нибудь сортировал список юзеров через стримы?

Dennis [5 hours ago]
Да


dustnfox [5 hours ago]
А зачем через стримы? Не легче просто сортировку на коллекции запустить? Но если так уж хочется именно в стриме, то там есть sorted. Принимает компаратор.  То есть будет что-то вроде `.stream().sorted(Comparator.comparing(User::getName))...`


Mikhail Makar [5 hours ago]
Благодарю!


dustnfox [5 hours ago]
На всякий случай: метод не терминальный. То есть после него еще нужно в коллекцию собирать. или преобразовывать в результат


Mikhail Makar [4 hours ago]
да, конечно, .collect(Collectors.toList());
Спасибо)


Grigory Kislin [7:46 PM]
@Yevhen Maksymovych
> так надо в MealServiceImpl передавать в каждый метод userId или таки надо глядеть в статический AuthorizedUser.id()?
ну да, именно так: глядеть в статический AuthorizedUser.id() И  передавать в каждый метод userId

DimaV [9:03 PM]
Добрый вечер!
может кто-нибудь подсказать по поводу thymeleaf? 
в idea нет стандартной поддержки
как добавить?

Anton_Bodyakin [9:21 PM]
Добрый вечер
Никто не столкнулся с проблемой накатки патча 2_1_HW1?
После накатки присутствуют ошибки компиляции, в ru.javawebinar.topjava.util.MealsUtil отсутствуют описанные на страничке проекта изменения (edited)

VictorStatko [9:21 PM]
Добрый вечер, кто подскажет, для чего в User поле enabled?

Yevhen Maksymovych [9:27 PM]
на случай, если админ захочет деактивировать этого пользователя
из базы удалять его нельзя, вдруг там есть милы, которые содержает его ид
нарушится целостность бд (edited)
потому просто деактивируем

VictorStatko [9:28 PM]
понял, спасибо


Aleksei Kirillov [9:17 AM]
Привет! Кто может сказать почему контроллеры создаются не через интерфейсы? В отличие от репозитория и сервисов.

pro [1 day ago]
https://ru.stackoverflow.com/questions/783866/%D0%9A%D0%BE%D0%BD%D1%82%D1%80%D0%BE%D0%BB%D0%BB%D0%B5%D1%80-%D0%B4%D0%BB%D1%8F-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%B0-%D0%B2-java
ru.stackoverflow.com
Контроллер для интерфейса в java?
Хорошая ли идея для контроллера создавать интерфейс? Если да, то как лучше сделать аннотацию @RequestMapping()? Прописать ее в интерфейсе, или в контроллере, либо и там и там?
 


Aleksei Kirillov [1 day ago]
Спасибо! Т.е. есть случаи когда нужны интерфейсы для контроллеров.


Artem Murk [12:15 PM]
Кто может подсказать, зачем у Юзера id в конструкторе обязательно указывать, в то время как у meal мы через сеттер устанавливаем?

Edgar Zed [1 day ago]
meal мы можем создавать на клиенте и id ему назначится только когда его в базу будем заносить)


Artem Murk [1 day ago]
А юзера когда мы создаём? Вроде как реализация создания юзера тоже на клиенте есть в будущем, или я не прав? Юзер с админ правами на сервере создаётся, то понятно.


Edgar Zed [1 day ago]
Если будет с юзером аналогичные действия, то и у него наверно добавится сеттер :face_with_rolling_eyes:


Artem Murk [1 day ago]
Вот и я так думаю, пока хардово сам добавляю юзеров


dmitry_ov [12:18 PM]
@Grigory Kislin  
Видео 2_5_spring.mp4, время 45,01
“Мы рассмотрели внедрение зависимости через setter и reflection в поля, остался 3-й вид - через конструктор”
А когда мы через reflection рассматривали ? Или Autowared  это и есть reflection (edited)

Artem Murk [12:32 PM]
Прочитал я различия между DAO and Repository и как мне кажется у нас используется паттерн ДАО, а не репозиторий(может я чего прослушал в лекции Григория). Репозиторий как я понял оперирует более высокими уровнями абстракций.

dmitry_ov [1 day ago]
> Репозиторий как я понял оперирует более высокими уровнями абстракций.


Григорий говорил в лекции об этом.
DAO данные из базы тянет. 
А repository предоставляет Entity, который объект бизнес логики


dmitry_ov [1 day ago]
Что бы сформировать Entity может потребоваться несколько объектов DAO


Artem Murk [1 day ago]
Как я понял из прочитанного он не только отдаёт, но и принимает Entity


pro [12:43 PM]
ребят, пункт 3.2 в метод getAll() класса InMemoryMealRepositoryImpl нужно передавать userId (int) ?  или есть другое решение

ivanpobeguts [12:52 PM]
Ребят, подскажите дураку. Зачем нам нужен слой services? Там фактически такие же методы, как и у репозитория. Почему нельзя из контроллера сразу вызывать методы репозитория? Это же дублирование получается. Я понимаю, что дальше будет другая имплементация репозитория в виде бд, но это не меняет картины.


dmitry_ov [1 day ago]
Это каноническое разбиение на слои. *Большинство* приложений разбивают именно на эти слои.


Artem Murk [1 day ago]
Как я понимаю у нас слой сервиса отвечает за логику приложения, расчёты. Пока у нас логики особой нет, поэтому слой сервиса пустует.


dmitry_ov [1 day ago]
Как говорил Григорий: “если приложение на 5 классов, делить на такое количество слоев не нужно… это избыточно ”


Artem Murk [1 day ago]
Контроллер общается с клиентом, а слой репозитория общается с БД. Соответственно они просто передают какие то данные. В то время как сервис обрабатывает их.


ivanpobeguts [1 day ago]
Понял, спасибо.


Pavel Zaitcev [1 day ago]
Слой сервиса = работа с данными из 1/нескольких ДАО (или репозиториев) + некоторая бизнес-логика. Слой сервиса ничего не должен знать о тонкостях реализации доступа к данным, он должен только выполнять какие-то операции с этими данными. Более высокий уровень абстракции.  В нашем случае пока все довольно нетривиально, и выглядит избыточно поэтому.


Anton Kiselev [1:24 PM]
Подскажите, пожалуйста, инициализируем юзера мы просто в jsp? селектором с id 1 или 2? или через форму? или как? и как связан будет его id с Authorized.id?

Dmitry Neustupov [2:13 PM]
@Anton Kiselev в index.html через простую форму, затем в сервлете юзера устанавливаем id у авторизованого юзера и редиректимся на еду

Anton Kiselev [2:24 PM]
@Dmitry Neustupov Спасибо. Т.е полную форму пока не надо? с email, name и проч. Просто как ролями быть...

Dmitry Makarov [1 day ago]
>8: добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать *Select с двумя элементами со значениями 1 и 2* в index.html и AuthorizedUser.setId(userId) в UserServlet). *Настоящая атворизация будет через Spring Security позже*.


Dmitry Makarov [1 day ago]
на роли можно не обращать внимания


Aleksey Vra [2:33 PM]
Расставил аннотации, запускаю SpringMain, получаю bean MealRestController, вызываю у него методы, все работает.
Когда проделываю тоже самое в MealServlet, то InMemoryMealRepositoryImpl оказывается пустым. Подскажите, где может быть косяк?

Dmitry Makarov [1 day ago]
в сервлете достаешь MealRepository также как в SpringMain?


Aleksey Vra [1 day ago]
в SpringMain
```MealRestController mrc = appCtx.getBean(MealRestController.class);
            mrc.getAll(1).forEach(System.out::print);```
список еды у 1 юзера получаю.
тоже самое в MealServlet это не работает.


Aleksey Vra [1 day ago]
разобрался, у нас же в методе init инициализация
```repository = new InMemoryMealRepositoryImpl();```
убрал и заработало


Aleksey Vra [1 day ago]
выходит что repository перезаписывается так как все объекты singleton


Artem Murk [4:31 PM]
У меня вопрос по добавлению нового пользователя. Почему данный метод не должен возвращать null если пользователь с таким именем уже существует. ValidationUtil не обрабатывает null  Который прилетает от создания нового пользователя если имя уже существует. Или мы можем делать пользователей с одинаковым именем?

Dmitry Neustupov [23 hours ago]
По имейлу будет уникальность проверяться.


Artem Murk [23 hours ago]
Благодарю @Dmitry Neustupov


qf05 [4:36 PM]
Подскажите а зачем нам класс SpringMain только для тестирования, или у него ещё какая то задача?

Artem Murk [5:20 PM]
Я в нем тестирую, он нужен только для этого

Yevhen Maksymovych [10:18 PM]
ребят, подскажите, как мне в этой конструкции сделать "option checked", если ид совпадает с ид AuthorizedUser?
```    <select name="userId">
        <option value="1">1</option>
        <option value="2">2</option>
    </select>```
эта штука приходит по гету без параметров. сессиями мы ещё не пользовались
вытаскивать скриплетом - нехорошо

Grigory Kislin [10:19 PM]
@Yevhen Maksymovych я не парился

Yevhen Maksymovych [10:20 PM]
ну, т.е. если при активном юзере 2 мы зайдем на страницу users, и там будет 1 - для домашки пройдёт? не стоит заморачиваться?
главное чтобы при выборе список еды правильно отображался?

Grigory Kislin [10:22 PM]
тогда я не понял- думал ты про красивое отображение активного пользователя
`AuthorizedUser.set(id)`
точнее - вот это не понял: зайдем на страницу users, и там будет 1 (edited)

dmitry_ov [10:23 PM]
Что-то не пойму где хранить связь 
авторизованный юзер <->  еда
В Meal по условию хранить User нельзя. 
А где тогда хранить ? 
В User хранить List из Meals_id? (edited)

Grigory Kislin [10:23 PM]
на странице users отображаются все юзеры (edited)

Yevhen Maksymovych [10:24 PM]
не, я к тому, что мы заходим на вкладку юзер, выбираем там 2, жмём эплай, он попадает в сервлет, у авторизированного юзера меняется ид, список еды фильтруется в соответствии с выбранным юзером. но если мы после этого захотим опять сменить пользователя, и зайдём на стринцу юзеров, там будет в списке выбора гореть все равно 1 (при активном втором), если мы там нажмём эплай, первый станет опять ативным, и список опять отфильтруется верно

Grigory Kislin [10:24 PM]
@dmitry_ov еда хранится в общем репозитории (который у нас пока InMemory)

Yevhen Maksymovych [10:24 PM]
просто в листбоксе будет показан не активный юзер, а первый из оптионов

dmitry_ov [10:25 PM]
Это ясно. Вопрос: где хранить связь юзер--еда
Grigory Kislin
@dmitry_ov еда хранится в общем репозитории (который у нас пока InMemory)

Grigory Kislin [10:25 PM]
@Yevhen Maksymovych тогда см. 1 :slightly_smiling_face: (не парился)

Yevhen Maksymovych [18 hours ago]
ок, спасибо, тогда и я не буду :slightly_smiling_face:


Grigory Kislin [10:27 PM]
@dmitry_ov в этом собственно суть ДЗ 3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей

Yevhen Maksymovych [10:30 PM]
и ещё один вопрос, Григорий, прости, если надоедаю ))
"1.3: предусмотрите случай одинаковых User.name (порядок должен быть зафиксированным)."

dmitry_ov [10:30 PM]
Это тоже ясно.  Подсказка запрещает хранить ссылку на юзерв владельца  в модели meal

Подсказка:
2.1 В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность.


Вопрос в реализации:  Если нельяза (нет смысла) хранить user в meal, то где хранить связь этих двух сущностей ? 
В User добавить List<Meal> ?
Grigory Kislin
@dmitry_ov в этом собственно суть ДЗ 3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей

Yevhen Maksymovych [18 hours ago]
не запрещает


Yevhen Maksymovych [18 hours ago]
запрещает только обращаться к AuthorizedUser.id()


Yevhen Maksymovych [18 hours ago]
т.е. мы можем хранить в еде ссылку на пользователя ее создавшего, но не знаем, равен ли этот пользователь текущему


dmitry_ov [18 hours ago]
ок


dmitry_ov [18 hours ago]
Попробую так


Grigory Kislin [18 hours ago]
прочитай все ДЗ внимательно.
3.2: реализовать хранение еды для каждого пользователя можно с добавлением поля userId в Meal ИЛИ без него (как нравится). Напомню, что репозиторий один и приложение может работать одновременно с многими пользователями.


dmitry_ov [18 hours ago]
Прочитал и сделал так


dmitry_ov [18 hours ago]
Но потом посмотрел в подсказку…


Yevhen Maksymovych [10:34 PM]
так вот, по юзерам - исходя из того, что в возможность дублирования User.name нас специально ткнули пальцем, надо ли предполагать, что какое-то другое поле должно быть уникальным кроме id? Т.е. могут ли быть пользователи с одинаковым eMail? Надо ли нам при вставке новых пользователей в БД и изменении существующих проверять, что мы не создаём дублей с уже имеющимися совпадением имени и почтового адреса?

Dmitry Neustupov [10:51 PM]
@Yevhen Maksymovych когда прикрутится БД, будет уникальность по имейлу. Сейчас это не важно.

Yevhen Maksymovych [17 hours ago]
тогда не очень понятно, зачем нам знать об одинаковых User.name. Только для вторичной сортировки по id при выводе?


dustnfox [3 hours ago]
Насколько я понимаю - именно так. Чтобы при сортировке по неуникальному полю не забыли "досортировать" по уникальному :slightly_smiling_face:


Ilya [4:45 AM]
Поясните, пожалуйста, непонимающему за этот пункт -
3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду.

Т.е. изменения нужно пилить и на уровне сервлета и фронтовой части - откуда иначе можно узнать, какой именно юзер пытается сохранить/удалить/изменить еду ?
а то я что-то туплю с восприятием - чего хотят то

Alexander Sinayko [5:59 AM]
чуть ниже идет подсказка что это можно реализовать с userId и без. Обычно когда проектирует такие приложения это все хранится в таблицах БД. Таблицы связаны через foreign key. Добавьте в meal переменную int userId и заполняйте ее в соответсвии какой юзер сделал запись. Отображать так же если meal.userId совпадает с user.getId()

Ilya [6:28 AM]
@Alexander Sinayko да, уже запилил. Спасибо большое за коммент!

Andrew [7:01 AM]
А почему используется Set<Role>, разве чтобы определить роль юзера просто поля Role недостаточно ?

Ilya [7:15 AM]
@Andrew У админа две роли в демо приложении ROLE_USER,ROLE_ADMIN . Наверное с целью, что вдруг ты из обычного юзера за заслуги захочешь админа сделать и тп

Yevhen Maksymovych [8:14 AM]
ребят, вопрос по спрингу: судя по логам при запуске приложения, контекст спринга инстанциируется и без моего участия при старте приложения. Сталобыть, его можно как-то получить, не вычитывая заново из xml?

qf05 [10:20 AM]
"6.1: учесть, что когда будем работать через Spring MVC, MealServlet удалим, те вся логика должна быть в контроллере."
Подскажите, надо/можно ли сейчас передавать в контроллер request, или это надо как то по другому делать?

Pavel Zaitcev [5 hours ago]
Сейчас в MealServlet должна быть только логика обработки запросов, и взаимодействие с контроллером. Никаких расчетов, преобразований дат и т.д. Все это должно происходить в контроллере. Когда перейдем на MVC, будем использовать DispatcherServlet и мапить запросы на контроллер. Вот тогда и могут возникнуть проблемы, если у тебя  сервлет занимался лишними вещами. В MealRestController сейчас, соответственно, никаких запросов обрабатывать не нужно. Мы просто взаимодействуем с сервисным слоем и делаем необходимые преобразования для этого.


qf05 [5 hours ago]
То есть  в  MealServlet мы достаем из request параметры и их отправляем на обработку в MealRestController ?


dmitry_ov [11:18 AM]
Если пользователь не указан, какую еду нужно вернуть из контроллера на запрос без параметров ?
Просто всю еду вернуть какая есть в репозитории ?

“5: Реализация ‘MealRestController’ должен уметь обрабатывать запросы:
5.1: Отдать свою еду (для отображения в таблице, формат List<MealWithExceed>), запрос БЕЗ параметров” (edited)

Yevhen Maksymovych [5 hours ago]
Нет, пользователь есть всегда. Если его вдруг нет потому что он не валидный - возвращаем пустой лист


dmitry_ov [5 hours ago]
Тогда в условии противоречение.
Показывать еду можно только владельцу. 
А т.к. запрос всей еды *без параметров*, а значит без владельца, то показывать впринцыпе будет нечего


dmitry_ov [5 hours ago]
5.1: Отдать свою еду (для отображения в таблице, формат List<MealWithExceed>), запрос БЕЗ параметров


dmitry_ov [5 hours ago]
Вот эти нестыковки тз очень раздражают. Курс обещал познакомить с технологиями. А вместо этого занимаешься телепатией((


Aleksei Kirillov [5 hours ago]
Написано: 8. добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать Select с двумя элементами со значениями 1 и 2 в index.html и AuthorizedUser.setId(userId) в UserServlet). Настоящая атворизация будет через Spring Security позже.
Т.е. инициализируешь значением 1 + делаешь в index.html переключение между пользователями. (edited)


dmitry_ov [5 hours ago]
@Aleksei Kirillov погоди ты п.8
Сейчас речь о п.5


Yevhen Maksymovych [5 hours ago]
откуда противоречие? после добавление в мил userId, у тебя все методы репозитория принимают userId в качестве второго параметра. соответственно, getAll() у тебя превратится в getAll(int userId)


Yevhen Maksymovych [5 hours ago]
т.е. он в любом случае придёт, если такого userId нет в базе, у тебя вернется пустой лист

dmitry_ov [5 hours ago]
@Yevhen Maksymovych все так

Yevhen Maksymovych [5 hours ago]
исходя из того условия, которое тебе говорит, что если надо вернуть лист, а получается нулл - возвращаем пустой лист


dmitry_ov [5 hours ago]
в контроллере должен быть метод, у которого нет параметров. метод должен вернуть чью-то еду, чью именно без параметра userId не узнать

5.1: Отдать свою еду (для отображения в таблице, формат List<MealWithExceed>), запрос БЕЗ параметров


Yevhen Maksymovych [4 hours ago]
да все понятно же

Yevhen Maksymovych [4 hours ago]
у тебя в слое веб доступен AuthorizedUser.id()

Yevhen Maksymovych [4 hours ago]
и в контроллер ты его и передаешь


Yevhen Maksymovych [4 hours ago]
ты ниоткуда из запроса userId не берёшь


dmitry_ov [4 hours ago]
ok. 
Реализую метод, обращаюсь в сервис за едой - getAll.
userId в контролер не пришел, что в getAll сервиса передвать ? (edited)


Yevhen Maksymovych [4 hours ago]
только из AuthorizedUser в слое веб

Yevhen Maksymovych [4 hours ago]
да не может он не прийти в контроллер. ты в MealResstContoller пользуешь везде, где надо передавать в службу MealService userId - AuthorizedUser.id()


Yevhen Maksymovych [4 hours ago]
если его там по какой-то причине нет - не твоя забота

dmitry_ov [4 hours ago]
т.е. запрос в контроллер приходит без userId, а за userId идем в  AuthorizedUser.id()?


Yevhen Maksymovych [4 hours ago]
да, верно

dmitry_ov [4 hours ago]
понял

dmitry_ov [4 hours ago]
@Yevhen Maksymovych Спасибо. Прояснил) (edited)


Yevhen Maksymovych [4 hours ago]
Абстракция, ёпта ))))


Aleksei Kirillov [4 hours ago]
По этому есть еще один пункт: 2.1: В Meal, которая приходит в контроллер нет никакой информации о пользователе (еда приходит в контроллер БЕЗ user/userId). Она может быть только авторизованного пользователя, поэтому что-то сравнивать с ним никакого смысла нет. По id еды и авторизованному пользователю нужно проверить ее принадлежность. (edited)


Vladimir Gorbatenko [3:29 PM]
Всем приветы! Как-то много у меня вопросов с этим заданием. 
Например как понимать "2: сделать Meal extends AbstractBaseEntity, MealWithExceed перенести в пакет ru.javawebinar.topjava.to (transfer objects)"? 
1) К Meal прикрутить AbstractBaseEntity. Изменить конструктор с учетом super(id). 
2) Создать пакет "to" и в него перенести MealWithExceed. 
Так? (edited)

dmitry_ov [3:32 PM]
так

dmitry_ov [4:00 PM]
Какое поведение системы должно быть если юзер меняет еду которая ему не принадлежит ?
Бросаем из сервиса NotFoundException ?


2.3: Проверьте сценарий: авторизованный пользователь пробует изменить чужую еду (id еды ему не принадлежит).


roma [5:19 PM]
uploaded and commented on this image: image.png 

Почему он не видит этого метода?
dmitry_ov [5:20 PM]
Потому что переменная repository не была определена

roma [5:20 PM]
Там же есть метод
```public static <T> T checkNotFoundWithId(T object, int id) {
        return checkNotFound(object, "id=" + id);
    }```
хм )

roma [5:23 PM]
@dmitry_ov Ты имеешь ввиду
```private MealRepository repository = new InMemoryMealRepositoryImpl();```
(edited)

dmitry_ov [1 day ago]
Да. Переменная описана, но не связана ни с каким объяектом.


roma [5:25 PM]
он же пишет что не может найти метода с такой сигнатурой - или я чего то не понимаю?

Aleksey Vra [5:26 PM]
так и есть, проверь сигнатуру))
и название метода)

roma [5:27 PM]
)))))))))))
спасибо
я думал они отличаютя только атрибутами )
не пригляделся )

Aleksey Vra [5:28 PM]
вот счас тоже самое делаю, методы похожие, путаюсь)

roma [5:28 PM]
Спаибо - еще раз )
Там промежуточные методы (те что id в стринг превращают и тп) надо бы сделать private - что бы не мешались )

Vladimir Gorbatenko [7:07 PM]
Я что-то вообще не могу понять что делать начиная с пункта 3...  Совершенно не понимаю... 10 раз перечитал задание...  Добавил приватное поле userId в Meal и его конструктор . И все... Растолкуйте пожалуйста.

dmitry_ov [1 day ago]
Полистай историю. Уже многие спрашивали. Я в том числе. Формулировка ДЗ тот еще адЪ (edited)


Aleksey Vra [1 day ago]
Мне помогло выполнение пунктов с конца и не по пунктам вовсе, а лишь представив общую картину.. по-моему ТЗ расписано через чур подробно, отсюда путаница. Возможно если было бы короче, было бы понятней (edited)


roma [1 day ago]
Ну а дальше в методы InMemoryMealRepositoryImpl ты должен передавать помоимо мила еще и айдишник юзера и там чтобы вернуть нужное значение - проверять относится ли еда к этому пользователю или нет (edited)


dmitry_ov [1 day ago]
Мне помогло объяединить дз и подсказки в 1 список. 
Идешь по этому списку и делаешь. 
Как то более менее продвигаюсь. Периодически что-то здесь в hw2 спрашиваю


Aleksey Vra [1 day ago]
ну вот мне в JR не нравилось в больших задачах когда описывают в задании не логику, а мелкие пункты..
сложно, когда не видно целостной картины


roma [7:07 PM]
5 сек
у меня вот другой вопрос )

Grigory Kislin [7:16 PM]
> Формулировка ДЗ тот еще адЪ
буду очень признателен (+5 бонусов) тому, кто сможете упростить формулировку, чтобы было понятнее

roma [7:16 PM]
вот такая фигня -
```     public Meal save(Meal meal, Integer userId) {
       return ValidationUtil.checkNotFoundWithId(repository.save(meal,userId),meal.getId());
    }```
не будет работать при создании новой еды не тем пользователем если в репозитории у нас такая фигня
```    public Meal save(Meal meal,Integer userId) {
        if(meal.getUserId()!=userId)
        {
            return null;
        }.....```
так как мы не успиваем заСетить meal_id и пойдем в метод
```ValidationUtil.checkNotFoundWithId(T object, int id)```
со вторым атрибутом равным null - и словим NPE - это нормально??? (edited)

Artem Murk [7:16 PM]
Привет народ. У меня вопрос по MealUtil. Я сам подабаалял методы которые возвращают коллекцию между датами и временем. Так надо было, или у меня плохо патчи легли?

roma [7:18 PM]
нужно было самому помоему создавать - только в DateTimeUtil (edited)

dmitry_ov [7:23 PM]
@Grigory Kislin
Основная проблема этого ДЗ, отсутствие road map c контрольными точками. Нужно понимать после какого пункта, что долно быть в проекте. Ибо наступает момент когда какой то следующий раздел ДЗ, вынуждает переделать то что уже есть.  И возникает мысль: “а в том ли направлении я иду ?” *А свериться то не с чем*

Предлагаю добавить эти самые контрольные точки по ходу выполнения ДЗ, а так же тесты для проверки.
Контрольные точки:  Например добавить интерфейсы которые должны получится в конце (без реализации конечно) MealRepository, MealService, список методов  в MealRestController который должен быть на выходе.

По MealRepository до сих пор не понимаю, там  2 метода нужны
1.Collection<Meal> getAll(Integer userId);
2. Collection<Meal> getAll(Integer userId, LocalDate dBegin, LocalDate dEnd, LocalTime tBegin, LocalTime tEnd);

Или можно обойтись каким-то одним.

Тесты:
Сейчас один кейс есть в ДЗ 
“2.3  Проверьте сценарий: авторизованный пользователь пробует изменить чужую еду .” Надо больше таких и желательно в java коде.

Нужно смотреть на то как будет вызыватся контроллер, сервис и что ждать в ответ. 
Это очень прояснит. (edited)
Grigory Kislin
> Формулировка ДЗ тот еще адЪ
буду очень признателен (+5 бонусов) тому, кто сможете упростить формулировку, чтобы было понятнее
@Grigory Kislin Но как вы сами наверное уже догадались,  надо этот урок разбивать минимум на 2 части, а еще лучше на 3.
Ну коль из 128 человек, 1 чел пишет что нормально. можно так и оставить :wink:
roma
блин нормальный урок )
Странно что в эту группу вообще кто-то пишет, если урок ни у кого трудностей не вызвал) (edited)

Artem Murk [7:27 PM]
Да есть рабочие моменты, на то она и группа

Alex83 [7:27 PM]
{
       MealsUtil.MEALS.forEach(this::save);
}

mila [1 day ago]
почему? просто метод референс на метод save в этом же классе


Alex83 [7:27 PM]
не могу понять

Alex83 [7:28 PM]
это конструктор?

dmitry_ov [1 day ago]
Это инициализатор. Есть такая штука в Java. Выполняется при создании экземпляра класса


Alex83 [1 day ago]
Чем отличается от конструктора? )


Grigory Kislin [1 day ago]
в уроке же есть вопрос и ответ


Alex83 [7:28 PM]
просто скобки без названия функции

roma [1 day ago]
Это ты вызываешь метод сейф в этом же классе и передаешь туда каждый мил из  списка милов


roma [1 day ago]
{} - это блок инициализации класса - так же бывает статическим :wink:


Alex83 [1 day ago]
@roma понял, как статик блок, только не статик )


roma [1 day ago]
ага )


dustnfox [1 day ago]
Не знаю можно ли сюда кидать книги. Если это не рассматривается как вопиющее нарушение авторских прав, то могу бросить сюда PDF. Возможно, @Grigory Kislin подскажет. В Thinking in Java достаточно ясно и понятно описывалось. Суть в том что этот блок вызывается ДО конструктора при создании объекта и позволяет выполнять действия общие для всех конструкторов объекта.


Grigory Kislin [1 day ago]
@dustnfox ну, если `нарушение авторских прав` заботит- тогда давай в личку


dustnfox [1 day ago]
@Grigory Kislin Да, не. :slightly_smiling_face: Меня-то совершенно не заботит. Тем более, что она на английском а купить ее в таком виде в РФ невозможно. То есть ни у кого в РФ хлеб мы тем самым не отбираем. В общем, кому нужно могу кинуть `Thinking in Java 4th edition`. Пишите в личку. Копия изначально цифровая. Язык: английский. 
Хотя и нагуглить ее совсем несложно :wink:


dmitry_ov [7:28 PM]
Все так. Но @Grigory Kislin говорит, что если вы за время стажировки разовьете навык общения в слаке, где вам одногрупники помогают - работать не сможете.  А именно этот навык я развиваю последние 3 дня))) (edited)
roma
но преодоливаемые - тем более вместе - вот поэтому сюда и пишем

Alex83 [7:37 PM]
@roma скорее на топ джаве 15. 14-я летом, там отпуск и куча других интересных дел )

dmitry_ov [7:37 PM]
@roma Ты студент ? У тебя есть время проходить курс несколько раз ? Рад за тебя.
@roma Давай не будем флуд разводить. У меня основатель спросил что можно сделать лучше, я свое мнение озвучил. Чего его обсуждать. Тем более здесь. Тут про HW2 пишут

roma [7:39 PM]
согласен давай потрем ) все что выше и не по делу )

Alex83 [7:42 PM]
UserUtil нужно делать по аналогии с MealsUtil?

Alex83 [7:42 PM]
откуда список юзеров брать?

roma [1 day ago]
ну я захардкодил прямо в InMemoryUserRepositoryImpl


roma [1 day ago]
но чисто для роверки методов что все правильно возвращаетя


Alex83 [1 day ago]
нашел ответ в форке уже прошедшего чела )


Alex83 [1 day ago]
надо )


roma [1 day ago]
ок


Ma3stro [7:43 PM]
Хорошо, добавили userId в Meal. Идем обратно в репозиторий Meal: у нас мапа со всей едой. Нам дальше с ней работать? Т.е. тоже общий список еды, только у каждой записи еды еще есть его юзер?

roma [1 day ago]
дальше ты в атрибуты методов InMemoryMealRepositoryImpl должен передавать не только Meal а еще что то ) (edited)


Ma3stro [1 day ago]
@roma Да, понятно, что в атрибуты нужно передавать еще и userId. Но теперь не совсем понятно, как реализовать метод delete например (edited)


Ma3stro [1 day ago]
```@Override
    public void delete(int id, int userId) {
        if(repository.get(id).getUserId() == userId)
            repository.remove(id);
    }```
Такая реализация будет правильной? (edited)


roma [1 day ago]
только из репозитория нужно не войд возвращать


roma [1 day ago]
глянь что возвращает аналогичный метод в юзер репозитории


roma [1 day ago]
а так логика помоему нормальная


Grigory Kislin [7:50 PM]
@dmitry_ov я тоже за конструктивный диалог. основной тест- выделен жирным в начале- составленное api должно выполнять все, что есть в демо приложении. там не так много- CRUD+фильтрация.
на тему разбить- следующие уроки также насыщенные да и темы тут логически одна. и время у нас - 3.5 месяца а не полгода..
контрольные точки- это код, того, как я это реализовал? те дать часть решения? (edited)

dmitry_ov [1 day ago]
контрольные точки- это код тестов, 
которые обращаются через интерфейсы к итоговому решению.
По этому коду можно понять какой интерфейс должен быть на выходе и какое поведение ожидается. (edited)


dmitry_ov [1 day ago]
Передавать готовое решение, конечно, не надо.


Grigory Kislin [1 day ago]
1. JUnit у нас будет позже... 
2. `обращаются через интерфейсы`- так интерфейсы таки надо дать, которые необходимо сделать?
3. какое поведение ожидается лучше все таки в ТЗ давать. что собственно я делаю


Grigory Kislin [1 day ago]
можно как вариант, в подсказках дать получаемые инерфейсы, хотя это таки часть ДЗ


dmitry_ov [1 day ago]
> 2. `обращаются через интерфейсы`- так интерфейсы таки надо дать, которые необходимо сделать?
Да.


Grigory Kislin [1 day ago]
можно попробовать.. чтобы было с чем сверять


Grigory Kislin [7:52 PM]
API- собственно в Подсказки 5 они и указаны (edited)


Alex83 [7:53 PM]
private Map<Integer, User> repository = new ConcurrentHashMap<>();
не могу понять, где заполняется мапа?

Grigory Kislin [1 day ago]
заполни, как тебе кажется правильно


Ma3stro [1 day ago]
@Grigory Kislin, тогда какая сейчас связь между id юзера и AutorizhedUser.id()? У нас же в авторизованном всегда 1 возвращает: как нам вызывать методы круда для юзера №2, если мы в контроллере будем вызывать методы с userId = Авторизованному юзеру (1)?


Grigory Kislin [1 day ago]
если в контроллере useId=1 (авторизованный),  то в сервисах и репозитории он не должен быть 2 никак. только 1 (edited)


roma [1 day ago]
8: добавить выбор текущего залогиненного пользователя (имитация авторизации, сделать Select с двумя элементами со значениями 1 и 2 в index.html и AuthorizedUser.setId(userId) в UserServlet). Настоящая атворизация будет через Spring Security позже.


roma [1 day ago]
после этого если ты контроллер сделал правильно в пункте 4 то - все будет хорошо


Aleksey Vra [7:54 PM]
>4: Проверку isBetweenDate сделать в DateTimeUtil. Попробуйте использовать дженерики и объединить ее с isBetweenTime
кто нибудь дайте пожалйста маленькую подсказку как сделать через дженерики

aleksey [1 day ago]
LocalDate и LocalaTime имплементят Comparable, вот на основе него и пили дженерик (edited)


Aleksey Vra [1 day ago]
ок, спасибо, попробую


Alex83 [7:54 PM]
по save идет put?
все понял
в блоке идет сейв всего листа
в сейве пут в мапу

Ma3stro [7:59 PM]
replied to a thread:

@Grigory Kislin, тогда какая сейчас связь между id юзера и AutorizhedUser.id()? У нас же в авторизованном всегда 1 возвращает: как нам вызывать методы круда для юзера №2, если мы в контроллере будем вызывать методы с userId = Авторизованному юзеру (1)?
Пытаюсь разобраться с ТЗ

roma [8:14 PM]
Кто то из сторожил может мне ответит?
вот такая фигня -
``` public Meal save(Meal meal, Integer userId) {
return ValidationUtil.checkNotFoundWithId(repository.save(meal,userId),meal.getId());
}```
не будет работать при создании новой еды не тем пользователем если в репозитории у нас такая фигня
``` public Meal save(Meal meal,Integer userId) {
if(meal.getUserId()!=userId)
{
return null;
}.....```
так как мы не успиваем заСетить meal_id и пойдем в метод
```ValidationUtil.checkNotFoundWithId(T object, int id)```
со вторым атрибутом равным null - и словим NPE - это нормально???

Grigory Kislin [8:18 PM]
@roma 1. NPE - это всегда ненормально.
2. создании новой еды не тем пользователем- а это как:)? авторизированный пользователь может только свою еду создавать (edited)


roma [8:32 PM]
Вот это хороший вопрос ))) - ответ никак )... я просто сначала в mealForm.jsp терял userId, так как забыл его туда добавить ) - вот и столкнулся с этой ошибкой, когда пользователь c id=1 пытался создать еду с userId = null и вылетал в этом месте кода с NPE... - если в форме userId не терять то не придти в репозиторий с другим userId... спасибо ) (edited)

Alex83 [8:46 PM]
3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду.
прочитал раз 5

Alex83 [8:46 PM]
можно пояснить, что нужно сделать?

dustnfox [1 day ago]
Это значит что ВСЯ еда лежит в одной структуре данных (List, Map etc.), но задизайнена система должна таким образом чтобы юзер запросивший по ID (можно через HTTP запрос прислать любой ID) еду принадлежащую другому пользователю получал null/false вместо данных о чужом обеде. Как вариант предлагается добавить в Meal класс поле userId указывающее на владельца. После этого зная id пользователя делающего запрос можно предотвратить ситуацию получения объекта с чужим userId.


Alex83 [1 day ago]
@dustnfox спасибо


Grigory Kislin [1 day ago]
@Alex83 можешь изменить текст 3. чтобы было понятно с первого раза, что требуется? желательно покороче и не раскрывая детали реализации? Или было понятно что, но непонятно как? (edited)


Alex83 [1 day ago]
@Grigory Kislin есть ощущение, что нужно местами поменять пункты 3.2 и 3.1


Grigory Kislin [1 day ago]
ок. а читал сверху жирно- Перед началом выполнения ДЗ (ели есть хоть какие-то сомнения) прочитайте ВСЕ ДЗ. Если вопросы остаются- то ВСЕ подсказки ?


Alex83 [8:49 PM]
3.1: если по запрошенному id еда отсутствует или чужая, возвращать null/false (см. комментарии в UserRepository)

Alex83 [8:49 PM]
о каком классе идет речь?

roma [1 day ago]
Речь идет о интерфейсе UserRepository


roma [1 day ago]
В нем есть фактически шаблон - какие методы тебе нужны в интерфейсе MealRepository только не забывай что во вех этих методах у тебя будет еще один атрибут userId (edited)


Alex83 [1 day ago]
@roma То есть в Meal добавить userId, а  потом в InMemoryMealRepositoryImpl проверять чтобы getall возвращал только еду этого юзера?


roma [1 day ago]
ага и других методах тоже проверять user id прежде чем делать изменения в в нашем хранилище данных


Alex83 [1 day ago]
@roma понял, благодарю


roma [1 day ago]
не за что )


Alex83 [1 day ago]
@roma а где userId сетится будет?

Alex83 [1 day ago]
в какой момент?


roma [1 day ago]
Ну тебе нужно будет немного поправить констукторы Meal


roma [1 day ago]
и дальше ты полетишь в свой репозиторий из метода doPost в MealServlet c Милом, в котором уже будет userId добавленный через конструктор, используя класс AuthorizedUser


roma [1 day ago]
PS когда ты сделаешь конструкторы в Миле - просто иди в MealServlet - IDEA тебе все объяснит :wink:


roma [1 day ago]
@Alex83 разобрался?


Alex83 [1 day ago]
@roma пока смутно понимаю


roma [1 day ago]
@Alex83 спрашивай - разберемся


roma [9:08 PM]
Почему мы в сервисе UserService - разделили наш красивый метод репозитория save на create и update ? (edited)

Grigory Kislin [9:32 PM]
в rest принято create/update. в репозитории- только save (edited)
*добавил в подсказки свои реализации интерфейсов Meal и методов контроллера*
те. часть решения. прошу высказать мнения - нужно или это уже слишком:)

Yevhen Maksymovych [9:37 PM]
слишком, вся интрига пропадает :slightly_smiling_face:

Aleksey Vra [9:38 PM]
считаю, что решение выкладывать вообще не вариант, обучение насмарку

VictorStatko [9:38 PM]
+

Grigory Kislin [9:43 PM]
ок, тогда сделаем в личку:)

Grigory Kislin [9:49 PM]
теперь так: Если с ДЗ большие сложности, можно запросить мои Meal интерфейсы для сверки у меня в личке.

dmitry_ov [1 day ago]
эх.. на проверку уже отправил


Grigory Kislin [1 day ago]
ну, я тоже думаю, что лучше таки самому сделать


Sergey Kubatko [1 day ago]
согласен, тоже отправил на проверку, посмотрим, что девушки скажут и будем править


Mikhail Makar [11:15 PM]
Позвольте вставить свои 5 копеек!
Когда я первый раз читаю требования к дз, то многое не понимаю, но это не проблема составителя, а скорее моя, так как с таким ещё не сталкивался, но в разборе я и считаю, что происходит прогресс и прокачка скилс.
К тому же нам нужно учитывать тот факт, что ТЗ нам составил разработчик, а в реальной жизни при общении с клиентом вряд ли он скажет, что Вам нужен такой-то класс и т.д.)))
Путь тернист и сложен, но преодолим))

З.Ы. Считаю, что если ты читаешь требования и тебе всё понятно, то уже нет вызова, чтобы разобраться)) Как-то так, всем успехов в освоении материала!)

realcorwin [11:48 PM]
>3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду.

Если по-русски переписать:

3. Изменить MealRepository и InMemoryMealRepositoryImpl таким образом, чтобы вся еда всех пользователей находилась в одном общем хранилище, но при этом каждый конкретный авторизованный пользователь мог видеть и редактировать только свою еду.

realcorwin [11:54 PM]
>*добавил в подсказки свои реализации интерфейсов Meal и методов контроллера*
те. часть решения. прошу высказать мнения - нужно или это уже слишком:)

Это очень правильно. Единственное: если есть возможность выкладывать информацию в виде спойлера (когда информацию можно по желанию открыть или скрыть), то лучше так и делать, не вводя во искушение тех, кто эти подсказки видеть не хочет.

roma [12:45 AM]
Мне бы еще пиццу кто приносил, когда я занимаюсь в topjava - а то вот допилил 8 заданий к 1.40 ночи и проголодался - но лучше так, что бы те кто голоден и все еще пилит - не видели как я ее ем - что бы не было искушения меня убить...

realcorwin [1:06 AM]
> Это очень правильно.

Наверно, надо пояснить, почему. Наставник должен указывать дорогу. То, что ученик как-то решит сам, это понятно. Но при этом велик шанс получить *овно-код. А лучше сразу учиться писать правильно, чтобы этому в итоге и научиться.

Grigory Kislin [22 hours ago]
мое мнение:
1. надо научиться писать хоть както
2. затем учиться писать правильно
для этого необходимо делать ДЗ и затем самое оптимальное- отдавать на проверку. тебе все твои ошибки укажут
более долгий путь- сверять свое решение с моим в начале занятий.
сильно хуже- если давать готовые решения. тогда будет иллюзия что умеешь писать код. 
но для сверки своего уже готового решения- это вариант


Jan [1:29 AM]
Подскажите scope = "session" можно в hw2 использовать ? В hw1 было явно указано что НЕТ.

Grigory Kislin [22 hours ago]
если хочется- то можно. я не использую


Jan [21 hours ago]
У нас сессионность избегается из-за избыточности в первых 2 заданиях или просто чтобы не усложнять слишком простые вещи ?


Zhivchik [9:33 AM]
Подскажите, для запуска приложения в браузере нужно опять писать Main-класс или можно каким то образом запустить из SpringMain.

Fedor [1 day ago]
Нужно в конфигурации выбрать Tomcat, и запускать на нем


Zhivchik [1 day ago]
Спасибо.


dustnfox [10:08 AM]
Подскажите. Что значит _5.6: В REST при update принято передавать id (см. AdminRestController.update)_ ? Никак я не пойму смысл этого всего. Ведь при вызове `MealRestController.update` сервлет кладет один и тот же `request.getParameter("id")` в `Meal.id` и во второй параметр метода `update`.  Зачем нам так делать? Или же это просто convention и для нас большого смысла это не имеет? (edited)

Dmitry Makarov [1 day ago]
в http запросе put параметр можно указать как в теле так и в url, id из тела будет попадать в Meal meal, из url в int id (edited)


dustnfox [1 day ago]
@Dmitry Makarov Указать-то, конечно, можно. Только зачем нам два id (один в теле POST другой в URL)? (edited)


qf05 [1 day ago]
Да, хотелось бы больше подробностей по данному вопросу.

Возможно, как я понял, так просто принято, так как в каких то больших реализациях нам в этот метод прилетает id из каких то далёких далей и по нему что то проверяется.


dustnfox [1 day ago]
Я так понял, что это просто такое соглашение. Например entity/DTO может не содержать в себе ID (не наш случай). Если так, тогда понятно.


Grigory Kislin [22 hours ago]
в REST стиле -  такое соглашение. мы rest подробее позже  будем смотреть


mila [12:49 PM]
а какая логика должна быть у методов save (create update)? userId при создании новой еды на каком этапе должен устанавливаться?

Yevhen Maksymovych [1 day ago]
в MealRestController'е у тебя доступен AuthorizedUser.id(). Там ты его берёшь, передаёшь в MealService, а он дальше по цепочке в MealRepository (edited)



mila [1 day ago]
а почему его нельзя сразу в контроллере установить? я щас только про создание новой еды


mila [1 day ago]
про delete, get и т.д. понятно что надо тащить через сервис в репозиторий


Yevhen Maksymovych [1 day ago]
в принципе можно, но мне кажется чисто идеологически, userId - это свойство доменной сущности Meal, а контроллер больше как-то оперирует dto, и даже то что мы мил собираем на стороне контроллера как по мне не очень красиво


Yevhen Maksymovych [1 day ago]
но я не настоящий сварщик, можно и в контроллере мил собрать уже с юзерид )


mila [1 day ago]
ну да, если уж мы его там собираем зачем разбивать эту сборку и тащить по частям чтоб потом в месте назначения ещё дособрать


aleksey [1 day ago]
userId нужно сеттить в репозиторий. Сеттить в контроллере не очень корректно, его реализация может измениться, тогда получится что репозиторий работает некорректно и вносит в базу данные с некорректный userId


mila [24 hours ago]
ну он не то что сетится в контроллере, он участвует в непосредственном создании мил в конструкторе наравне с остальными полями, тогда где вобще должен создаваться мил?


mila [24 hours ago]
и + мне понравилась идея сделать его тоже final, в этом случае его не засеттить в репозитории


aleksey [24 hours ago]
На мой взгляд, независимо от того где должен создаваться meal, в репозитории он должен сетиться из userId. Предположим у нас есть еще один сервис, который обращается к этому репозиторию, как мы будем поступать в ситуации когда нам пришел meal с одним userId, а в параметре в репозитории другой userId?


aleksey [23 hours ago]
Хотя тут, конечно, все зависит от того, как такую ситуацию обрабатывать. Так что можно делать final userId и просто не обрабатывать те запросы где userId не совпадают.


Grigory Kislin [22 hours ago]
у меня реализация без Meal.userId. устанавливать некуда. когда JPA и JDBC будем делать, тоже в контроллере user не установить никуда.


alexey [1:17 PM]
Народ подскажите, а фильтрацию (даты,время) в сервлет через POST надо передавать?

Yevhen Maksymovych [1 day ago]
я через пост передавал


alexey [1 day ago]
не совсем понятно тогда как в сервлете отделить этот POST от того который создает еду!? или нужен новый сервлет? запутался уже!


Yevhen Maksymovych [1 day ago]
я кнопку обозвал "filter", и проверяю, если в реквесте она пришла - значит фильтруем, если не пришла - значит добавляем еду


Pavel Zaitcev [1 day ago]
Я делал через GET. Принципиальной разницы нет. В doGet вытаскиваю параметры, передаю в контроллер. (edited)


Dmitry Makarov [1 day ago]
Тоже через гет сделал


Artem Murk [1 day ago]
Я тоже через get делал. Мне шифровать эти данные не надо. (edited)


alexey [1 day ago]
через GET это <form method="GET" action="meals?action=filter">


alexey [1 day ago]
и submit-ом передаем?


Pavel Zaitcev [1 day ago]
Нет. Сделай форму `<form action="meals" method="get">`, и, например `<input...value="beginDate">`.  А в сервлете доставай: `String beginDate = request.getParameter("beginDate");` (edited)


Pavel Zaitcev [1 day ago]
Конечно же `name="beginDate"` в input не забудь. Именно по нему ты проверяешь имя параметра в реквесте.


Pavel Zaitcev [1 day ago]
`value="beginDate"` - это образно, в качестве примера. Там будет собственно значение.


Grigory Kislin [22 hours ago]
post передает данные в теле запроса, get в параметрах. для фильтрации разница будет в url. вообще для отправки данных из формы обычно принято post использовать


Artem Murk [1:34 PM]
Ура, HW2 done. Даже есть время подучить до четверга сервлеты и фронт, а то вообще паскудно будут выглядеть моя морда))) (edited)

realcorwin [2:11 PM]
Поздравляю :slightly_smiling_face:. Я ещё даже не начинал :slightly_smiling_face:. Работа...

Artem Murk [1 day ago]
Спасибо. У меня такая же ситуация с работой была когда проходил hw1. Доделывал уже после выхода второго урока


Джони [2:34 PM]
Народ, подскажите, после накатки патчей некоторые строчки помечены красным, не могу догадаться в чём может быть причина....

Grigory Kislin [22 hours ago]
попробуй обновить зависимости maven:
https://github.com/JavaOPs/topjava/wiki/IDEA#%D0%9E%D0%B1%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C-%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8-%D0%B2-maven-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5


Джони [2:34 PM]
uploaded this image: изображение.png 


Джони [2:36 PM]
uploaded and commented on this image: изображение.png 

ну и вот ещё...

Artem Murk [2:48 PM]
В Pom.xml зависимость прописал? @Джони

Джони [3:13 PM]
похоже где то галочки не проставил... но везде стоят вроде. о_О
Artem Murk
В Pom.xml зависимость прописал? @Джони

Джони [3:13 PM]
uploaded this image: изображение.png 


Artem Murk [3:29 PM]
Странно, jstl библиотеку точно прописывал в зависимостях? У тебя она не находится. @Джони
Что подсказывает Идея подчёркивая project. Теги закрыты все? (edited)

alexey [3:37 PM]
Подскажите пожалуйста, а при фильтрации, в контроллер из репозитория должен приходить отфильтрованный Meals или MealsWithExceeded?

Artem Murk [24 hours ago]
А слой сервиса?


Artem Murk [24 hours ago]
У меня фильтрует коллекцию Meal, и преобразовывает в MealWithExceed. Это все делает MealUtil. В репозитории конечно же лежат Meal


alexey [24 hours ago]
у меня она в контроллере преобразовывается и некоторые превышения загораются зеленым хотя должны гореть красным.


alexey [24 hours ago]
слой сервиса не забыл, просто не упомянул

Artem Murk [24 hours ago]
Тоже в контроллере. Все нормально. Ты не менял MealUtil?

alexey [24 hours ago]
в репозитории фильтрую и получаю List<Meal>, дальше в сервис, и в контроллер , а с контроллера на выходе получаю List<MealsWithExeeded>. нет ничего не менял.


Artem Murk [23 hours ago]
Тогда дебаж, только так к сожалению.


Джони [3:44 PM]
uploaded and commented on this image: изображение.png 

@Artem Murk

Джони [3:48 PM]
И кстати, я ничего не прописывал. Только патчи накатил и томкат с мавеном подтянул.

Artem Murk [23 hours ago]
Почисть проект clean


Artem Murk [23 hours ago]
И перепакуй


Artem Murk [23 hours ago]
И перезагрузи потом зависимости


Джони [23 hours ago]
спасибо, ща попробую


Джони [20 hours ago]
удалил .idea , потом запустил поновой, обновил maven и это помогло...


Yevhen Maksymovych [3:58 PM]
ребят, кто-нибудь разобрался со стримами ну вот прямо совсем хорошо?

Artem Murk [23 hours ago]
Совсем хорошо нет, но озвучь идею, может есть кто и поможет


Yevhen Maksymovych [23 hours ago]
есть некоторый List<Entity>. У этой энтити есть ряд реквизитов. Надо разбить лист на сублисты, по трём реквизитам этой энтити. Т.е. если хотя бы один из реквизитов отличается - пихать его в новый лист


Yevhen Maksymovych [23 hours ago]
т.е. что-то вроде такого:
```service.getByCustomerContains(customer).stream()
                .collect(Collectors.groupingBy(Order::getCustomer, Collectors.groupingBy(Order::getBirthDate, Collectors.groupingBy(Order::getPhone))));```


Yevhen Maksymovych [23 hours ago]
но чтобы на выходе была не мапа мап мап, а просто лист, сгруппированный по этим трём параметрам (edited)


Dmitriy Kozin [23 hours ago]
Т.е. мапа в которой листы?

Yevhen Maksymovych [23 hours ago]
нет, на выходе мне нужен List<List<Entity>>


Yevhen Maksymovych [23 hours ago]
в каждом из листов одинаковые customer, birthDate и phone


Yevhen Maksymovych [23 hours ago]
ну, т.е. я могу просто отсортировать по всем этим полям, а потом форичем пройтись, и при изменении добавлять в новый лист, но как-то ведь наверняка это можно сделать красивее


tema.emelyan [23 hours ago]
то есть тебе нужно, чтобы в каждом листе только дубликаты лежали?

Yevhen Maksymovych [23 hours ago]
о, разобрался


Yevhen Maksymovych [23 hours ago]
нет, у меня есть список заказов. мне их надо разделить по клиентам. но клиенты могут быть однофамильцами, тогда я их отличаю по дате рождения и по телефону.


Yevhen Maksymovych [23 hours ago]
но уже сделал

Yevhen Maksymovych [23 hours ago]
кривовато, правда

Yevhen Maksymovych [23 hours ago]
```    public List<OrdersByCustomer> getOrdersByCustomer(String customer) {
        Function<Order, List<Object>> orderKey = order ->
                Arrays.<Object>asList(order.getCustomer(), order.getBirthDate(), order.getPhone());

        return service.getByCustomerContains(customer).stream()
                                .collect(Collectors.groupingBy(orderKey, Collectors.toList()))
                                .values().stream()
                                .map(OrdersByCustomer::new)
                                .collect(Collectors.toList());
    }```


tema.emelyan [23 hours ago]
у тебя же не важно однофамилец или нет, для разных клиентов разный объект customer будет, или нет?


Yevhen Maksymovych [23 hours ago]
нет, не разный, кастомер - стринг (edited)

tema.emelyan [23 hours ago]
а вижу

tema.emelyan [23 hours ago]
лучше наверное какой-то уникальный идентификатор каждому клиенту присобачить

tema.emelyan [23 hours ago]
но хозяин - барин само собой


Yevhen Maksymovych [23 hours ago]
ну да, это для подсчета суммы заказов, проблема в том, что юзеры вместо того, чтобы вешать заказ на клиента в бд, зачастую создают нового, потому приходится выкручиваться


Yevhen Maksymovych [23 hours ago]
с сервера приходит вот такой json:
```{
"customer": "ИВАНОВА АННА ПЕТРОВНА",
"sex": "Женский",
"phone": "380672236623",
"birthDate": "1986-12-01T00:00:00",
"orderDate": "2017-12-11T00:00:00",
"price": 140
},
{
"customer": "ИВАНОВ СЕРГЕЙ ВАСИЛЬЕВИЧ",
"sex": "Мужской",
"birthDate": "1982-12-01T00:00:00",
"phone": "380503236634",
"orderDate": "2018-01-12T00:00:00",
"price": 715
},
...```


Yevhen Maksymovych [23 hours ago]
т.к. поиск идёт по части фамилии или по части номера телефона, там с большой долей вероятности будут однофамильцы


Yevhen Maksymovych [23 hours ago]
короче, вроде пока выкрутился

Dmitriy Kozin [23 hours ago]
У меня так получилось https://gist.github.com/dskozin/ce5ad4f9f97f6976ab63fbe5a0e7d79c


Grigory Kislin [22 hours ago]
лист, сгруппированный по этим трём параметрам- это как я понимаю мапа? или что за конструкция?
сделай свой ключ и подавай в groupingBy такую Function, которая сделает нужную тебе группировку (edited)


Yevhen Maksymovych [22 hours ago]
да, я так и сделал уже :slightly_smiling_face:


Ma3stro [4:20 PM]
В сервисе можно сразу ведь делать getAll для MealWithExceed?

Vladimir Gorbatenko [4:33 PM]
И снова всем привет! Сразу хочу извиниться за то что буду заваливать канал тупыми вопросами, потому что я или логику не понимаю или меня забрали инопланетяне. Спасибо тем кто дал подсказки вчера, но, мне не помогло...

Задача.
3: изменить MealRepository/InMemoryMealRepositoryImpl: в одном общем хранилище хранится вся еда всех пользователей. Любой пользователь авторизуется и видит/модифицирует только свою еду.
3.1: реализовать хранение еды для каждого пользователя можно с добавлением поля userId в Meal ИЛИ без него (как нравится). Напомню, что репозиторий один и приложение может работать одновременно с многими пользователями.
3.2: если по запрошенному id еда отсутствует или чужая, возвращать null/false (см. комментарии в UserRepository)
3.3: список еды возвращать отсортированным по времени, последние записи наверху
3.4: атомарность операций не требуется (коллизии при одновременном изменении одного пользователя можно не учитывать)

Понимание и решение.
* В Meal надо добавить поле userId для того чтоб связать пользователя и его еду. Сделано, поле в класс и его конструктор добавлено.
* Далее нам надо изменить MealRepository - в параметры методов (ВСЕХ) добавляем "int userId".
* И соответственно поменять реализацию методов в InMemoryMealRepositoryImpl - изменять, удалять и доставать еду указанного в параметрах методах. 
* В InMemoryMealRepositoryImpl в блок инициализации еды изменил на
{
       for (Meal MEAL : MealsUtil.MEALS) {
           save(MEAL, AuthorizedUser.id());
       }
   }
    
Все верно или я фантазер...? (edited)

Ma3stro [23 hours ago]
Блок инициализации неверный. Авторизованный юзер известен только на слое web (edited)


Ma3stro [23 hours ago]
Попробуй просто захардкордить его отдельно, предварительно захардкордив хранилище юзеров



Vladimir Gorbatenko [23 hours ago]
Ок, тупо поставил туда "1".
А как быть с методом save? Насколько этот вариант правильный или нет?
public Meal save(Meal meal, int userId) {
       if(!(meal.isNew()))
           if(repository.get(meal.getId()).getUserId() != userId)
               throw new NotFoundException("You can change only your meal");

       if (meal.isNew()) {
           meal.setId(counter.incrementAndGet());
           repository.put(meal.getId(), meal);
           return meal;
       }
       // treat case: update, but absent in storage
       return repository.computeIfPresent(meal.getId(), (id, oldMeal) -> meal);
   }


dustnfox [20 hours ago]
@Vladimir Gorbatenko ты зачем два условия пишешь на `isNew` ? Есть же `if-else` конструкция. Но и она тебе не нужна. Перенеси ветку `if (meal.isNew())` в начало и больше ничего проверять не нужно. Если еда новая, то она провалиться в эту ветку и `return meal;` завершит исполнение метода. Следом за этим блоком пиши все, что относится к случаю `update`. И конечно уже тут никаких методов `isNew` быть не должно, ибо новая еда сюда просто не доберется. 

Исключения лучше кидать в слоях, которые "выше", а тут просто возвращать `null`, если еда чужая. Григорий про это писал.


Dmitriy Kozin [4:35 PM]
shared this Java snippet: MyTry.java 
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;
​
public class MainMain {
​
  public static void main(String[] args) {
​
    List<String> strings = new ArrayList<>();
​
    strings.add("Abc");
    strings.add("Abe");
    strings.add("Acd");
    strings.add("Acc");
​
​
    System.out.println(strings.stream()
        .collect(
​
            Collectors.groupingBy(e -> e.charAt(0),
                Collectors.groupingBy(e -> e.charAt(1),
                    Collectors.toList()
                ))).values()
        .stream()
        .map(Map::values)
        .collect(Collectors.toList()));
​
  }
}
Collapse 

Yevhen Maksymovych [5:18 PM]
парни, задавал вопрос вчера, кажется, но так и не ответили, может кто знает - как-то можно получить спринг контекст без его вычитки из xml? он ведь, судя по логам, и так при старте приложения инстанциируется

Grigory Kislin [22 hours ago]
когда мы подключим spring mvc - пропишем в листенере старт спринга и он будет сам подтягиваться... пока только вручную
> судя по логам, и так при старте приложения инстанциируется
это что ты запускаешь и где видишь логи?


Yevhen Maksymovych [22 hours ago]
деплою приложение в томкат, и при его старте вижу вот такое в консоли:

Yevhen Maksymovych [22 hours ago]
INFO  ClassPathXmlApplicationContext [AbstractApplicationContext.java:589] Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@5e208d96: startup date [Mon Mar 12 17:32:24 EET 2018]; root of context hierarchy
INFO  XmlBeanDefinitionReader [XmlBeanDefinitionReader.java:316] Loading XML bean definitions from class path resource [spring/spring-app.xml]


Yevhen Maksymovych [22 hours ago]
принудительно нигде контекст не инстанциирую


Grigory Kislin [22 hours ago]
поставь брекпойнт и посмотри- откуда вызывается. томкат про твой спринг сам ничего не знает


Ma3stro [5:59 PM]
Получается, такой должна быть реализация в Мил контроллере?
```    public Meal create(Meal meal) {
        return service.create(meal, AuthorizedUser.id());
    }
    
    public void update(Meal meal) {
        service.update(meal, AuthorizedUser.id());
    }```

Ma3stro [6:02 PM]
Только я не понял, как прямо сейчас сказать, что мой юзер №2 - это авторизованный юзер?

v.chernyshoff [21 hours ago]
Авторизованный юзер - это, в данном случае, тот юзер, который сейвит.


v.chernyshoff [21 hours ago]
Его id тут нужен, чтоб присвоить порции userId


v.chernyshoff [21 hours ago]
А при апдейте надо проверить, совпадают ли Auth.id и meal.userId, чтобы убедиться, что юзер редактирует свою порцию.



v.chernyshoff [21 hours ago]
Если, конечно, он не админ

Grigory Kislin [21 hours ago]
можно реализовывать без meal.userId
userId снаружи не должен приходить. но если пришел- да, нужно проверить


Grigory Kislin [21 hours ago]
> что мой юзер №2 - это авторизованный юзер
см. ДЗ 8.


Ma3stro [6:03 PM]
Или пока только для номера 1 сделать?

Anton Kiselev [6:11 PM]
Подскажите, пожалуйста, с фильтрацией. Фильтруем <Meal> переводим в <MealWithExceed>  и отдаем в сервлет? теперь касательно самой фильтрации. обрабатывать каждый случай если один из параметров будет равен null(а если да, делать в самом сервлете)? и в зависимости от этого устанавливать либо в  max/min? (edited)

Grigory Kislin [21 hours ago]
1. каждый, см. демо
2. см подсказки 5.5


Ma3stro [6:13 PM]
ой кажется MealRestController заработал!!!!
я так счастлив!!!
хд
:slightly_smiling_face:
простите за эмоции)

mila [6:42 PM]
а в сервлете переменную репозитория просто меняем на контроллер? и инициализируем в init, никакие аннотации не нужны?

Mikhail Makar [20 hours ago]
Да, без аннотаций!
Но нужно ещё закрыть ConfigurableApplicationContext, в методе destroy()!


roma [7:06 PM]
Я кстати не совсем понял почему через анатацию не заработало

roma [7:18 PM]
Вот это немного смущает
```2.4: Фильтрацию по датам сделать в репозитории т.к. из базы будем брать сразу отфильтрованные по дням записи.```
мне что тянуть все эти вещи
```LocalTime startTime = sT==null||sT==""?LocalTime.MIN:LocalTime.parse(request.getParameter("startTime"));
                LocalTime endTime = eT==null||eT==""?LocalTime.MAX:LocalTime.parse(request.getParameter("endTime"));
                LocalDate startDate = sD==null||sD==""?LocalDate.MIN:LocalDate.parse(request.getParameter("startDate"));
                LocalDate endDate = eD==null||eD==""?LocalDate.MAX:LocalDate.parse(request.getParameter("endDate"));```
из сервлета через контролер и сервис в репозиторий - и только там фильтровать? (edited)

roma [7:24 PM]
просто сейчас в моей реализации это происходит вообще на уровне сервлета - что конечно не правильно учитывая пункт 6.1

tema.emelyan [7:24 PM]
а представь ты достаёшь все записи из базы данных и тянешь их наверх и только там фильтруешь

roma [7:25 PM]
) - аргумент )

tema.emelyan [7:25 PM]
ну да :smiley:

roma [7:25 PM]
Привет Артем

tema.emelyan [7:25 PM]
привет, Роман :smiley:
со старой стажировки?

aleksey [7:27 PM]
+ эксепшены не забудь ловить при парсинге

Alex83 [7:34 PM]
всем привет! Кто-нибудь знает, есть ли возможность на гитхабе в форке искать по содержимому файла? (edited)
например, хочу найти getId() во всех файлах

tema.emelyan [7:42 PM]
в форке или в коммите?
если в форке, то во всём проекте?
можно в идее открыть и там правой кнопкой по папке и искать в папке или как-то так

Alex83 [7:55 PM]
@tema.emelyan в форке, но не в своем ) в браузере в чужом форке

roma [8:37 PM]
@aleksey зачем ловить DateTimeParseException если в форме у нас поля <input type="date" и  <input type="time"

aleksey [8:40 PM]
@roma а ты открой в фаерфоксе
или вдруг реализация на фронте изменится
а если пустое поле формы придет? (edited)

roma [9:01 PM]
Придется ловить

Ivan Koshelia [1:38 AM]
кто решил? может поделиться решением?

roma [7:17 AM]
Григорий решил - завтра ночью будет делиться ) (edited)

Alexander_Gubanow [7:25 AM]
@Grigory Kislin Следуя логике выполнения задания, мне кажется логичнее п.8 задания из optional перенести в п.3  и поставить перед 3.1., чтобы меньше возникало вопросов, где взять userId.

Alexander Melnichuk [8:01 AM]
Привет всем! 
Я правильно понимаю, почему проверку checkNew и assureIdConsistent мы делаем на уровне контроллера, а проверку checkNotFoundWithId делаем на уровне сервиса? 
Потому что первое не требует обращения к репозиторию и незачем тащить запрос вглубь, если данные уже некорректны, а второе — требует, и незачем опять же тащить данные по слоям назад, если в результате выполнения запроса выяснилось, что они некорректны? 
Т.е. у нас нет "слоя на котором происходят проверки", а есть просто проверки там где это ближе к источнику данных? 
Или тут какой-то другой смысл?
This message was deleted.

roma [5 hours ago]
```3.4: атомарность операций не требуется (коллизии при одновременном изменении одного пользователя можно не учитывать)```
тут завис?


roma [5 hours ago]
или полностью на 3 и 4 пунктах ДЗ?


Vladimir Gorbatenko [5 hours ago]
полностью на 3 и 4 пунктах..


mila [11:07 AM]
а если в контроллере сервис не инициализируется в чём может быть дело? аннотации есть

Yevhen Maksymovych [4 hours ago]
покажи гит


mila [4 hours ago]
https://github.com/passingbyreloaded/topjava/tree/HW02/src/main


Yevhen Maksymovych [4 hours ago]
а, гляди


Yevhen Maksymovych [4 hours ago]
ты в сервлете инстанциируешь контроллер


Yevhen Maksymovych [4 hours ago]
```controller = new MealRestController();```


Yevhen Maksymovych [4 hours ago]
в контроллере-то у тебя всё @Autowired, но ты его создаёшь вне спринг контекста


Yevhen Maksymovych [4 hours ago]
тебе надо создать спрингКонтекст, и из него вытянуть контроллер как спринг бин. Тогда он попадёт в контекст, и инстанциирует всё, что у него @Autowired


roma [4 hours ago]
точно у тебя сервлет работает не со спринговским бином, а с инстенсем контроллера о котором спринг ничего не знает... @Yevhen Maksymovych - глазастый )

Yevhen Maksymovych [4 hours ago]
ну а дальше ошибки посыпятся, уже по стектрейсу двигайся :slightly_smiling_face:


mila [3 hours ago]
спасибо, отвлекли меня тут, щас покопаюсь, если не вернусь опять с вопросами))

mila [3 hours ago]
а что значит создать спринг контекст? spring-app.xml вот это у нас разве не он? и в нём вот этой строчки <context:component-scan base-package="ru.javawebinar.**.web"/> недостаточно чтобы он нашёл контроллер и заинжектил всё куда надо?)


Yevhen Maksymovych [3 hours ago]
в спринг буте достаточно, когда перво-наперво создаётся контекст, и дальше все объекты инстанциируются из него. но здесь у нас пока огрызок, томкат запускает контейнер сервлетов, который инстанциирует твои сервлеты. он ничего не знает о спринге


Yevhen Maksymovych [3 hours ago]
ты при старте сервлета создаёшь контроллер, у которого service никем не инстанциирован

Yevhen Maksymovych [2 hours ago]
как же мне нравится слово "инстанциирован"

Yevhen Maksymovych [2 hours ago]
короче, у твоего контроллера сервис = null, потому что его некому было создать, апач ничего не знает о том что где-то в пакете есть умный спринг, который цепляет все зависимости. он по старинке: кто-то зашёл по uri, он поглядет в web.xml, что на этот uri примаплен сервлет, создал его инстанс, если его ещё нет


mila [2 hours ago]
ок, а что должен запускать томсат чтобы управление перешло спрингу?

Yevhen Maksymovych [2 hours ago]
ты просто в init должна провернуть такую же штуку, как мы для тестов делали в SpringMain


Yevhen Maksymovych [2 hours ago]
```ConfigurableApplicationContext appCtx = new ClassPathXmlApplicationContext("spring/spring-app.xml");
controller = appCtx.getBean(MealRestController.class);```

Yevhen Maksymovych [2 hours ago]
вот так он вытянется из спринга, со всеми зависимостями


mila [2 hours ago]
аа, семен семеныч


mila [2 hours ago]
ща попробую


mila [1 hour ago]
все работает, спасибо:hugging_face:


roma [1 hour ago]
@Yevhen Maksymovych тоесть в сервлете нальзя проинициализировать MealRestConroller  через @Autowire потому что tomcat ничего туда не заинжектит так как он ничего не знает про спринг??? У меня тогда вопрос: Учитывая что мы работаем через томкат - как тогда у нас вообще спринг поднимается в какой момент - Апач начинает понимать что есть умный спринг в котором хранятся все нужные бины?


roma [1 hour ago]
Когда сервлет начинает дергать методы контроллера? в этот момент поднимается контекст спринга? (edited)


Yevhen Maksymovych [33 minutes ago]
когда мы работает не через бут (как сейчас), спринг контекст поднимется, когда мы его поднимем :slightly_smiling_face: в данном случае, мы его принудительно поднимаем в init() контроллера, и он действует ровно пока доступна переменная, в которую его положили :slightly_smiling_face: (edited)

roma [18 minutes ago]
@Yevhen Maksymovych Супер )))) - пазл сложился )


roma [18 minutes ago]
спасибо

Yevhen Maksymovych [18 minutes ago]
:+1:


roma [11:36 AM]
```4: Проверку isBetweenDate сделать в DateTimeUtil. Попробуйте использовать дженерики и объединить ее с isBetweenTime```
Вот это не понимаю как сделать используя дженерики - у LocalDate и Local Time почти нет общих интерфейсов кроме
```Temporal, TemporalAccessor, TemporalAdjuster```
, компораторы у них с разными типами
```Comparable<LocalTime>```
и
```Comparable<ChronoLocalDate>```
(edited)

Dennis [4 hours ago]
Общий - Comparable, пытайся использовать: ограничение сверху, ограничение снизу


dustnfox [4 hours ago]
В что делается в isBetween методах - операции сравнения. Соответственно методы можно обобщить принимаю любые объекты реализующие Comparable интерфейс


roma [2 hours ago]
ох даже плохо понимаю что вы сказали ) но попытаюсь )


roma [1 hour ago]
@Dennis @dustnfox Ребята благодаря вот этому:
```https://stackoverflow.com/questions/32594131/generic-issue-in-localdate```
смог написать такое:
```    public static boolean isBetween(LocalDateTime lt, LocalDate startDate, LocalDate endDate, LocalTime startTime, LocalTime endTime) {
        return isBetween(lt.toLocalDate(),startDate,endDate) && isBetween(lt.toLocalTime(),startTime,endTime);
    }

    public static <T extends Comparable<? super T>> boolean isBetween(T lt, T start, T end)
    {
        return lt.compareTo(start) >= 0 && lt.compareTo(end) <= 0;
    }```
правильно я понимаю эту строку:
```<T extends Comparable<? super T>>```
наш Т тип может быль любым наследником Comporable <с типом любого родителя T> ??? (edited)


dustnfox [1 hour ago]
@roma Это значит, что переданный в метод тип или его родитель должен реализовывать (implement) интерфейс `Comparable`


roma [38 minutes ago]
Понял - для LocalTime было бы достаточно
```<T extends Comparable<T>>```
а для LocalDate нужна уже именно
```<T extends Comparable<? super T>>```
так как там компоратор имплиментируется с типомродителя LocalDate (<ChronoLocalDate>)


roma [38 minutes ago]
ужс

dustnfox [28 minutes ago]
@roma Не совсем так. В нашем случае достаточно <T extends Comparable<T>>. В той ссылке на stackoveflow, что ты даешь, в метод передается коллекция, а коллекции не ковариантнты. То есть List<LocalDate> нельзя писать вместо List<ChronoLocalDate>, хоть первый тип и является наследником второго. У нас таких проблем нет и метод нормально жрет LocalDate воспринимая его как родителя т.е. ChronoLocalDate у которого в свою очередь есть реализация Comparable<ChronoLocalDate>.



roma [17 minutes ago]
Спасибо - пойду поищу еще инфу почему коллекции не ковариантны


roma [16 minutes ago]
точнее так - пойду поищу инфу что такое коваринтны потом пойду поищу инфу почему колекции не такие )

dustnfox [14 minutes ago]
https://www.ibm.com/developerworks/library/j-jtp01255/index.html
ibm.com
Generics gotchas
Generic types, added in JDK 5.0, are a significant enhancement to type safety in the Java language. However, some aspects of generics may seem confusing, or even downright bizarre, to first-time users. In this month's Java theory and practice, Brian Goetz examines the common pitfalls that ensnare first-time users of generics.
 


roma [1 minute ago]
ну по верхам вроде понял


roma [1 minute ago]
спасибо

Oleg K [2:23 PM]
Наконец дошли руки до дз2. Кто подскажет, в getByEmail через стрим - какой терминальный оператор более уместен?

roma [1 hour ago]
у меня фильтр и потом файнд эни (edited)


Oleg K [1 hour ago]
а у меня файнд фирст. В принципе то- же самое, спасибо


aleksey [45 minutes ago]
При распараллеливании стрима findAny отработает быстрее, поскольку вернет первый попавшийся, findFirst вернет первый удовлетворяющий с учетом очередности, как я понимаю.


Oleg K [34 minutes ago]
Действительно. Пусть будет эни:grin::ok_hand::skin-tone-2:


aleksey [33 minutes ago]
да у меня пол часа назад тоже first было, пока не решил полюбопытствовать=)


poleg [3:06 PM]
Почему-то в MealRestController аннотация @Autowired для MealService подсвечивается предупреждением - autowired members must be defined in valid spring bean. Но в MealServiceImpl стоит аннотация @Service. Чего Идее не нравится?

Dmitriy Kozin [18 minutes ago]
Контроллер надо тоже аннотировать @Controller



pro [15 minutes ago]
подожди пока прекомпилляция отработает


poleg [14 minutes ago]
Да, теперь ок


Andrii [3:24 PM]
Всем привет. 
Подскажите плиз по Spring. 
1. Аннотации @Component, @Repository, @Service, @Controller - мы даем спрингу понять, какой класс сканить, верно? 
2. Аннотация @Autowired - мы инжектим конструктор в спринг то есть добавляем в контейнер спринга? 
3. Что будет если класс не отметить @Autowired ? Этот вопрос я задаю по причине того, что тренировался на простых приложениях, и ставил просто @Component и в main поднимал контекст и все работало без @Autowired. У нас кстати тоже есть такие классы.
Каша в голове =( 
Уже все путается.


pro [3:27 PM]
1. - это компоненты, которые отмечены для Spring, чтобы он смог их использовать в соответствии с их назначением;

roma [3:29 PM]
2. - говорим Спрингу, что сюда надо прикрутить из его контекста бин такого же типа (edited)

pro [3:29 PM]
2. - Autowired - от корня "wire" (прикрутить) - вместо того чтобы самому инициализировать один компонент внутри другого, ты просто поручаешь его инициализацию Spring
