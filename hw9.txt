Grigory Kislin [1:57 AM]
joined #hw9.

Grigory Kislin [1:59 AM]
Welcome на 9е занятие:
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson09.md
Настоящая авторизация, ее тестирование и отрисовку таблиц по AJAX. (edited)

Arthur [2:13 AM]
joined #hw9 along with 18 others.

saudabaew [11:50 AM]
от занятия к занятию количество участников в группе уменьшается

Valery.Shkerdin [11:52 AM]
до конца дойдут только избранные )

Yevhen Maksymovych [12:39 PM]
да еще подтянется народ


aleksey [12:51 PM]
@Grigory Kislin Почему мы не затрагиваем тему DTO?
Почему в слое сервиса у нас по прежнему нет бизнес-логики, а в слое репозитория она есть?


Grigory Kislin [1:27 PM]
всегда так. часть на повтор идет

LeoJames [3:38 PM]
:relaxed:Так понравилось что хочется проходить снова и снова
Получить все ачивки, найти все пасхалки, прокачать макс уровень и постримить спидран 
:thinking_face:

Vladimir Gorbatenko [4:37 PM]
вот не смешно ) сам пойду на второй круг из-за кучи неясностей
я вот тут накатывал сегодня патчи и понял что мне например для понимания, явно не хватает картинок с взаимодействиями нашего приложения.


Anton Kiselev [Yesterday at 5:05 PM]
in #hw9
А смысл второго круга, что изменится? инфа же у нас сохранится, можно сидеть спокойно разбираться (edited)


2 replies
realcorwin [16 hours ago]
Только если будет что-то новое в программе.


Anton Kiselev [16 hours ago]
просто считаю, что в график укладываться реально только если есть опыт работы со всем стеком технологий который здесь используется.


Dzmitry Shalukhau [7:35 PM]
Я уже 2 круг :slightly_smiling_face: В первый раз окончил на hw4, второй раз по ходу закончу на hw9-10 :slightly_smiling_face: Третий раз видимо все закончу

realcorwin [8:57 PM]
рецидивист :slightly_smiling_face:

LeoJames [9:06 PM]
На 4ом круге он найдет Фростморн и свергнет Григория:thinking_face:


Ma3stro [Yesterday at 9:07 PM]
in #hw9
Смотрю решение и удивляюсь, как я сам до таких очевидных вещей не дошел.-. (edited)


1 reply
realcorwin [15 hours ago]
Дивлюсь я на небо та й думку гадаю, Чому я не сокіл, чому не літаю :slightly_smiling_face:


Dzmitry Shalukhau [11:05 PM]
@LeoJames Я на 2 круге открыл компанию и удвоил свой доход. На 3 неизвестно что будет.

LeoJames [11:58 PM]
@Dzmitry Shalukhau На 3 - чревоугодие

Dzmitry Shalukhau [10:27 AM]
:))))


Zhivchik [May 4th at 1:51 PM]
in #hw9
После накатки всех патчей не срабатывает кнопка Добавить еду. Так и должно быть?


2 replies
Aleksei Kirillov [2 days ago]
на это намекает пункт:
   Почему еда не редактируется?
   Подсказка: поглядите вкладку Network в браузере.


Zhivchik [2 days ago]
Ок. Спасибо.


ilya t. [May 5th at 11:27 AM]
in #hw9
ребят, может вопрос тупой но все же не очень понимаю почему у нас getBetween в MealAjaxController обозначен постом? Не по принципам реста же, пост не идемпотентен, а здесь у нас именно операция гет, т.е. мы только берем из базы.


13 replies
Dmitry Neustupov [1 day ago]
Может потому, что данные для getBetween из формы постом прилетают? В функции updateTable() аякс запрос c  type: "POST".


ilya t. [1 day ago]
ну окей, меняем в updateTable с поста на гет, результат не меняется. Данные также фильтруются. (edited)


Dmitry Neustupov [1 day ago]
Ctrl+F5?


Dmitry Neustupov [1 day ago]
Если поменять на GET - не работает.

ilya t. [1 day ago]
ээ перепроверю


ilya t. [1 day ago]
все работает, и с Ctrl+F5, ты еще в контроллере поменяй с PostMapping на Get и посмотри. (edited)


Oleksii Leshchenko [1 day ago]
Я думаю можна как через пост, так и через гет. Просто Григорий говорил, что из формы любит отправлять через пост...


ilya t. [1 day ago]
аа ну просто я задался вопросом - если переправить на гет будет ли это ошибкой, мб именно здесь по каким то причинам надо именно пост :slightly_smiling_face:


eageev [1 day ago]
Ошибки не будет, но данные будут передаваться в заголовке, а не в теле запроса.


eageev [1 day ago]
А метод можно назвать как угодно. Методы называют согласно тому, что они делают (получает данные между 2мя датами).

Grigory Kislin [1 day ago]
1. у нас же тут не rest. передаем не json, а параметры из формы. я из форм обычно чз пост данные отдаю. но get также будет работать
2. в rest контроллере у нас get



eageev [1 day ago]
Ну да, лишний раз показывать параметры в адресной строке - плохая практика)


ilya t. [1 day ago]
@eageev с гет не передаются в адресной строке, можешь проверить


Ma3stro [3:52 PM]
Почему в User у нас ограничения на password 5..100, а в UserTo мы вдруг решили сделать ограничения от 5..32? Нет ли здесь каких-то конфликтов?


Vyacheslav [Yesterday at 1:16 PM]
in #hw9
Народ. Мне показалось или где-то проскочило, что без MealTO можно обойтись? Просто по логике приложения кажется, что он нужен, раз уж BaseTo существует.


8 replies
Oleksii Leshchenko [11 hours ago]
Как я понимаю, то можно обойтись. Все как для юзера. Мы добавили ТО для автоматического биндинга...


Vyacheslav [11 hours ago]
Разве по meal биндиться не должно?


Oleksii Leshchenko [11 hours ago]
должно. поэтому ТО тоже надо делать


Pavel Zaitcev [10 hours ago]
В данном случае TO не нужен, т.к. объект еды при отдаче его с UI не требует сокрытия каких либо деталей, или наоборот, преобразований. В нем всего несколько полей, которые в полном составе  (почти) мы и видим на UI. Единственное - у сущности Meal есть поле user, которое мы не отдаем с UI. Решение данной проблемы при биндинге - @Validated и группы валилации. Хотя все это можно, кончено сделать и через TO. Но нужно ли?


Vladimir Gorbatenko [9 hours ago]
кто сделает напрямую без MealTo - поделитесь вариантом.


Arthur [7 hours ago]
я сделал без MealTo


Arthur [7 hours ago]
не пойму в чем тут особенность?...


qf05 [4 hours ago]
Я вместо То использовал mealWidthExeeded)))
надо разобраться с аннотацией @Validated, тогда может и напрямую с меал сделаю.


Vitaly M. [Yesterday at 4:44 PM]
in #hw9
Не могу понять, что я сломал у себя... но у меня в AbstractUserController, в методах create(User user)  и update(User user, int id) появилась ошибка на checkNew(user):
```checkNew(ru.javawebinar.topjava.HasId) in ValidationUtil cannot be applied to (ru.javawebinar.topjava.model.User)```


5 replies
Vladimir Gorbatenko [8 hours ago]
public abstract class AbstractBaseEntity implements HasId 
public class User extends AbstractNamedEntity 
все так?


Vitaly M. [8 hours ago]
Ну как так? вот сам же проверял несколько раз!!!


Vitaly M. [8 hours ago]
естественно в implements HasId ,skf ghj,ktvf


Vitaly M. [8 hours ago]
была проблема


Vitaly M. [8 hours ago]
Спасибо тебе )


Vladimir Gorbatenko [4:45 PM]
Хмм, при подключении datetimepicker форма фильтра не сериализуется...
Нет, не в этом было дело. 
На стороне сервера приняло только когда в datetimepicker-е в датах указал формат: format:'Y-m-d'
До этого были точки в дате.
Как я понял решается с помощью конверторов. (edited)

Vladimir Gorbatenko [5:51 PM]
added and commented on this Java snippet: Untitled 
8: Проверьте в RootController.meals(), его нужно тоже поправить
Кто знает что тут надо править?
Vyacheslav [5:55 PM]
маппинг meals
Vyacheslav [5:55 PM]
Сделать так же как users

Vladimir Gorbatenko [5:59 PM]
added and commented on this Java snippet: Untitled 
@GetMapping("/users")
  public String users() {
    return "users";
  }
не понятно....
Vyacheslav [6:01 PM]
Ну вроде как убрать модель из аргументов. И оставить только return.

Vladimir Gorbatenko [6:06 PM]
глючит уже под вечер )

Ma3stro [6:58 PM]
При отправки формы добавления еды все значения на контроллер приходят с null. Делал по аналогии с пользователями
В какую сторону вообще копать?..

Ma3stro [7:04 PM]
Кто-то сталкивался с этим еще?


Vladimir Gorbatenko [Yesterday at 7:27 PM]
in #hw9
Да, спринг не нашел к чему забиндидь, поэтому и нужен To. Ну или может есть специальные пляски....


3 replies
Ma3stro [5 hours ago]
Ну у меня собственно MealWithExceed и сделан как To


Vladimir Gorbatenko [4 hours ago]
тоже делал из него To, но видимо из-за exceed не встало как надо.


Vladimir Gorbatenko [4 hours ago]
поэтому сделал отдельно To


Ma3stro [8:39 PM]
added and commented on this Java snippet: To and AjaxContoller 
```public class MealWithExceed extends BaseTo implements Serializable {
  private static final long serialVersionUID = 1L;
​
  @NotNull
  private LocalDateTime dateTime;
​
  @NotBlank
  @Size(min = 2, max = 120, message = "description must not be null")
  private String description;
​
  @Range(min = 10, max = 4000)
  private int calories;
​
  private boolean exceed;``
​
```  @PostMapping
  public ResponseEntity<String> createOrUpdate(@Valid MealWithExceed mealTo, BindingResult mess) {
    if (mess.hasErrors()) {
      StringJoiner joiner = new StringJoiner("<br>");
      mess.getFieldErrors().forEach(
          fe -> {
            String msg = fe.getDefaultMessage();
            if (!msg.startsWith(fe.getField())) {
              msg = fe.getField() + ' ' + msg;
            }
            joiner.add(msg);
          });
      return new ResponseEntity<>(joiner.toString(), HttpStatus.UNPROCESSABLE_ENTITY);
    }
​
    if(mealTo.isNew())
      super.create(MealsUtil.createNewFromTo(mealTo));
    else
      super.update(mealTo, mealTo.getId());
    return new ResponseEntity<>(HttpStatus.OK);
  }```
Collapse 
Так и не разобрался, почему я получаю null при отправке формы добавления еды, помогите разобраться, пожалуйста. Вот To и Controller:
ilya t. [8:46 PM]
сделал также, у меня агрится на exceed и на dateTime - реджектит значение и сетит нуллом. У тебя все свойства чтоли нуллом передает?

Ma3stro [8:58 PM]
Да, вообще все, разве что calories просто нулем, потому что примитив


qf05 [Yesterday at 9:01 PM]
in #hw9
а имена полей формы у тебя совпадают с именами переменных в То и именами переменных в конструкторе То?


2 replies
Ma3stro [4 hours ago]
Если ты про форму в meal.jsp, то да, названия все совпадают. В форме разве что нет exceed, и не должно, собственно


qf05 [4 hours ago]
у тебя ещё ошибка в exceed, boolean -  это примитив и он не может быть null.
И передавать захардкоженый exceed - не единственный вариант решения.)


ilya t. [9:02 PM]
блин, а у меня все свойства биндятся кроме даты


qf05 [Yesterday at 9:06 PM]
in #hw9
подскажите как писать рест запросы с учётом авторизации?


2 replies
Dmitry Neustupov [3 hours ago]
Для примера пару курлов тут оставлю:

get All Users
curl -s http://localhost:8080/rest/admin/users --user admin@yandex.ru:admin

get Profile
curl -s http://localhost:8080/rest/profile --user user@yandex.ru:password


qf05 [3 hours ago]
спасибо


ilya t. [Yesterday at 9:22 PM]
in #hw9
поясните кто столкнулся с проблемой биндинга даты - там нужно отдельный конвертер писать чтоли или что-то другое?


12 replies
Ma3stro [3 hours ago]
Что у тебя? По-другому как-то приходят?


ilya t. [3 hours ago]
TypeMismatchException  у меня


ilya t. [3 hours ago]
и я рили не могу понять в чем проблема, такое ощущение что-то упустил, либо доп функциональность придется дописывать


Ma3stro [3 hours ago]
Посмотри через debug в каком формате данные приходят


ilya t. [3 hours ago]
строка


ilya t. [3 hours ago]
вроде и должно строкой приходить)

qf05 [3 hours ago]
да, надо добавить форматтер


qf05 [3 hours ago]
а последняя строчка задания ещё и заставляет кучу раз эту бедную дату делать то с Т, то без Т на стороне клиента.


dustnfox [2 hours ago]
Как по мне, так весь фронтэнд вообще и datetimepicker в частности проектировал какой-то _аццкий сотона_. Так вижу. После java с ее типизацией, документацией и нормальными исходниками, все что касается js/jq кажется жутким бардаком и разгильдяйством. (edited)
 


ilya t. [2 hours ago]
Говорят в руби вообще доков нет почти...


dustnfox [2 hours ago]
Отсутствие доков, тьма, плач и скрежет зубов... Ruby in a nutshell. :grin:


realcorwin [1 hour ago]
Да, фронтенд - полное барахло. Самое смешное, что когда я 20-15 лет назад занимался веб-разработкой, всё это как-то даже приятнее делалось


Vladimir Gorbatenko [14 hours ago]
мне кажется, что js 20 лет назад без нормального отладчика это капец-капец )


dustnfox [14 hours ago]
Да уж! Отладчик в том же Chrome делает жизнь намноооооого легче!


Vladimir Gorbatenko [2:56 PM]
Кто не совсем "догнал" как происходит авторизация, вот статейка, которая мне помогла понять. (надо учесть, что Григорий говорил про изменения в новой версии spring security, например "j_" )
https://habr.com/post/203318/
Хабр
Краткий обзор Spring Security
Итак, дорогой хабраюзер, предлагаю тебе рассмотреть такие аспекты Spring Security как: Ключевые объекты контекста Spring Security. Процесс аутентификации в...
https://habr.com/images/habr.png

roma [5:30 PM]
А кнопка добавить (еду) не работает после всех патчей - это норм?
```datatablesUtil.js:14 Uncaught ReferenceError: i18n is not defined
    at add (datatablesUtil.js:14)
    at HTMLButtonElement.onclick (meals:94)
add    @    datatablesUtil.js:14
onclick    @    meals:94```

goodhoopoe [6 hours ago]
выше уже как минимум один раз вопрос же был https://topjava13.slack.com/archives/CAH6DUJDS/p1525431067000146
Dmytro
После накатки всех патчей не срабатывает кнопка Добавить еду. Так и должно быть?
From a thread in #hw9May 4th at 1:51 PM


Vyacheslav [6 hours ago]
Делай второе задание - заработает.


dustnfox [6 hours ago]
Да. JS пытается подставить title взятый из i18n массива, но не может т.к. инициализация и объявление этого массива пока живет только в части user


dustnfox [6 hours ago]
А вообще, конечно, прав @goodhoopoe Slack не даром слаком назвали создатели. Акроним от Searchable Log of All Conversation and Knowledge как бы намекает, что тут есть поиск :wink:


roma [6 hours ago]
Ну сори ))), а как мне проверить правильно ли я сделал биндинг????

Ma3stro [6 hours ago]
@roma, у тебя должно все заработать:)

roma [6 hours ago]
@Ma3stro Сарказм ? )


Ma3stro [6 hours ago]
@roma, нисколько! Если будут вопросы - задавай


roma [5 hours ago]
@Ma3stro спасибо ) сейчас валидацию воткну и перейду ко второму пункту - а так как первый не проверить особо - чую будет весело


Ma3stro [5 hours ago]
Когда правил кнопочку edit, я просто смотрел в браузере вкладочки source, network и отдельно дебаг, после этого все стало понятно (дело в i18n) (edited)


Vyacheslav [5:33 PM]
Кто-то с биндингом даты разобрался?


Ma3stro [Today at 5:39 PM]
in #hw9
Я просто добавил в MealWithExceed на dateTime @DateTimeFormat


1 reply
Vyacheslav [6 hours ago]
Спасибо


Ma3stro [Today at 5:41 PM]
in #hw9
У меня была проблема, что везде приходило null при отправке формы.
Исправил добавлением сеттеров в MealWithExceed.
Может кому пригодится


3 replies
Tanya [4 hours ago]
а при чем здесь MealWithExceed?


Ma3stro [4 hours ago]
@Tanya в качестве To у меня служит MealWithExceed


Tanya [4 hours ago]
плохая идея, 
MealWithExceed - это ТО наружу


roma [Today at 5:49 PM]
in #hw9
Народ а как вы тестируеите биндинг без кнопки добавить? SoapUi ? (edited)


3 replies
Vyacheslav [6 hours ago]
Я просто сделал 2-й пункт. И она заработала.


dustnfox [6 hours ago]
А кто тебе мешает оживить кнопку "добавить"? :slightly_smiling_face: (edited)


roma [6 hours ago]
то что не разобрался пока с реализацией второго пункта - буду разбираться


qf05 [7:08 PM]
@Ma3stro , а так же остальные сокурсники, не могу не поделиться: http://blog.codeleak.pl/2014/08/validation-groups-in-spring-mvc.html
Эту ссылку я выпросил у Татьяны, спасибо ей огромное! Этот биндинговая магия не перестаёт меня поражать!)))
P.S. Делать То для биндинга из MealWithExceed говорят нельзя. Лучше отдельный То сделать или делать сразу на Meal используя магию из ссылки выше.
blog.codeleak.pl
Validation groups in Spring MVC
Java, Java Enterprise, Spring related technologies blog by Rafał Borowiec

Ma3stro [7:16 PM]
То есть мы можем в Meal указать для полей биндинг группы и в контроллере validated Meal meal с указанием группы?
Если я правильно понял, то это шок какой-то

Vyacheslav [8:27 PM]
Блин. Я так сразу и сделал. Только пока строки не красятся.


Ma3stro [Today at 9:43 PM]
in #hw9
Как корректно сделать раскрашивание строк? Не могу пока разобраться, как здесь можно с data поманипулировать
        ```"createdRow": function (row, data, dataIndex) {
            if(!data.enabled)
                $(row).attr("data-mealExceed", true);
            else
                $(row).attr("data-mealExceed", false);
        }```


2 replies
Alexander Shnaider [2 hours ago]
я так же сделал, только в условии у меня data.exceed


Ma3stro [2 hours ago]
Подлядел на хероку, там проще - через jQuery.addClass)


Alexander Shnaider [9:56 PM]
Подскажите как корректно добавить ajax в dataTable. Не получается сделать редактирование. модальное окно не появляется, хотя в метод updateRow(id) я попадаю. Вылетает ошибка 405

Alexander Shnaider [9:57 PM]
uploaded this image: image.png 

Alexander Shnaider [9:59 PM]
Вот такой у меня файл mealDatatables.js
```var ajaxUrl = "ajax/profile/meals/";
var datatableApi;

function updateTable() {
    debugger;
    $.get(ajaxUrl, updateTableByData);
}

function clearFilter() {
    $("#filter")[0].reset();
    $.get(ajaxUrl, updateTableByData);
}

$(function () {
    datatableApi = $("#datatable").DataTable({
        "ajax": {
            "url": ajaxUrl,
            "dataSrc": ""
        },
        "paging": false,
        "info": true,
        "columns": [
            {
                "data": "dateTime"
            },
            {
                "data": "description"
            },
            {
                "data": "calories"
            },
            {
                "defaultContent": "Edit",
                "orderable": false,
                "render": renderEditBtn
            },
            {
                "defaultContent": "Delete",
                "orderable": false,
                "render": renderDeleteBtn
            }
        ],
        "order": [
            [
                0,
                "desc"
            ]
        ],
        "createdRow": function (row, data, dataIndex) {
            data.exceed ? $(row).attr("data-mealExceed", true) : $(row).attr("data-mealExceed", true);
        },
        "initComplete": makeEditable
    });
});``` 
Dmitry Neustupov [10:03 PM]
А в контроллере, который обрабатывает ajaxUrl = "ajax/profile/meals/" - гет метод есть?
Alexander Shnaider [10:05 PM]
вот же я дурень. спасибо за наводку

Alexander Shnaider [10:44 PM]
Как-то упоминалось что писать JS в JSP  это дурной тон, не подскажите как так заполнить массив i18n нужными нам сообщениями уже в JS? Нужно как-то к DOM обращаться?


roma [1:31 PM]
Народ в общем приложение мое после первых двух заданий почти лежит ))) 
1) не работает кнопка добавить и update
```Field error in object 'mealWithExceed' on field 'dateTime': rejected value [2018-01-01T23:59]; codes [typeMismatch.mealWithExceed.dateTime,typeMismatch.dateTime,typeMismatch.java.time.LocalDateTime,typeMismatch]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [mealWithExceed.dateTime,dateTime]; arguments []; default message [dateTime]]; default message [Failed to convert property value of type 'java.lang.String' to required type 'java.time.LocalDateTime' for property 'dateTime'; nested exception is org.springframework.core.convert.ConversionFailedException: Failed to convert from type [java.lang.String] to type [@org.springframework.format.annotation.DateTimeFormat java.time.LocalDateTime] for value '2018-01-01T23:59'; nested exception is java.lang.IllegalArgumentException: Parse attempt failed for value [2018-01-01T23:59]]```
пытался решить как писал выше маэстро поставив анатацию над полем в классе MealWitExceded
   
```@DateTimeFormat(pattern = "yyyy-MM-dd'T'hh:mm" , iso = DateTimeFormat.ISO.DATE_TIME)
    private LocalDateTime dateTime;```
но ничего из этого не вышло я так понимаю нужно писать конвертер? подскажите плиз как мне его вызывать (от куда, в какой момент)
2) лежит раскраска по цветам - таблица серая - еще пока не разбирался по чему но за наводуку буду благодарен ) - ну я понимаю что мы отрисовку таблицы отдали аяксу - а как нам ему сказать что бы он ее раскрашивал - хз
3) Радует что хотябы кнопка delete работает ) (edited) (edited)

Ma3stro [1:41 PM]
Паттерн указывать не нужно
Глянь как мы для юзера делаем его деактивированную раскраску, попробуй сделать по аналогии

roma [1:47 PM]
Блин круто ))) Паттерн убрал и проблемма номер 1 отпала )))перехожу к отрисовке цветов ) @Ma3stro- спасибо (edited)

Ma3stro [2:52 PM]
uploaded and commented on this image: image 

Откуда у нас взялся поиск??!?


roma [May 8th at 3:26 PM]
in #hw9
я не пойму как у нас users вызывают стиль enabled из style.css
```tr[data-userEnabled="false"] {
    opacity: 0.3;
}```
если в патче №7 мы убрали эту строку из users.jsp:
```<tr data-userEnabled="${user.enabled}">```
(edited)


5 replies
Ma3stro [1 day ago]
В userDatables.js смотри "createdRow"


Ma3stro [1 day ago]
И при убирании checkbox'а у нас незаметно к тегу <tr> добавляется атрибут data-userEnabled="${user.enabled}" (edited)


Ma3stro [1 day ago]
Это все я из дебага в браузере достал)


roma [1 day ago]
@Ma3stro Красавчег что из дебага - надо его получше мне освоить))) все - раскрасил - сделал неоптионал часть )))) Спасибо ))) (edited)



Grigory Kislin [1 day ago]
рекомендую использовать контекстный поиск Ctrl+F  на корне (или папке) проекта справа по всему проекту. например: data-userEnabled
мне часть помогаем (edited)


Alexander Shnaider [May 8th at 3:30 PM]
in #hw9
Я правильно понял что в mealDataTables.js нам не нужно вызывать метод `$.get(ajaxUrl, updateTableByData)` т.к данные в таблице обновляются за счёт запроса фильтра
```$.ajax({
            type: "POST",
            url: ajaxUrl + "filter",
            data: $("#filter").serialize()
        }).done(updateTableByData);```
тогда и доп метод get не нужно вставлять в ajaxController. Так получается?


2 replies
Aleksei Kirillov [1 day ago]
get нужен, он в update используется
$.get(ajaxUrl + id, function (data)



Alexander Shnaider [1 day ago]
а, точно


qf05 [3:31 PM]
commented on Ma3stro’s file image
От Ajax. Стандартная отрисовка таблицы.
Alexander Shnaider [3:33 PM]
ну я так понял это вместе с бутстрапом появилось как стандартная часть таблицы, только где это всё описывается не знаю, возможно внутри бутстрапа где- то. Там ведь ещё есть значки упорядочивания над каждой колонкой и надпись внизу таблицы. Мы ничего этого не создавали вручную


Ma3stro [May 8th at 3:37 PM]
in #hw9
Я правда не понял, как в случае ниже при отрисовке таблицы js понимает, что row - это именно row (запись в таблице), а data - это data?
```"createdRow": function (row, data, dataIndex) {
            if (!data.enabled) {
                $(row).attr("data-userEnabled", false);
            }
        }```
Ну и в подобных ситуациях в принципе (edited)


2 replies
Aleksei Kirillov [1 day ago]
DataTable передается объект, в котором есть поля.
полю createdRow присвоена наша функция.
в jQuery.dataTables.js определен ее формат:
        /**
         * This function is called when a TR element is created (and all TD child
         * elements have been inserted), or registered if using a DOM source, allowing
         * manipulation of the TR element (adding classes etc).
         *  @type function
         *  @param {node} row "TR" element for the current row
         *  @param {array} data Raw data array for this row
         *  @param {int} dataIndex The index of this row in the internal aoData array
         *
         *  @dtopt Callbacks
         *  @name DataTable.defaults.createdRow
         *
         *  @example
         *    $(document).ready( function() {
         *      $('#example').dataTable( {
         *        "createdRow": function( row, data, dataIndex ) {
         *          // Bold the grade for all 'A' grade browsers
         *          if ( data[4] == "A" )
         *          {
         *            $('td:eq(4)', row).html( '<b>A</b>' );
         *          }
         *        }
         *      } );
         *    } );
         */
        "fnCreatedRow": null,



Grigory Kislin [1 day ago]
это документация к datatables (на всякий случай:)


qf05 [May 8th at 9:15 PM]
in #hw9
Я тут заметил, что если в тестах убрать очистку кэша 2-го лвла у хибернейт, то всё работает. Почему? раньше ведь не работало.


1 reply
Grigory Kislin [1 day ago]
этож зависит от порядка тестов
причем у одних может работать, у других- нет


Alexander Shnaider [Yesterday at 12:09 AM]
in #hw9
Подскажите как правильно добавить timedatepicker в jsp. нашёл эту либу в мавен библиотеках, но как к ней путь прописать не очень пойму, пробовал `/META-INF/resources/webjars/datetimepicker/2.5.14/jquery.datetimepicker.css` НА стеке советовали создать папку либ и в неё скопировать jar. Как правильно?


4 replies
Alexander Shnaider [1 day ago]
отвечая на свой вопрос https://stackoverflow.com/a/27228842
Stack Overflow
Referencing a js maven dependency from a JSP
I don't know if this a dumb question but as I'm new to Maven I don't really know how to deal with this: I'm currently working on a webapp (struts2) project using Maven project structure, and I've ...
 


Vladimir Gorbatenko [1 day ago]
У меня получилось только когда полную версию добавил.
<link rel="stylesheet" href="webjars/datetimepicker/2.5.14/build/jquery.datetimepicker.min.css">
<script type="text/javascript" src="webjars/datetimepicker/2.5.14/build/jquery.datetimepicker.full.js" defer></script>


Vladimir Gorbatenko [1 day ago]
А зачем через /META-INF/? Подключается точно также как и бутстрап и дататейблс. В pom.xml зависимость была добавлена ранее.


Vladimir Gorbatenko [1 day ago]
http://i6.pixs.ru/storage/9/4/3/datetimepi_6769763_30171943.jpg (80 kB)


Vladimir Gorbatenko [Yesterday at 9:01 AM]
in #hw9
Не могу понять, почему одни вещи для меня капец какие очевидные и решаются легче простого, а другие люди на них залипают. А вот когда действительно "непонятно откуда взялась сова" - многие легко въезжают, а я совсем не понимаю откуда ноги растут... (edited)



1 reply
Dmitry Neustupov [1 day ago]
Это нормально


Vyacheslav [Yesterday at 12:39 PM]
in #hw9
Народ. Чиню тесты. Добавляю .with(userHttpBasic(USER)) и with - красный. Импорты вроде совпадают.


3 replies
Vladimir Gorbatenko [22 hours ago]
не в том месте вставляешь, перед второй закрывающей скобкой )


Vladimir Gorbatenko [22 hours ago]
mockMvc.perform(get(REST_URL + "filter")
               .with(userHttpBasic(USER))


Vyacheslav [22 hours ago]
Точно. Как часто бывает - невнимательность. Спасибо.


poleg [5:58 PM]
500 ошибка, почему-то MealTo не проходит валидацию...

   @PostMapping
   public void createOrUpdate(@Valid MealTo mealTo) {
       if (mealTo.isNew()) {
           super.create(MealsUtil.createNewFromTo(mealTo));
       }
   }

public class MealTo extends BaseTo implements Serializable {

   @NotBlank
   @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)
   private LocalDateTime dateTime;

   @NotBlank
   @Size(min = 2, max = 120)
   private String description;

   @Range(min = 10, max = 5000)
   private int calories;

   public MealTo() {
   }

   public MealTo(Integer id, LocalDateTime dateTime, String description, int calories) {
       super(id);
       this.dateTime = dateTime;
       this.description = description;
       this.calories = calories;
   }

   public LocalDateTime getDateTime() {
       return dateTime;
   }

   public void setDateTime(LocalDateTime dateTime) {
       this.dateTime = dateTime;
   }

   public String getDescription() {
       return description;
   }

   public void setDescription(String description) {
       this.description = description;
   }

   public int getCalories() {
       return calories;
   }

   public void setCalories(int calories) {
       this.calories = calories;
   }

   @Override
   public String toString() {
       return "MealTo{" +
               "dateTime=" + dateTime +
               ", description='" + description + '\'' +
               ", calories=" + calories +
               ", id=" + id +
               '}';
   }
}

   public static Meal createNewFromTo(MealTo newMeal) {
       return new Meal(null, newMeal.getDateTime(), newMeal.getDescription(), newMeal.getCalories());
   } (edited)

poleg [1 day ago]
Сам спросил - сам ответил )
  @NotBlank
  @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)
  private LocalDateTime dateTime;

  @NotBlank тут лишний


Yevhen Maksymovych [7:01 PM]
ребят, я тут с опозданием начал всё делать. кто-то может пояснить, как у нас работает локализация в нотифаях? я тупо не могу понять, где происходит вся магия, откуда BeanPropertyBindingResult знает, на каком языке нам отдавать FieldError.getDefaultMessage()? (edited)


ma1oyby [Today at 11:49 AM]
in #hw9
Народ, кто делал валидациб через Validation Groups сразу на Meal, как вы чинили AbstractMealServiceTest.testValidation()? Не выбрасываются ожидаемые исключения на ограничения по валидации.


1 reply
Grigory Kislin [1 hour ago]
если это связано с jdbc тестами- то валидации там нет


ma1oyby [10:38 PM]
added this Java snippet: Валятся тесты jpa datajpa: 
public class Meal extends AbstractBaseEntity {
  public static final String ALL_SORTED = "Meal.getAll";
  public static final String DELETE = "Meal.delete";
  public static final String GET_BETWEEN = "Meal.getBetween";
​
  @Column(name = "date_time", nullable = false)
  @NotNull(groups = {ValidationUtil.ValidateGroup.class})
  @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)
  private LocalDateTime dateTime;
​
  @Column(name = "description", nullable = false)
  @NotBlank(groups = {ValidationUtil.ValidateGroup.class})
  @Size(min = 2, max = 120, groups = {ValidationUtil.ValidateGroup.class})
  private String description;
​
  @Column(name = "calories", nullable = false)
  @Range(min = 10, max = 5000, groups = ValidationUtil.ValidateGroup.class)
  @NotNull(groups = {ValidationUtil.ValidateGroup.class})
  private Integer calories;
​
  @ManyToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "user_id", nullable = false)
  @OnDelete(action = OnDeleteAction.CASCADE)
  @NotNull
  private User user;
​
   // constructors & getters & setters
​
	
	@Test
  public void testValidation() throws Exception {
    Assume.assumeTrue(isJpaBased());
    validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), " ", 300), USER_ID), ConstraintViolationException.class);
    validateRootCause(() -> service.create(new Meal(null, null, "Description", 300), USER_ID), ConstraintViolationException.class);
    validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), "Description", 9), USER_ID), ConstraintViolationException.class);
    validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), "Description", 5001), USER_ID), ConstraintViolationException.class);
  }
	
	Test fail:
	22:33:02.791 INFO o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:442 - Executing SQL script from class path resource [db/populateDB.sql]
22:33:02.804 INFO o.springframework.jdbc.datasource.init.ScriptUtils.executeSqlScript:508 - Executed SQL script from class path resource [db/populateDB.sql] in 12 ms.
Hibernate: 
  select
    nextval ('global_seq')
Hibernate: 
  /* insert ru.javawebinar.topjava.model.Meal
    */ insert 
    into
      meals
      (calories, date_time, description, user_id, id) 
    values
      (?, ?, ?, ?, ?)
testValidation(ru.javawebinar.topjava.service.datajpa.DataJpaMealServiceTest)            671 ms
​
​
java.lang.AssertionError: Expected javax.validation.ConstraintViolationException
​
	at org.junit.Assert.fail(Assert.java:88)
	at ru.javawebinar.topjava.service.AbstractServiceTest.validateRootCause(AbstractServiceTest.java:59)
	at ru.javawebinar.topjava.service.AbstractMealServiceTest.testValidation(AbstractMealServiceTest.java:84)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:73)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:83)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
	at org.junit.rules.ExpectedException$ExpectedExceptionStatement.evaluate(ExpectedException.java:239)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Collapse 

ma1oyby [10:39 PM]
тоесть валидация в service.create(....) не срабатывает а в controllers работатет

Grigory Kislin [11:30 PM]
напиши какой результат тестов

ma1oyby [11:33 PM]
uploaded this image: Screenshot from 2018-05-17 23-32-49.png 


ma1oyby [11:34 PM]
Он создает еду с нарушение валидации
через слой сервиса
Да на слое сервиса валидация сделаная с помощью Validation Groups работать не будет. Вот нашел на stackoverflow  https://stackoverflow.com/questions/19425221/spring-validated-in-service-layer
Stack Overflow
Spring @Validated in service layer
Hej, I want to use the @Validated(group=Foo.class) annotation to validate an argument before executing a method like following: public void doFoo(Foo @Validated(groups=Foo.class) foo){} When i put
получается нужно делать MealTo или убирать @NotNull с проперти User в еде. Просто как проигнорировать некоторые проперти при валидации не используя групп(маркерных интерфейсов) я не нашел:slightly_smiling_face:

Grigory Kislin [1:24 AM]
@ma1oyby можешь подробно написать- на каком моменте у тебя затык...какое ДЗ, какой патч?
тесты мы пофиксили в 7_01_HW6_fix_tests
когда они у тебя поломались? патчи все есть в github проекте- можешь там сравнить код (edited)

ma1oyby [2:04 AM]
@Grigory Kislin 1: Реализовать для meal Binding/ Update/ Validation. Проверить работу при пустом значении calories.
При реализации валидации я использовал @Validated({SomeInterfaceGroup.class}) http://blog.codeleak.pl/2014/08/validation-groups-in-spring-mvc.html для валидации еды в контроллере. Потестил Постманом вроде все работает.
blog.codeleak.pl
Validation groups in Spring MVC
Java, Java Enterprise, Spring related technologies blog by Rafał Borowiec


ma1oyby [2:05 AM]
added this Java snippet: MealEntity & MealAjaxController 
public class Meal extends AbstractBaseEntity {
  public static final String ALL_SORTED = "Meal.getAll";
  public static final String DELETE = "Meal.delete";
  public static final String GET_BETWEEN = "Meal.getBetween";
​
  @Column(name = "date_time", nullable = false)
  @NotNull(groups = {ValidationUtil.ValidateGroup.class})
  @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)
  private LocalDateTime dateTime;
​
  @Column(name = "description", nullable = false)
  @NotBlank(groups = {ValidationUtil.ValidateGroup.class})
  @Size(min = 2, max = 120, groups = {ValidationUtil.ValidateGroup.class})
  private String description;
​
  @Column(name = "calories", nullable = false)
  @Range(min = 10, max = 5000, groups = ValidationUtil.ValidateGroup.class)
  @NotNull(groups = {ValidationUtil.ValidateGroup.class})
  private Integer calories;
​
  @ManyToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "user_id", nullable = false)
  @OnDelete(action = OnDeleteAction.CASCADE)
  @NotNull
  private User user;
	
	//constructors, getters & setters
	-----------------------------------
	@RestController
@RequestMapping(value = "/ajax/profile/meals")
public class MealAjaxController extends AbstractMealController implements ReportErrorUnprocessableEntity {
	
  @PostMapping
  public ResponseEntity<String> createOrUpdate(@Validated(ValidationUtil.ValidateGroup.class) Meal meal, BindingResult result) {
    if (result.hasErrors()) {
      return requestReportError(result);
    }
    if (meal.isNew()) {
      super.create(meal);
    } else {
      super.update(meal, meal.getId());
    }
    return new ResponseEntity<>(HttpStatus.OK);
  }
	// another methods
	-----------------------------------------------


ma1oyby [2:06 AM]
added this Java snippet: Untitled 
3: Починить meals тесты, добавить тест на неавторизованный доступ
При выполнении этого пункта столкнулся с проблеммой что тест AbstractMealServiceTest.testValidation() для JPA и DataJPA отваливаются.
	
	@Test
  public void testValidation() throws Exception {
    Assume.assumeTrue(isJpaBased());
    validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), " ", 300), USER_ID), ConstraintViolationException.class);
    validateRootCause(() -> service.create(new Meal(null, null, "Description", 300), USER_ID), ConstraintViolationException.class);
    validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), "Description", 9), USER_ID), ConstraintViolationException.class);
    validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), "Description", 5001), USER_ID), ConstraintViolationException.class);
  }
Collapse 

ma1oyby [2:06 AM]
Во время дебага обнаружил что не получаю ожидаемых ConstraintViolationException при создании еды с невалидными данными (например; description = " " или calories<10), т.е. бины создаются и валидатор не запускается.
После определеного время поисков нашел https://stackoverflow.com/questions/19425221/spring-validated-in-service-layer
Stack Overflow
Spring @Validated in service layer
Hej, I want to use the @Validated(group=Foo.class) annotation to validate an argument before executing a method like following: public void doFoo(Foo @Validated(groups=Foo.class) foo){} When i put

ma1oyby [2:16 AM]
Как не пытался что бы данный тест проходил при использовании для валидации еды -  validation groups, так и не получилось. А с кодом и патчами никаких затыков нету. Просто стало интересно может кто-тоже делал валидацию таким путем - без меалТо тогда как решал данную проблему.
Затыка нету все идет, просто иногда начитаешься документации или статей и пробуешь их применить, но не всегда хватает знаний и понимания как реализовать.:slightly_smiling_face:
