Grigory Kislin [1:59 AM]
joined #hw3.

Grigory Kislin [2:01 AM]
Урок 3: JUnit и работа с RDBMS
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md (edited)

aleksey [2:06 AM]
joined #hw3 along with 2 others.

aleksey [3:12 AM]
@Grigory Kislin почему мы решили не хранить userId в классе Meal ? Он нам нигде и никогда не может понадобиться? В таблице Meal в бд очевидно поле userId должно быть.

Grigory Kislin [1 minute ago]
в уроке есть вопрос


SomeRandomName [3:31 AM]
joined #hw3 along with 6 others.

Ilya [5:37 AM]
Народ, подскажите, плз, постгресс можно смело брать самый последний 10.3 или есть какая-то стабильная-ламповая версия ?

pro [5 hours ago]
ламповая)) красава


pro [5 hours ago]
@Ilya последнюю подтягивай, проблем нету


Ilya [3 hours ago]
@pro да, уже юзаю) кстати, юзеринтерфейс нормасик такой.


Dmitry Makarov [5:40 AM]
joined #hw3 along with 8 others.

Dmitry Neustupov [7:37 AM]
@aleksey А это нормально, что у нас в базе у meals есть userId, а в классе - нет?

Что значит - "нормально"? Приложение работает. Ненормально, когда в приложении есть "лишний" код, который не используется. Для ORM он нам понадобится- мы Meal.user добавим.
@Ilya пользуюсь 10-й версией, полёт нормальный.

alexey [8:40 AM]
commented on hunk.png
со следующими пачами такая же история

Yevhen Maksymovych [10:36 AM]
ребята, подскажите, когда-то мелькала ссылка на план занятий с датами, ни у кого не осталось?

VictorStatko [10:37 AM]
На сайте в описании topjava вроде есть
Где то там

ilya t. [10:38 AM]
https://github.com/JavaWebinar/topjava/tree/doc

Yevhen Maksymovych [4 hours ago]
спасибо!


Tony [3:04 PM]
Господа, обычно приходило письмо с хайлевл описанием занятия. В этот раз не было. Так и должно быть?

realcorwin [3:06 PM]
не должно но было :slightly_smiling_face:
просто открой ссылку на лекцию на гите
только что пришло письмо

Grigory Kislin [3:07 PM]
письмо как раз шлется. там дублирование ссылки на урок

Tony [3:17 PM]
ага, мерси


Artem Murk [4:48 PM]
У кого то есть внятное руководство по установке и настройке postgress?
Необходимо настроить на Убунту 16.04
Не хочет принимать роль user, т.к это входит в область зарезервированных имён (edited)

aleksey [4:52 PM]
У меня Ubunta 16.04 все нормально встало. Опиши подробнее на каком этапе пробема? (edited)

tema.emelyan [4:54 PM]
@Artem Murk это в десятом постгресе? у меня такое тоже по-моему было, из пгадмина не добавлялось, из терминала добавилось (edited)

Artem Murk [4:55 PM]
Сейчас напишу
postgres=# CREATE ROLE user WITH password 'password';
ERROR:  syntax error at or near "user"
LINE 1: CREATE ROLE user WITH password 'password';

qf05 [4:57 PM]
Подскажите, а вот первый пункт домашнего задания, понять, я вроде понял. Потому что изменился путь по которому spring ищет бины. Но я не понял это надо исправлять, что бы работало и с бд и с моск?

Artem Murk [4:57 PM]
пытаюсь сделать через терминал

tema.emelyan [4:58 PM]
точно было что-то такое не помню как решил
может наоборот из пг админа добавилось
в пгадмин соответственно под постгресом заходи

Artem Murk [4:59 PM]
Мм, и как зайти туда? Где качнуть?))

tema.emelyan [4:59 PM]
а какой у тебя постгрес

Artem Murk [5:00 PM]
Походу 9.5

tema.emelyan [5:00 PM]
ну там аскубунту все дела :slightly_smiling_face: (edited)
можно создать юзера user1 например и в проперти файлах поменять юзернейм соответственно (edited)
потом по-моему не так много редакций этого файла, так что не так много проблем с патчами должно быть

Artem Murk [5:02 PM]
Это можно, хотелось бы понять как лучше сделать

tema.emelyan [5:02 PM]
Георгию переделать юзернейм на username? для след выпуска (edited)
хз сам смотри
попробуй пгадмин поставить заодно посмотришь что такое
вообще десятый постгрес и 4ый пгадмин поприятнее конечно, лично мне (edited)

Artem Murk [5:03 PM]
Попробую поставить, время поколупаться ещё есть
Снесу данный постгресс, поставлю другой

tema.emelyan [5:05 PM]
если будешь ставить 4ый пгадмин вот отличный мануал на убунту
https://askubuntu.com/questions/831262/how-to-install-pgadmin-4-in-desktop-mode-on-ubuntu (edited)

Artem Murk [5:08 PM]
Спасибо, я вот подумал может у меня mysql мешает?

tema.emelyan [5:09 PM]
да не, это у постгреса зарезервированое слово, у меня такая же байда была, майсиквела у меня нет (edited)

dmitry_ov [5:09 PM]
Какую версию Postgresql лучше поставить что бы не было проблем ?
9.6 могут быть траблы. 
10 слишком новая ? (edited)

tema.emelyan [5:10 PM]
не слышал проблем ни от кого с десяткой ещё. у самого тоже десятка

Artem Murk [5:10 PM]
Хм, спасибо тезка) за наводки!

tema.emelyan [5:10 PM]
рад помочь

Artem Murk [5:13 PM]
Думаю стоит сообщить @Grigory Kislin за user, переделав в username было бы намного меньше проблем

tema.emelyan [5:14 PM]
пока я только о двоих людях проблемных знаю :smiley:

Artem Murk [5:22 PM]
Ну, возможно остальные на Винде:grinning:
Что самое интересное у меня есть роль user...
Когда вбиваешь в баше команду отобразить всех пользователей \ud

tema.emelyan [5:27 PM]
может всё норм тогда?
поставь туда пароль ему
а какие права у него в \du (edited)

Artem Murk [5:35 PM]
Как я помню есть права суперпользователь, сейчас не за компом, уже завтра буду бороться. Дело в том что у меня такая же ошибка вылетает при попытке назначить ему БД topjava

Grigory Kislin [6:01 PM]
@Artem Murk кавычки нужны. счас в урок вставлю
  ```- psql -c 'create database topjava' -U postgres
  - psql -c 'create user "user"; grant all privileges on database topjava to "user"' -U postgres```

Artem Murk [6:03 PM]
@Grigory Kislin спасибо, завтра попытаюсь сделать)
Делал без кавычек, точно

Aleksey Vra [12:37 AM]
с MySql разобрался за 15 минут, с postgres 2 часа провозился, только чтоб установить..
кое как удалось все же засетить пароль для user.. идеа смогла приконнектиться.. 
но при тесте коннекта идеа виснет намертво на несколько минут, иногда внизу всплывают сообщения что не прошла аунтификация с бд.. нажимаешь коннект снова, снова вис, но уже все проходит..
коннект к бд при запуске скриптов больше минуты.. это нормально? никогда таких глюков с подвисаниме в ubuntu не встречал..

Grigory Kislin [6 hours ago]
у меня сразу коннектится. можно и с MySQL если с постгресом проблемы. но с java в основном он используется
попробуй версии пониже поставить
мы еще hsql на след. уроке введем, те можно вообще без установленной базы.. но тогда и опыта с ним не будет (edited)


Aleksey Vra [5 hours ago]
вот и я так подумал и решил все же добить) 
решил полной переустановкой postgres, теперь коннекты за доли секунды.
жаль что так и не понял в чем проблема была, ошибок то не было, база отображалась, порльзователь тоже.


Andrii [12:44 AM]
Подскажите, правильно ли, что страница с едой, после всех патчей открываться не должна? Ошибка (HTTP Status 500 – Internal Server Error) . 
Где можно посмотреть верный код после всех патчей? 
Заранее спасибо.

Mikhail Makar [19 hours ago]
Да, правильно, приложение после накатки всех патчей становится нерабочим и нам нужно это исправить!



Grigory Kislin [6 hours ago]
в уроке все есть- читай внимательно


This message was deleted.

aleksey [15 hours ago]
Если не ошибаюсь, то SpringMain оказывается в тестах после патчей. По крайней мере у меня он там оказался. В тестах мы не используем dataSource, мы используем моки вместо настоящей базы даных


aleksey [15 hours ago]
Вообще для тестов правильней, на мой взгляд, создать отдельный xml для конфигурации контекста отдельно для тестов. И из тестов обращаться именно к нему.


Ilya [14 hours ago]
@aleksey в целом да, но просто интересно - если даже в спрингмэине скормить xml с бином для БД, то сам процесс сохранения запускается, но спотыкается на             
Number newKey = insertUser.executeAndReturnKey(map);
причем, в самой мапе все, вроде, корректно собралось. 
ну да ладно, надо идти перечитывать в очередной раз


Tanya [4:50 AM]
совет
перед тем как приступать к HW3
*внимательно* прочитайте все пункты задания, "Ответы на Ваши вопросы" и "Ваши вопросы"

Ilya [8:42 AM]
еще вопрос, финальные поля выпиливаем из Meals ? как иначе юзать сеттеры и дефолтный конструктор.

alexey [9:26 AM]
у меня у одного какая то лажа с сайтом https://www.enterprisedb.com. Верхняя часть сайта все время скрыта (edited)
enterprisedb.com
EnterpriseDB
The Postgres Database Company

Ilya [9:34 AM]
@alexey не, судя по всему какой-то косяк, вчера все ок было

Artem Murk [10:07 AM]
Ура, БД заработало!

qf05 [12:07 PM]
Подскажите, когда мы делаем, например, get запрос, то из базы мы достаём meal, а потом проверяем его на принадлежность пользователю, или мы не достаём из базы ничего, если еда не принадлежит пользователю(т.е. проверка в базе)
пробовал вот так: SELECT * FROM meals WHERE id=? && userId=?",ROW_MAPPER, id,userId)
но получаю ошибку синтаксиса.

Dmitry Makarov [8 hours ago]
https://postgrespro.ru/docs/postgresql/9.4/functions-logical.html
postgrespro.ru
PostgreSQL : Документация: 9.4: Логические операторы (9 kB)
 


qf05 [8 hours ago]
спасибо!!!


Aleksey Vra [4:15 PM]
```@Autowired
    public MealServiceImpl(MealRepository repository) {
        this.repository = repository;
    }```
как сюда инжектнуть бин InMemoryMealRepositoryImpl, тот что в папке тест лежит?
как вручную создать этот bean? через конфигт не получается путь указать

roma [4:16 PM]
при накатке патча 3_07

roma [4:16 PM]
uploaded this image: image.png 


roma [4:17 PM]
после нажатия скип

roma [4:17 PM]
uploaded this image: image.png 


roma [4:18 PM]
вроде как накатывается но все файлы попадают в чендж лист дефаулт

Aleksey Vra [4:21 PM]
```@Autowired
    public MealServiceImpl(@Qualifier("jdbcMealRepository") MealRepository repository) {
        this.repository = repository;
    }```
jdbcMealRepository инжектится, так как бин указваю в конфиге,
а вот как создать bean класса, который в папке тест?

Mikhail Makar [3 hours ago]
Я разрешил эту ситуацию созданием отдельного тестового контекста спринга и там уже прописал бины, классы SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest стали работать!



Mikhail Makar [3 hours ago]
Ещё нужно будет в тестовых класса поменять ссылку на тестовый контекст спринга!


Aleksey Vra [3 hours ago]
а как указать путь к бину InMemoryAdminRestControllerTest?


Grigory Kislin [3 hours ago]
укажи пакет для сканирования, где находится этот класс


Aleksey Vra [2 hours ago]
в том то и дело что пакет для сканирования невозможно указать.. если создать конфиг в папке ресурсы в тест, то путь прописывается.. думал можно из 1 го места все это дело прописать


roma [4:40 PM]
Блин а про накатку патча - №7 - только у меня одного такая фигня?

Arthur [4:40 PM]
перед накаткой этого патча нужно ручками тестовый каталог создать
в задании написано
Ребята, всем привет! Кто-нибудь смотрел 5-й пункт?
Я перестал понимать следующий момент: MealServiceTest - работает с БД или использует реализацию из памяти....?

roma [4:43 PM]
)))
блин
придется откатиться )
@Arthur спасибо
@Arthur глянь плиз свой VersionControl log на этом комите - похож он на такой (6 файлов) (в тесты перенесено SpringMain и две Мемори реализации репозитория) - все так? (edited)

roma [4:49 PM]
uploaded this image: image.png 


Arthur [4:51 PM]
вроде похож
проект у тебя в этой точке собирается?

roma [4:52 PM]
Потому что даже после создания test каталога skip при накатке патча все равно пришлось нажимать
ща попробую собрать

Arthur [4:53 PM]
если собирается, то все ок

roma [4:53 PM]
погоди а как он может собираться в этой точке - если мы репозиторий убрали в тесты а сприг у нас не поднимает бины из тестов? (edited)

poleg [4:54 PM]
Вопрос по 4. Тестирование через JUnit. В лекции говорится что тесты (если не выключено в настройках мавена) запускаются при сборке проекта. А почему тогда когда запускаю приложение через деплой в Tomcat в консоль ничего не выводится? Ведь к деплою приходим через сборку. (edited)


Grigory Kislin [3 hours ago]
при деплое idea сама компилирует классы. без maven (edited)


poleg [2 hours ago]
Хм. Не совсем понятно. Можно чуть подробнее?


Grigory Kislin [2 hours ago]
при деплое idea не запускает фазы сборки maven
в чем недопонимание?


poleg [2 hours ago]
Наверное, я чего-то упустил ) То есть вот запускаем проект, и пошли по фазам мавена. А если не пошли то откуда идея возьмет вот все эти классы, которые мавен подтягивает?


poleg [2 hours ago]
Как соберет все вот это без мавена


Grigory Kislin [2 hours ago]
maven запускает javaс
какие проблемы без него собрать?
где находятся классы idea знает
можешь попробовать меню: Build->Build Artefacts


poleg [2 hours ago]
Ага, дошло.


roma [5:05 PM]
@poleg я так понял, то что говориться в лекции - при сборке проекта стадия тестов проходит но в jar эта вся фигня не попадает - соответственно в томкате этого добра уже быть не может. А кнопочка (функционал maven) - это, когда ты собираешь - может проходиться стадия test (сборки) а может не проходиться - но в любом случае (при нажатой или нет) в jar это добро не попадает (edited)

poleg [5:15 PM]
Я к тому, что строчки +++ PostConstruct и т.д. должны все равно ведь мелькнуть в логах.

roma [5:27 PM]
Мне кажется, что идея, зная что томкату тесты не нужны собирает проект без тестов - поэтому логи эти не мелькают

poleg [5:28 PM]
Собственно, Григорий ответил выше.

Anton Kiselev [5:54 PM]
скажите, инфа по откатке патча в каком уроке была?
ну или как его сделать)

Arthur [6:02 PM]
можно через идею - в гите выбираешь нужный камит, потом "Reset current branch to here"

Anton Kiselev [6:03 PM]
@Arthur Благодарю

Ma3stro [6:32 PM]
uploaded and commented on this image: image.png 

Почему мне ругается на депенси теста спринга?

Ma3stro [6:33 PM]
После соответствующего патча

mvn clean не помог

qf05 [7:22 PM]
Подскажите, у меня при выполнении дебага в тест классах вылетает такая ошибка:
java.io.FileNotFoundException: C:\Users\Ïîëüçîâàòåëü\AppData\Local\Temp\capture35513.props (Системе не удается найти указанный путь)
Но после этого всё запускается и работает. В каталоге Temp такого файла нет. Вопрос в том, где взять этот фаил, или как убрать в idee сообщение об этом exeption?

Grigory Kislin [1 day ago]
1. не делай русских букв в именю юзера. да и вообще при работе с java
2. поставь в Idea кодировку UTF-8: https://github.com/JavaOPs/topjava/wiki/IDEA#%D0%92%D1%8B%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D1%82%D1%8C-%D0%BA%D0%BE%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D1%83-utf-8-%D0%B2-%D0%BA%D0%BE%D0%BD%D1%81%D0%BE%D0%BB%D0%B8


qf05 [1 day ago]
-Dfile.encoding=UTF-8 у меня стоит давно. но иногда всё равно бывает что кракозябры проскакивают, но редко. 
Например при дебаге в тестах только имя пользователя, а при дебаге томкатом ещё и " Системе не удается найти указанный путь" нормально не отображается.


qf05 [1 day ago]
Проблема была действительно в пути к папке Temp. Переместил папку и теперь никаких ошибок.


Vitaly M. [8:14 PM]
а можно сразу создать  jdbcTemplate.query запрос, который бы получал один объект? что то я не смог разобраться...
```@Override
    public User get(int id) {
        List<User> users = jdbcTemplate.query("SELECT * FROM users WHERE id=?", ROW_MAPPER, id);
        return DataAccessUtils.singleResult(users);
    }```

Grigory Kislin [1 day ago]
так проще всего


Aleksey Vra [11:35 PM]
не понимаю этот пункт
>Spring test контекст не надо включать в Spring Facets проекта, там должны быть только spring-app.xml и spring-db.xml. Для тестовых контекстов поставьте чекбокс Check test files в Inspections.
у меня подчеркивается красным, так как спринг видит 2 бина, чекбокс не помогает.

Mikhail Makar [1 day ago]
Я тебе сегодня об этом писал, речь идёт о тестовом спринг контексте, который используется для тестирования!
Итого у тебя их будет 3, так вот в facets должны быть только  spring-app.xml и spring-db.xml.


Mikhail Makar [1 day ago]
Речь именно об этом, но как я понял, можно и без тестового контекста обойтись, но в этом я не разобрался!


Yevhen Maksymovych [1 day ago]
я подолбился, и не понял, если честно, как это сделать: у нас две разных имплементации репы. Сервис один, соответственно, если контекст содержит обе эти имплементации мы должны указать в сервисе квалификатор


Yevhen Maksymovych [1 day ago]
но т.к. у нас сервис инстанцируется в контроллере, а контроллер дергается из разных скопов с разным репом, мы как-то должны указать, что для одного скопа его сервис должен быть с одним репом, а для другого - с другим.


Yevhen Maksymovych [1 day ago]
хз, как это сделать аннотациями

Yevhen Maksymovych [1 day ago]
в xml можно было бы просто создать два разных бина с разным именами на основании одного класса, но непонятно, как это сделать при конфигурированни аннотациями


Mikhail Makar [1 day ago]
Да, я  тоже всю логику не понял, поэтому просто добавил ещё один xml для тестов!


Yevhen Maksymovych [1 day ago]
вроде как можно с помощью @Profile, но это несколько тупо, потому как мы в сервисе будем держать инфу о том, что для тестов он должен инстанцироваться отдельным образом. по-хорошему, насколько я понимаю, код тестов должен быть отделен от кода проектов


Yevhen Maksymovych [1 day ago]
я тоже просто сделал отдельным хмл ))


Mikhail Makar [1 day ago]
Это видимо самый ленивый способ, но зато рабочий)))


Aleksey Vra [1 day ago]
в итоге я тоже сделал отдельным, но я так и не понял как убрать это предупреждение?


Yevhen Maksymovych [1 day ago]
да не должно быть никакого предупреждения

Yevhen Maksymovych [1 day ago]
у тебя в фасетах только два конфига?


Yevhen Maksymovych [1 day ago]
-app и -db?


Aleksey Vra [1 day ago]
2 конфига в ресурсах, и 1 конфиг для тестов в папке тест


Aleksey Vra [1 day ago]
тесты работают


Yevhen Maksymovych [1 day ago]
не, именно на странице фасетов - вот тут:

Yevhen Maksymovych [1 day ago]
project structure - facets - spring


Yevhen Maksymovych [1 day ago]
я просто не мапил spring-test.xml в фасеты



Yevhen Maksymovych [1 day ago]
в spring-app репы мапятся как .jdbc, и, соответственно, идея не знает о других реализациях, и не подчеркивает


Yevhen Maksymovych [1 day ago]
а в .spring-test как .mock


Aleksey Vra [1 day ago]
все, дошло, огромное спасибо) часа 2 ковырялся и так и эдак)


Yevhen Maksymovych [1 day ago]
:+1:


Mikhail Makar [24 hours ago]
Я сначала тоже не понял как делать, даже начал qualifier добавлять, а всё оказалось куда проще)


roma [8:48 AM]
uploaded this image: image.png 


roma [8:48 AM]
У меня 8 патч накатвается а зависимость подтянуть не может - пишет что не найдена...

roma [9:06 AM]
uploaded and commented on this image: image.png 

а 5.03 - подтягивает спокойно

roma [9:08 AM]
в чем может быть дело?

roma [12:46 PM]
Блин мне то что делать с версией СпрингТест ?

Dmitry Neustupov [12:49 PM]
@roma так оставь 5.0.3

roma [12:51 PM]
так при накатке патчей - будет слетать все время - когда .pom будет меняьться - но это я конечно переживу )....

Aleksei Kirillov [12:53 PM]
uploaded and commented on this image: изображение.png 

Попробуй здесь поковырять.
Может update поможет

Aleksey Vra [12:58 PM]
@roma а идеа сама не предлагает исправить?
у меня что то похожее было, зависимости не подгружались.
нажал алт+энтер, выбрал пункт индексация( что то такое), идеа долго исправляла, обновляла мавен, затем ребутнул идеа

roma [1:00 PM]
Сейчас попробую спасибо - идея пока в шоке от того что я нажал update на удаленном репозитории ))) - ушла в себя )... Вернется попробую при помощи нее исправить... У меня кстати локал репозиторий тоже последнее обновление - дата стоит раньше выход СпрингТест 5.04 (edited)

Aleksey Vra [1:05 PM]
слетело после того как убунту перестановил, причем 1 раз зашел в идеа, все норм, 2 раз захожу, пишет настроек нет.. ну и мавен только половину зависимостей подгрузил..
у меня мин 10-15 исправлялось

Aleksey Vra [1:06 PM]
еще слетела настройка file -settings - build, execution, deployment - maven - checkbox 'always update snapshot'

roma [9 hours ago]
@Aleksey Vra @Aleksei KirillovРЕбята спаибо сделал upate обоих репозиториев, поставил галку allways update snupsot, помогло - подтянулаь нужная версия спрингТетов (edited)


roma [1:08 PM]
спаисбо - ее тоже гляну - только сейчас идея доделает свои дела ))) - а то я пока только в режими наблюдателя с ней могу работать

Aleksei Kirillov [1:09 PM]
В help по idea написано: Update - Click this button to update indices of the selected repository. It might be helpful in case you expect to get information for newly deployed artifacts such as new versions of libraries that you use in the project. Also when you use maven dependencies completion in pom.xml or generation of maven dependencies using Maven Artifact Search dialog.

Arthur [1:26 PM]
у меня такое бывает, когда 2 инстанса идеи случайно запускаю
Aleksey Vra
слетело после того как убунту перестановил, причем 1 раз зашел в идеа, все норм, 2 раз захожу, пишет настроек нет.. ну и мавен только половину зависимостей подгрузил..
у меня мин 10-15 исправлялось
Posted in #hw3
Yesterday at 1:05 PM

Aleksey Vra [1:40 PM]
возможно я через applications по ярлыку запустил, вот настройки и слетели, выяснять не стал, сейчас запускаю через консоль в корне idea - ./idea.sh и все отлично работает

Aleksey Vra [2:45 PM]
при тетсировании удаления из табилицы meals, достаточно же будет просто проверить отстутсвие удаленной еды в базе?

Nedfrench [2:46 PM]
Добрый день.
Подскажите, пож-та,  видео 3_01_HW2 начинается с разбора LoggedUser, но в текущей реализации проекта это AuthorizedUser?
Я правильно понимаю? Не нашел где указанно данное изменение.
Зачем в LoggedUser методы static?

Aleksei Kirillov [2:56 PM]
Наверное потому, что это пока класс-заглушка. Просто выдает тестовые данные.

Nedfrench [9 hours ago]
Спасибо.


roma [3:35 PM]
я когда добавляю Postgres в IDEA у меня тянуться вcе роли (7 штук) из pgAdmin - это норм? Или нужно в pgAdmin настроить так что бы owner базы topjava - был только user ? И еще вопрос в pgAdmin4 какие галки должны стоять у роли в Priveleges (У меня только Can login и inherit rights from the parent roles)? (edited)

Aleksey Vra [9 hours ago]
все так же по умолчанию..
с базой все запросы отрабатываются, а роли нужны для администрирования


Aleksey Vra [6:30 PM]
не знаю насколько правильно сделал тесты, но на зеленые кружочки во время выполнения приятно смотреть)

realcorwin [7:45 PM]
кто уже ставил постгрес: рядом с mysql нормально встаёт? они друг другу не мешают?

ilya t. [7:47 PM]
ага, все норм

realcorwin [7:50 PM]
спс

Mikhail Makar [8:33 PM]
Кто-нибудь для тестирования добавлял userId в класс Meal?

Aleksey Vra [8:40 PM]
>3.2. userId в класс Meal вставлять НЕ надо (для UI и REST это лишние данные, userId это id залогиненного пользователя)

Mikhail Makar [3 hours ago]
Я вот хз пока как это сделать, мы ведь базу наполняем с использованием userId, а вот как потом его доставать, если в классе Meal его нет?
Вот здесь тормоз у меня.


Mikhail Makar [3 hours ago]
Мы просто берём USER_ID?


Aleksey Vra [3 hours ago]
верно


Aleksey Vra [8:40 PM]
хотел добавить, но прочитав, понял что и без добавления можно (edited)


realcorwin [2:06 AM]
обгоняет нас постгрес :slightly_smiling_face:. jdbc драйвер 15 марта версией 42.2.2 вышел

poleg [1:26 PM]
Создать в pgAdmin новую базу topjava и новую роль user, пароль password - или в UNIX командной строке:
- psql -c 'create database topjava' -U postgres
- psql -c 'create user "user";

А вот это как сделать через pgAdmin? - psql -c 'grant all privileges on database topjava to "user"' -U postgres

tema.emelyan [1:32 PM]
в пгадмине правой кнопкой мыши щёлкнуть на Roles по-моему

poleg [1:35 PM]
Там нет выбора базы, на которую права даем

poleg [1:44 PM]
Что-то ерунда какая-то с этим pgAdmin. Создал базу, создал юзера, а воможности дать права этому юзеру на определенную базу нет. Как так?

Grigory Kislin [4 hours ago]
я полагаю это делается в databaseа не в юзерах


Nedfrench [2:29 PM]
Я один "spring-jdbc" не знаю? 
Никто не поделиться ссылкой на статью об инструментах используемых в JdbcUserRepositoryImpl?

Aleksey Vra [2:43 PM]
тоже не знал, но в процессе написания JdbcMeal* как то все проясняется.. к HW3 ссылка есть https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc

poleg [2:43 PM]
Снес десятку, поставил 9.5, все сразу получилось.

poleg [3:53 PM]
Не проходит соединение с базой на heroky
В настройках вроде все правильно прописал
host ec2-54-217-202-110.eu-west-1.compute.amazonaws.com
port 5432
DB dehm6lvm8bink0
user wegxlfzjjgxaxy
pwd SSQyKKE_e93kiUCR-ehzMcKCxZ

В advanced
ssl true
sslfactory org.postgresql.ssl.NonValidatingFactory

Test Connection - failed 08001
Что я делаю не так?

poleg [4:13 PM]
И еще - а зачем настройки прописываются в двух местах - во вкладке Databases DataSources и в db/postgres.properties ?

Arthur [4:49 PM]
db/postgres.properties юзаются апликейшеном, который крутится в томкате. А вкладки - средой IDE. Они друг про друга ничего не знают (edited)

poleg [4:51 PM]
Я к тому что настройки и там и там одни и те же, почему бы IDE автоматом не сгенерить db/postgres.properties? (edited)

Arthur [4:52 PM]
продложи эту фитчу компании JetBrains :slightly_smiling_face: (edited)

poleg [4:55 PM]
По поводу коннекта, пардон, к хероку, что у меня не так? Или сервер ушел в даун?:electric_plug:

Nedfrench [6:16 PM]
Пункт 1 HW03 нужно только разобраться почему не работает, исправлять не нужно?

roma [6:59 PM]
В книге Spring in action еть такая фраза:
```В прошлом приходилось тщательно взвешивать выбор того или иного шаблона JDBC. Но в последних версиях Spring сделать выбор намного проще. В версии Spring 2.5 поддержка именованных парамет- ров из NamedParameterJdbcTemplate была добавлена в SimpleJdbcTemplate. А в версии Spring 3.0 была ликвидирована поддержка старых вер- сий Java (ниже версии Java 5), поэтому выбор шаблона JdbcTemplate не дает никаких преимуществ перед SimpleJdbcTemplate```
Почему мы используем 2 разных шаблона - ели могли бы пользоваться одним SimpleJdbcTemplate?

aleksey [7:09 PM]
Потому что книжка старая и SimpleJdbcTemplate deprecated ныне

dmitry_ov [7:43 PM]
Накатил  все патчи. После последнего ошибки  в файле: 
src/test/java/ru/javawebinar/topjava/web/InMemoryAdminRestControllerSpringTest.java  

@Autowired
private InMemoryUserRepositoryImpl repository;
Could not Autowire. No beans InMemoryUserRepositoryImpl type found

Кто нибудь сталкивался с этим ?
“Maven clean” делал (edited)

Aleksey Vra [5 hours ago]
все сталкивались
>1 Понять, почему перестали работать SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest



dmitry_ov [5 hours ago]
Аа…блин)


dmitry_ov [5 hours ago]
это в ДЗ


dmitry_ov [5 hours ago]
Спасибо. Вопрос закрыт:-)


Aleksey Vra [5 hours ago]
выше thread есть где это обсуждалось)


Alex83 [8:35 PM]
всем привет!

Alex83 [8:36 PM]
поясните после создания папки mock, каким образом создается junit

Grigory Kislin [3 hours ago]
в optional уроке есть: 
Ctrl+Shift+T (выбрать JUnit4)
про это?


Alex83 [8:36 PM]
?
там какая-то магия происходит и он сам собой появляется
ощущение как будто папку database драгндропом перенесли

Ma3stro [8:39 PM]
Почему Qualifier отказывается работать?
 ```@Autowired
@Qualifier("inMemoryUserRepositoryImlp") //cannot find bean
private InMemoryUserRepositoryImpl repository;

@Repository
@Qualifier("inMemoryUserRepositoryImpl")
public class InMemoryUserRepositoryImpl implements UserRepository {```


VictorStatko [4 hours ago]
В ковычках не Impl, а Imlp


Ma3stro [4 hours ago]
Исправил, до сих пор тоже самое


Ma3stro [4 hours ago]
Если просто сделать = new InMemory... и запустить, то почему-то идет работа с БД вообще, интересно)


Grigory Kislin [3 hours ago]
полагаю что InMemoryUserRepositoryImpl  не попадает в контекст спринг


Ma3stro [8:44 PM]
replied to a thread:







Если просто сделать = new InMemory... и запустить, то почему-то идет работа с БД вообще, интересно)

ivanpobeguts [8:53 PM]
Коллеги, подскажите, пожалуйста. Я на винде создал пользователя user с паролем password. Я так понимаю, что у меня такая же проблема, как была выше, но там был линукс. При попытки подключиться из идеи:
The specified database user/password combination is rejected: [28P01] ВАЖНО: пользователь "user" не прошёл проверку подлинности (по паролю)

Я так понимаю, слово user нельзя использовать. Писать в кавычках "user"? Тогда он постгрес его так и создаёт - "user".

ivanpobeguts [9:09 PM]
Хотя пробую создавать пользователей с другими именами - та же ошибка. Пароль уже перепроверял - всё правильно.

roma [9:29 PM]
У меня винда - вначале такое тоже было так как я пасворд не задал )

ivanpobeguts [9:30 PM]
Хм, оказалось, надо было перезагрузить IDEA)

roma [9:33 PM]
Мне для теста getAll и getBeetween нужно както в populateDB - данные даты вбить - не понима в каком формате их туда засунуть что бы их съела база
Пытаюсь как тут написано
```http://postgresql.ru.net/manual/datatype-datetime.html```
вводить
```1999-01-08 04:05:06```
и ничего не получается

roma [9:39 PM]
Вроде нашел )))
```(TIMESTAMP '2011-05-16 15:36:38')```

Nedfrench [3 hours ago]
как раз этим вопросом озадачился)) Спасибо


roma [3 hours ago]
не за что )


Grigory Kislin [9:46 PM]
@poleg
> Не проходит соединение с базой на heroky
Коллеги, обновил патч 3_09_add_postgresql
https://drive.google.com/open?id=1ON7WUOWsiav1e0l5tOA1OR7bf_QQIndP
креденшелы к рабочей базе:
```#database.url=jdbc:postgresql://ec2-54-247-74-197.eu-west-1.compute.amazonaws.com:5432/de4fjsqhdvl7ld?ssl=true&sslfactory=org.postgresql.ssl.NonValidatingFactory
#database.username=anbxkjtzukqacj
#database.password=da1f25b2a38784fb0d46858e5b8fc168e08c9e1e9c72faea5bbac9c0e1f9c24f```
+ запушил патчи урока (edited)

roma [9:50 PM]
@Grigory Kislin В мастере надо теперь до него откатиться и заново накатить его и то что после? (edited)

Grigory Kislin [3 hours ago]
не обязательно.


Nedfrench [9:51 PM]
Ура! Выполнил основную часть HW03.

dmitry_ov [10:33 PM]
added and commented on this Shell snippet: Untitled 
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
​
Collapse 
@Grigory Kislin

Создаем src/main/resources/spring/spring-db.xml
Добавляем в него эти строки.

А что это за строки, откуда они берутся ?
Если это было объяснено  в лекции, дайте конктеную ссылку : имя видео::ремя
Grigory Kislin [10:43 PM]
стандартные namespace spring
можно из документации взять, проще скопировать

roma [10:53 PM]
Не могу не поделиться: - Время позднее (сейчас)- сижу пилю тесты (муторное дело - ОЧЕНЬ).... В голове почти не прекращаясь играет мысль - нафиг я все это пишу сейчас, если в пункте 4 Д.З. я запустил приложение и проверил каждую его функциональность... Дохожу до проверки теста
```updateNotFound()...```
с мыслями сейчас допилю побырому
```deleteNotFound и getNotFound```
и с тестами покончено... - и не прохожу этот тест (exeption не бросился) - полез в JdbcMealRepositoryImpl и оказалось что только в этом методе (get и delete правильно) у меня по запаре оставленно прото
```WHERE id=:id```
, а не
```WHERE (id=:id AND user_id=:user_id)```
.... Поле чего тесты getNotFound и deleteNotFound - допиливал с мыслью - "не плохая вещь эти тесты ) - хоть и муторная" :wink:


AntonY [6:16 AM]
Кто дошел до тестов, подскажите как быть. В финальные переменные лучше заносить объекты Meal или делать записи как в таблице с userid? Если делать без userid то тогда сравнение объектов как производить? Короче, запутался в мыслях :slightly_smiling_face:

Tanya [8:28 AM]
обязательно делайте тест на update чужой еды!
некорректно реализованный save в JdbcMealRepositoryImpl - одна из частных ошибок (edited)

poleg [10:26 AM]
Не могу догнать, где этот бин нужно прописывать?
No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate.

Vladimir Gorbatenko [10:27 AM]
В SpringMain, ...."spring/spring-app.xml", "spring/spring-db.xml"
poleg
Не могу догнать, где этот бин нужно прописывать?
No qualifying bean of type 'javax.sql.DataSource' available: expected at least 1 bean which qualifies as autowire candidate.
Posted in #hw3
Today at 10:26 AM

poleg [10:29 AM]
Блин, точно.

poleg [11:05 AM]
Теперь в MealServiceImpl ругается: expected single matching bean but found 2: jdbcMealRepositoryImpl,inMemoryMealRepositoryImpl
Ну ок, пишу
   @Autowired
   public MealServiceImpl(@Qualifier("JdbcMealRepositoryImpl") MealRepository repository) {
       this.repository = repository;
   }
но @Qualifier("JdbcMealRepositoryImpl") подсвечивает красным - бин не найден...

Хотя это есть  <context:component-scan base-package="ru.javawebinar.**.repository.jdbc"/>

Pavel Zaitcev [9 hours ago]
"jdbcMealRepositoryImpl".


poleg [9 hours ago]
Блин )))


mila [12:49 PM]
после 7го патча в уроке есть вопрос почему падает страница с едой, вижу что спринг не может найти имплементацию MealRepository, это потому что её перенесли в папку test?  а почему расположение у неё осталось package ru.javawebinar.topjava.repository.mock ? судя по пэкэджу должен найти.
то ли я никогда не обращала на это внимание то ли никогда не задавалась вопросом - у нас тут какието две параллельные структуры файлов? типа одна обычная джавашная, вторая местная идеевская ? и спринг смотрит на ту которая в idea?

dustnfox [7 hours ago]
@mila "это норма"(с) :slightly_smiling_face:  Вообще, если я правильно помню, то СРАЗУ после седьмого патча, страница еды упадет с NullPointerException ибо реализация присутствует, но в ней одни "заглушки". Если ты уже руками попыталась подсунуть  в MealService использование mock вместо jdbc, тогда другое дело.  В этом случае неплохо бы описать, что ты уже сделала


Pavel Zaitcev [7 hours ago]
Все, что находится в папке "test", не включается в сборку проекта.


mila [7 hours ago]
@dustnfox не делала ничего, после 7го патча у меня страница упала с сообщением что не найден бин для MealRepository


mila [7 hours ago]
да, я поняла что это изза папки тест, но вопрос о структуре файлов остаётся открытым

mila [7 hours ago]
почему package у InMemoryMealRepositoryImpl не поменялся?


dustnfox [7 hours ago]
@mila А почему ты считаешь он должен был поменяться? Я имею в виду, как он должен по-твоему выглядеть, после переноса mock в test? package считается от classpath. Для тестов это `src\test\java`, для приложения - `src\main\java` Относительный путь как был `ru.javawebinar.topjava.repository.mock` так и остался.


dustnfox [7 hours ago]
Как правильно заметил @Pavel Zaitcev директория с скомпилированными тестами при нормальном запуске приложения в classpath не попадает. Наша mock реализация - фейковая и приложению, которое будет деплоиться не нужна. То есть пытаться запустить с ней приложение задеплоенное в tomcat не нужно. А вот _почнинить SpringMain, InMemory*Test. InMemory*Test_ как раз таки нужно.


dustnfox [6 hours ago]
@mila прошу прощения. Я - растяпа. Не увидел, что ты только семь патчей накатила. Я думал, что все.  Тем не менее, все, что было написано - верно. Те классы, что компилируются из папки тест, не видны при работе обычного приложения.


mila [6 hours ago]
ок, спс, теперь про относительный путь более менее ясно

roma [6 hours ago]
@dustnfox ладно с путем понятно - а страница то почему падает? Мы же поднимаем спринг конекст... - он поднимает бин репозитория
```ru.javawebinar.topjava.repository.mock```
который находится в
```src\test\java```
.... Почему тогда падаем? (edited)


dustnfox [6 hours ago]
Потому что `ru.javawebinar.topjava.repository.mock` лежит в `topjava\src\test\java` и компилируется в `topjava\target\test-classes`. в то время как `topjava\src\main\java` компилируется в `topjava\target\classes`. IDEA запуская тест дописывает (помимо всего прочего, целиком ключ два экрана занимает :slightly_smiling_face: ) в ключ -classpath оба пути и `target\classes` и `target\test-classes`. Когда в IDEA запускаем не тест, а обычное приложение, она дописывает в -classpath только `target\classes`. Соответственно CLASSLOADER не может найти скомплированный InMemoryMealRepositoryImpl.class



dustnfox [6 hours ago]
Вот как-то так, если я правильно все понимаю. Если нет - пусть старшие товарищи поправляют.


roma [6 hours ago]
ну не плохо )


Grigory Kislin [1 hour ago]
ну да, все верно, все что в test в проект не попадает. можно сделать war (package) и поглядеть, что в него попало


Ma3stro [2:44 PM]
Какие материалы можно почитать для того, чтобы составить запросы и скрипты для БД? Совсем плохо с этим пока

Aleksey Vra [6 hours ago]
делал по аналогии со скриптом initDB, если что то непонятно, гуглил, отличия от MySql незначительные.. если вообще нулевые знания, то любая первая же ссылка в гугле выдаст кучу примеров.. а для запоминания эти примеры лучше повторять в pgAdmin



roma [6 hours ago]
https://postgrespro.ru/docs/postgrespro/10/index мне вот это помогло, но только нужные нам главы
postgrespro.ru
Postgres Pro Standard : Документация: 10: Документация к Postgres Pro Standard 10.3.1 (9 kB)
(edited)


roma [6 hours ago]
Обманул тебя ) - вот этот ресурс: http://postgresql.ru.net/manual/ (edited)



roma [6 hours ago]
хотя все одно помоему)


alexey [Today at 3:18 PM]
in #hw3
Народ помогите с с запросом на фильтрацию. Написал такой (SELECT * FROM meals WHERE datetime BETWEEN " + startDate +" AND "+ endDate), но он все время с ошибкой вылетает про неправильный синтаксис.В чем проблема то?


9 replies
Aleksei Kirillov [5 hours ago]
Замени between на больше /меньше


dustnfox [5 hours ago]
>9: НЕ делайте склейку SQL запросов вручную из параметров, только через jdbcTemplate параметры! См. Внедрение_SQL-кода



alexey [5 hours ago]
Через jdbcTemplate.query что ли надо?


dustnfox [5 hours ago]
В данный момент вообще непонятно в какой метод ты это пихаешь, но в любом случае это ОЧЕНЬ bad practice и так не делается. Нельзя просто так взять и склеить строку запроса из литералов и переменных. Сие чревато очень большими проблемами.


Aleksey Vra [5 hours ago]
в дз еще к этому пунтку ссылка дается, довольно интересно


alexey [5 hours ago]
метод getBetween класса JdbcUserRepositoryImpl.

dustnfox [5 hours ago]
>метод getBetween класса JdbcUserRepositoryImpl.
Тогда совсем непонятно. У нас интерфейс MealRepository никаких строк с SQL запросами не принимает. Только userId и параметры фильтра.


dustnfox [5 hours ago]
Посмотри как у Григория, например, запрос пользователя по email сделан.
`jdbcTemplate.query("SELECT * FROM users WHERE email=?", ROW_MAPPER, email)`
Ничего он в строку не вклеивает через плюсы. Делай по аналогии. В первом параметре ставятся плейсхолдеры `?`. Потом идет `BeanPropertyRowMapper` а дальше vararg, то есть метод принимает неограниченное число аргументов. Все они подставляются на место плейсхолдеров.



alexey [2 hours ago]
спасиб


Ma3stro [Today at 4:39 PM]
in #hw3
Создаю скрипт для таблицы meals после двух первых таблиц с юзерами и ролями. Мы создали в populate двух юзеров, теперь у id еды значение берется не с 100000, а с 100002, как это исправить? (edited)


2 replies
dustnfox [4 hours ago]
Это не баг, это фича :slightly_smiling_face: Григорий специально использует сквозную индексацию. Так и должно быть.  Исправлять не надо. Ну а уж если _прям очень сильно надо_ - создай еще один `sequence` и используй его для `meals`



Ma3stro [4 hours ago]
Окей)


Ivan A [5:40 PM]
народ как добавить https://cloud.githubusercontent.com/assets/13649199/24730713/eb21456a-1a6d-11e7-997c-fb4ad728ba45.png
https://cloud.githubusercontent.com/assets/13649199/24730713/eb21456a-1a6d-11e7-997c-fb4ad728ba45.png
у меня при нажатии на плюсик нету спринга

Ivan A [5:56 PM]
в плагинах не был добавлен спринг

Tanya [7:44 PM]
обратите внимание, что в assertMatch нельзя использовать assertThat *isEqualTo*, в нашем случае не подходит, т.к. через equals сравнивает, а у нас в equals только по id сравнение

Grigory Kislin [8:19 PM]
Добавил в замечания: 
11: В `assertMatch` для модели нельзя использовать `assertThat().isEqualTo`: сравнение будет происходить через equals, который сравнивает объекты только по id. Мы не можем переопределять equals для объектов модели, тк будем использовать JPA (на следующем уроке будет ссылка) (edited)


knkv [Yesterday at 10:29 PM]
in #hw3
org.springframework.dao.DuplicateKeyException обрабатывать надо или пока так оставляем?


2 replies
Aleksey Vra [15 hours ago]
exception вроде как обрабатывать не надо, так же как и NotFoundException..
тест сделал, если при добвлении одинаковой даты получаем DuplicateKeyException то все гуд


knkv [14 hours ago]
Ок, спасибо


knkv [10:34 PM]
Это по пункту 7 Optional

aleksey [10:36 PM]
в тестах или в самом приложении?

knkv [10:43 PM]
И в тестах, и в приложении.

aleksey [10:46 PM]
В тестах сделай, а в приложении пока нет смысла, если не имеешь понятия что с ним делать когда поймал, думаю потом нам скажут что делать. Может будем на уровне сервиса ловить и на фронт выводить данные по ошибке (edited)

dmitry_ov [10:49 PM]
> 5.1 Сделать тестовые данные MealTestData (точно такие же, как вставляем в populateDB.sql).

Здесь надо сделать .sql файл который отработает перед запуском тестов и наполнит БД нужными данными ?
Или  через SimpleJdbcInsert надо создавать тестовые данные ? (edited)

aleksey [10:51 PM]
Создать final static переменные вида Meal meal = new Meal(....); в конструктор которых будут вноситься те же значения что и в базу через sql. Смотри UserTestData класс (edited)

dmitry_ov [10:54 PM]
@aleksey  Не  в БД надо создать ? 
Пишем же тест для JdbcMealRepositoryImpl, который из БД будет вычитывать meals (edited)


Tanya [Yesterday at 10:56 PM]
in #hw3
см как сделано в юзере и сделай по аналогии, должны быть в БД (populateDB.sql) *и* в MealTestData, и эти данные должны быть одинаковые


8 replies
dmitry_ov [14 hours ago]
При тестировании  JdbcMealRepositoryImpl  откуда будут братся данные,  из БД ? (edited)


dmitry_ov [14 hours ago]
JdbcMealRepositoryImplTest  автоварит JdbcMealRepositoryImpl и вызывает у него методы. 
JdbcMealRepositoryImpl при этом ходит в БД ?


aleksey [14 hours ago]
на то он и jdbcMealRepositoryImpl чтобы из бд данные брать


dmitry_ov [14 hours ago]
А для чего дублировать данные в БД и в MealsTestData. Как это помогает при тестировании JdbcMealRepositoryImpl ? (edited)


dmitry_ov [14 hours ago]
Я что то не могу догнать(


Tanya [14 hours ago]
при тестировании полученные из БД и тестовые данные должны будут совпадать
см. как в юзере, начни делать и станет понятно


dmitry_ov [14 hours ago]
Аааа……   т.е. я убеждаюсь что данные в БД и в MealsTestData идентичные, а потом тестом проверяю что JdbcMealRepositoryImpl так же идентичные вернет


dmitry_ov [14 hours ago]
Понял
Спасибо большое :slightly_smiling_face:


Vladimir Gorbatenko [Today at 12:04 AM]
in #hw3
Григорий в видео частенько употребляет слово "зачекинить", что это значит?


2 replies
dyakoven [12 hours ago]
добавить локальные изменения в удаленный репозиторий


Grigory Kislin [10 hours ago]
скорее от слова check-in - закоммитить


mila [Today at 12:31 PM]
in #hw3
почему у нас 2 файла со спринг контекстом? почему нельзя всё в один положить?


2 replies
Dmitry Makarov [37 minutes ago]
Для удобства. Скоро они разрастутся


mila [15 minutes ago]
ок