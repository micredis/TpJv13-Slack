Grigory Kislin [1:59 AM]
joined #hw3.

Grigory Kislin [2:01 AM]
Урок 3: JUnit и работа с RDBMS
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson03.md (edited)

aleksey [2:06 AM]
joined #hw3 along with 2 others.

aleksey [3:12 AM]
@Grigory Kislin почему мы решили не хранить userId в классе Meal ? Он нам нигде и никогда не может понадобиться? В таблице Meal в бд очевидно поле userId должно быть.

Grigory Kislin [1 minute ago]
в уроке есть вопрос


SomeRandomName [3:31 AM]
joined #hw3 along with 6 others.

Ilya [5:37 AM]
Народ, подскажите, плз, постгресс можно смело брать самый последний 10.3 или есть какая-то стабильная-ламповая версия ?

pro [5 hours ago]
ламповая)) красава


pro [5 hours ago]
@Ilya последнюю подтягивай, проблем нету


Ilya [3 hours ago]
@pro да, уже юзаю) кстати, юзеринтерфейс нормасик такой.


Dmitry Makarov [5:40 AM]
joined #hw3 along with 8 others.

Dmitry Neustupov [7:37 AM]
@aleksey А это нормально, что у нас в базе у meals есть userId, а в классе - нет?

Что значит - "нормально"? Приложение работает. Ненормально, когда в приложении есть "лишний" код, который не используется. Для ORM он нам понадобится- мы Meal.user добавим.
@Ilya пользуюсь 10-й версией, полёт нормальный.

alexey [8:40 AM]
commented on hunk.png
со следующими пачами такая же история

Yevhen Maksymovych [10:36 AM]
ребята, подскажите, когда-то мелькала ссылка на план занятий с датами, ни у кого не осталось?

VictorStatko [10:37 AM]
На сайте в описании topjava вроде есть
Где то там

ilya t. [10:38 AM]
https://github.com/JavaWebinar/topjava/tree/doc

Yevhen Maksymovych [4 hours ago]
спасибо!


Tony [3:04 PM]
Господа, обычно приходило письмо с хайлевл описанием занятия. В этот раз не было. Так и должно быть?

realcorwin [3:06 PM]
не должно но было :slightly_smiling_face:
просто открой ссылку на лекцию на гите
только что пришло письмо

Grigory Kislin [3:07 PM]
письмо как раз шлется. там дублирование ссылки на урок

Tony [3:17 PM]
ага, мерси


Artem Murk [4:48 PM]
У кого то есть внятное руководство по установке и настройке postgress?
Необходимо настроить на Убунту 16.04
Не хочет принимать роль user, т.к это входит в область зарезервированных имён (edited)

aleksey [4:52 PM]
У меня Ubunta 16.04 все нормально встало. Опиши подробнее на каком этапе пробема? (edited)

tema.emelyan [4:54 PM]
@Artem Murk это в десятом постгресе? у меня такое тоже по-моему было, из пгадмина не добавлялось, из терминала добавилось (edited)

Artem Murk [4:55 PM]
Сейчас напишу
postgres=# CREATE ROLE user WITH password 'password';
ERROR:  syntax error at or near "user"
LINE 1: CREATE ROLE user WITH password 'password';

qf05 [4:57 PM]
Подскажите, а вот первый пункт домашнего задания, понять, я вроде понял. Потому что изменился путь по которому spring ищет бины. Но я не понял это надо исправлять, что бы работало и с бд и с моск?

Artem Murk [4:57 PM]
пытаюсь сделать через терминал

tema.emelyan [4:58 PM]
точно было что-то такое не помню как решил
может наоборот из пг админа добавилось
в пгадмин соответственно под постгресом заходи

Artem Murk [4:59 PM]
Мм, и как зайти туда? Где качнуть?))

tema.emelyan [4:59 PM]
а какой у тебя постгрес

Artem Murk [5:00 PM]
Походу 9.5

tema.emelyan [5:00 PM]
ну там аскубунту все дела :slightly_smiling_face: (edited)
можно создать юзера user1 например и в проперти файлах поменять юзернейм соответственно (edited)
потом по-моему не так много редакций этого файла, так что не так много проблем с патчами должно быть

Artem Murk [5:02 PM]
Это можно, хотелось бы понять как лучше сделать

tema.emelyan [5:02 PM]
Георгию переделать юзернейм на username? для след выпуска (edited)
хз сам смотри
попробуй пгадмин поставить заодно посмотришь что такое
вообще десятый постгрес и 4ый пгадмин поприятнее конечно, лично мне (edited)

Artem Murk [5:03 PM]
Попробую поставить, время поколупаться ещё есть
Снесу данный постгресс, поставлю другой

tema.emelyan [5:05 PM]
если будешь ставить 4ый пгадмин вот отличный мануал на убунту
https://askubuntu.com/questions/831262/how-to-install-pgadmin-4-in-desktop-mode-on-ubuntu (edited)

Artem Murk [5:08 PM]
Спасибо, я вот подумал может у меня mysql мешает?

tema.emelyan [5:09 PM]
да не, это у постгреса зарезервированое слово, у меня такая же байда была, майсиквела у меня нет (edited)

dmitry_ov [5:09 PM]
Какую версию Postgresql лучше поставить что бы не было проблем ?
9.6 могут быть траблы. 
10 слишком новая ? (edited)

tema.emelyan [5:10 PM]
не слышал проблем ни от кого с десяткой ещё. у самого тоже десятка

Artem Murk [5:10 PM]
Хм, спасибо тезка) за наводки!

tema.emelyan [5:10 PM]
рад помочь

Artem Murk [5:13 PM]
Думаю стоит сообщить @Grigory Kislin за user, переделав в username было бы намного меньше проблем

tema.emelyan [5:14 PM]
пока я только о двоих людях проблемных знаю :smiley:

Artem Murk [5:22 PM]
Ну, возможно остальные на Винде:grinning:
Что самое интересное у меня есть роль user...
Когда вбиваешь в баше команду отобразить всех пользователей \ud

tema.emelyan [5:27 PM]
может всё норм тогда?
поставь туда пароль ему
а какие права у него в \du (edited)

Artem Murk [5:35 PM]
Как я помню есть права суперпользователь, сейчас не за компом, уже завтра буду бороться. Дело в том что у меня такая же ошибка вылетает при попытке назначить ему БД topjava

Grigory Kislin [6:01 PM]
@Artem Murk кавычки нужны. счас в урок вставлю
  ```- psql -c 'create database topjava' -U postgres
  - psql -c 'create user "user"; grant all privileges on database topjava to "user"' -U postgres```

Artem Murk [6:03 PM]
@Grigory Kislin спасибо, завтра попытаюсь сделать)
Делал без кавычек, точно

Aleksey Vra [12:37 AM]
с MySql разобрался за 15 минут, с postgres 2 часа провозился, только чтоб установить..
кое как удалось все же засетить пароль для user.. идеа смогла приконнектиться.. 
но при тесте коннекта идеа виснет намертво на несколько минут, иногда внизу всплывают сообщения что не прошла аунтификация с бд.. нажимаешь коннект снова, снова вис, но уже все проходит..
коннект к бд при запуске скриптов больше минуты.. это нормально? никогда таких глюков с подвисаниме в ubuntu не встречал..

Grigory Kislin [6 hours ago]
у меня сразу коннектится. можно и с MySQL если с постгресом проблемы. но с java в основном он используется
попробуй версии пониже поставить
мы еще hsql на след. уроке введем, те можно вообще без установленной базы.. но тогда и опыта с ним не будет (edited)


Aleksey Vra [5 hours ago]
вот и я так подумал и решил все же добить) 
решил полной переустановкой postgres, теперь коннекты за доли секунды.
жаль что так и не понял в чем проблема была, ошибок то не было, база отображалась, порльзователь тоже.


Andrii [12:44 AM]
Подскажите, правильно ли, что страница с едой, после всех патчей открываться не должна? Ошибка (HTTP Status 500 – Internal Server Error) . 
Где можно посмотреть верный код после всех патчей? 
Заранее спасибо.

Mikhail Makar [19 hours ago]
Да, правильно, приложение после накатки всех патчей становится нерабочим и нам нужно это исправить!



Grigory Kislin [6 hours ago]
в уроке все есть- читай внимательно


This message was deleted.

aleksey [15 hours ago]
Если не ошибаюсь, то SpringMain оказывается в тестах после патчей. По крайней мере у меня он там оказался. В тестах мы не используем dataSource, мы используем моки вместо настоящей базы даных


aleksey [15 hours ago]
Вообще для тестов правильней, на мой взгляд, создать отдельный xml для конфигурации контекста отдельно для тестов. И из тестов обращаться именно к нему.


Ilya [14 hours ago]
@aleksey в целом да, но просто интересно - если даже в спрингмэине скормить xml с бином для БД, то сам процесс сохранения запускается, но спотыкается на             
Number newKey = insertUser.executeAndReturnKey(map);
причем, в самой мапе все, вроде, корректно собралось. 
ну да ладно, надо идти перечитывать в очередной раз


Tanya [4:50 AM]
совет
перед тем как приступать к HW3
*внимательно* прочитайте все пункты задания, "Ответы на Ваши вопросы" и "Ваши вопросы"

Ilya [8:42 AM]
еще вопрос, финальные поля выпиливаем из Meals ? как иначе юзать сеттеры и дефолтный конструктор.

alexey [9:26 AM]
у меня у одного какая то лажа с сайтом https://www.enterprisedb.com. Верхняя часть сайта все время скрыта (edited)
enterprisedb.com
EnterpriseDB
The Postgres Database Company

Ilya [9:34 AM]
@alexey не, судя по всему какой-то косяк, вчера все ок было

Artem Murk [10:07 AM]
Ура, БД заработало!

qf05 [12:07 PM]
Подскажите, когда мы делаем, например, get запрос, то из базы мы достаём meal, а потом проверяем его на принадлежность пользователю, или мы не достаём из базы ничего, если еда не принадлежит пользователю(т.е. проверка в базе)
пробовал вот так: SELECT * FROM meals WHERE id=? && userId=?",ROW_MAPPER, id,userId)
но получаю ошибку синтаксиса.

Dmitry Makarov [8 hours ago]
https://postgrespro.ru/docs/postgresql/9.4/functions-logical.html
postgrespro.ru
PostgreSQL : Документация: 9.4: Логические операторы (9 kB)
 


qf05 [8 hours ago]
спасибо!!!


Aleksey Vra [4:15 PM]
```@Autowired
    public MealServiceImpl(MealRepository repository) {
        this.repository = repository;
    }```
как сюда инжектнуть бин InMemoryMealRepositoryImpl, тот что в папке тест лежит?
как вручную создать этот bean? через конфигт не получается путь указать

roma [4:16 PM]
при накатке патча 3_07

roma [4:16 PM]
uploaded this image: image.png 


roma [4:17 PM]
после нажатия скип

roma [4:17 PM]
uploaded this image: image.png 


roma [4:18 PM]
вроде как накатывается но все файлы попадают в чендж лист дефаулт

Aleksey Vra [4:21 PM]
```@Autowired
    public MealServiceImpl(@Qualifier("jdbcMealRepository") MealRepository repository) {
        this.repository = repository;
    }```
jdbcMealRepository инжектится, так как бин указваю в конфиге,
а вот как создать bean класса, который в папке тест?

Mikhail Makar [3 hours ago]
Я разрешил эту ситуацию созданием отдельного тестового контекста спринга и там уже прописал бины, классы SpringMain, InMemoryAdminRestControllerTest, InMemoryAdminRestControllerSpringTest стали работать!



Mikhail Makar [3 hours ago]
Ещё нужно будет в тестовых класса поменять ссылку на тестовый контекст спринга!


Aleksey Vra [3 hours ago]
а как указать путь к бину InMemoryAdminRestControllerTest?


Grigory Kislin [3 hours ago]
укажи пакет для сканирования, где находится этот класс


Aleksey Vra [2 hours ago]
в том то и дело что пакет для сканирования невозможно указать.. если создать конфиг в папке ресурсы в тест, то путь прописывается.. думал можно из 1 го места все это дело прописать


roma [4:40 PM]
Блин а про накатку патча - №7 - только у меня одного такая фигня?

Arthur [4:40 PM]
перед накаткой этого патча нужно ручками тестовый каталог создать
в задании написано
Ребята, всем привет! Кто-нибудь смотрел 5-й пункт?
Я перестал понимать следующий момент: MealServiceTest - работает с БД или использует реализацию из памяти....?

roma [4:43 PM]
)))
блин
придется откатиться )
@Arthur спасибо
@Arthur глянь плиз свой VersionControl log на этом комите - похож он на такой (6 файлов) (в тесты перенесено SpringMain и две Мемори реализации репозитория) - все так? (edited)

roma [4:49 PM]
uploaded this image: image.png 


Arthur [4:51 PM]
вроде похож
проект у тебя в этой точке собирается?

roma [4:52 PM]
Потому что даже после создания test каталога skip при накатке патча все равно пришлось нажимать
ща попробую собрать

Arthur [4:53 PM]
если собирается, то все ок

roma [4:53 PM]
погоди а как он может собираться в этой точке - если мы репозиторий убрали в тесты а сприг у нас не поднимает бины из тестов? (edited)

poleg [4:54 PM]
Вопрос по 4. Тестирование через JUnit. В лекции говорится что тесты (если не выключено в настройках мавена) запускаются при сборке проекта. А почему тогда когда запускаю приложение через деплой в Tomcat в консоль ничего не выводится? Ведь к деплою приходим через сборку. (edited)


Grigory Kislin [3 hours ago]
при деплое idea сама компилирует классы. без maven (edited)


poleg [2 hours ago]
Хм. Не совсем понятно. Можно чуть подробнее?


Grigory Kislin [2 hours ago]
при деплое idea не запускает фазы сборки maven
в чем недопонимание?


poleg [2 hours ago]
Наверное, я чего-то упустил ) То есть вот запускаем проект, и пошли по фазам мавена. А если не пошли то откуда идея возьмет вот все эти классы, которые мавен подтягивает?


poleg [2 hours ago]
Как соберет все вот это без мавена


Grigory Kislin [2 hours ago]
maven запускает javaс
какие проблемы без него собрать?
где находятся классы idea знает
можешь попробовать меню: Build->Build Artefacts


poleg [2 hours ago]
Ага, дошло.


roma [5:05 PM]
@poleg я так понял, то что говориться в лекции - при сборке проекта стадия тестов проходит но в jar эта вся фигня не попадает - соответственно в томкате этого добра уже быть не может. А кнопочка (функционал maven) - это, когда ты собираешь - может проходиться стадия test (сборки) а может не проходиться - но в любом случае (при нажатой или нет) в jar это добро не попадает (edited)

poleg [5:15 PM]
Я к тому, что строчки +++ PostConstruct и т.д. должны все равно ведь мелькнуть в логах.

roma [5:27 PM]
Мне кажется, что идея, зная что томкату тесты не нужны собирает проект без тестов - поэтому логи эти не мелькают

poleg [5:28 PM]
Собственно, Григорий ответил выше.

Anton Kiselev [5:54 PM]
скажите, инфа по откатке патча в каком уроке была?
ну или как его сделать)

Arthur [6:02 PM]
можно через идею - в гите выбираешь нужный камит, потом "Reset current branch to here"

Anton Kiselev [6:03 PM]
@Arthur Благодарю

Ma3stro [6:32 PM]
uploaded and commented on this image: image.png 

Почему мне ругается на депенси теста спринга?

Ma3stro [6:33 PM]
После соответствующего патча

mvn clean не помог

qf05 [7:22 PM]
Подскажите, у меня при выполнении дебага в тест классах вылетает такая ошибка:
java.io.FileNotFoundException: C:\Users\Ïîëüçîâàòåëü\AppData\Local\Temp\capture35513.props (Системе не удается найти указанный путь)
Но после этого всё запускается и работает. В каталоге Temp такого файла нет. Вопрос в том, где взять этот фаил, или как убрать в idee сообщение об этом exeption?
