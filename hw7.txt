Grigory Kislin [2:15 AM]
joined #hw7.

Grigory Kislin [2:29 AM]
7е занятие: REST контроллеры и их тестирование
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson07.md (edited)

tema.emelyan [2:36 AM]
joined #hw7 along with 18 others.

qf05 [3:08 PM]
Кто-нибудь уже разобрался почему при запуске testUser в  RootControllerTest не вызывается метод postConstruct() и mockMvc получается null? или это только у меня так?

Grigory Kislin [6 hours ago]
у меня вызывается. с гитхаб проект сравнивал?
попробуй новый в сторонке вычекать


alexey [4:43 PM]
Народ, кто натали первые 6 патчей, скиньте  код *app_ru.properties* пжлст.

Oleksii Leshchenko [4:44 PM]
added this JavaScript/JSON snippet: Untitled 
app.title=Подсчет калорий
app.home=Главная
app.footer=Приложение по проекту <a href="https://github.com/JavaOPs/topjava" target=_blank>Maven/ Spring/ Security/ JPA(Hibernate)/ Jackson/jQuery</a>
app.login=Зайти как
​
user.title=Пользователи
user.name=Имя
user.email=Почта
user.roles=Роли
user.active=Активный
user.registered=Зарегистрирован
​
meal.title=Моя еда
meal.edit=Редактирование еды
meal.add=Добавление еды
meal.filter=Отфильтровать
meal.startDate=От даты
meal.endDate=До даты
meal.startTime=От времени
meal.endTime=До времени
meal.description=Описание
meal.dateTime=Дата/Время
meal.calories=Калории
​
common.select=Выбрать
common.delete=Удалить
common.update=Обновить
common.save=Сохранить
common.cancel=Отмена
common.actions=Выполнить
Collapse 

Oleksii Leshchenko [5:38 PM]
added and commented on this Java snippet: Untitled 
public static void assertMatch(Iterable<Meal> actual, Iterable<Meal> expected) {
    assertThat(actual).usingElementComparatorIgnoringFields("user").isEqualTo(expected);
  }
Интересует вопрос, должны ли обе коллекции отсортированы одинаково в этом методе? Что, если сравниваемые коллекции одинаковые, но элементы в разном порядке хранятся...?


Oleksii Leshchenko [Today at 6:11 PM]
in #hw7
Я так понимаю, что вместо SoapUI можно использовать и Postman?
https://www.getpostman.com/ (edited)


1 reply
Dmitry Neustupov [1 hour ago]
Можно, кому как удобней. По мне и Соап норм.


alexey [7:57 PM]
commented on Oleksii Leshchenko’s snippet Untitled
спасибо

dustnfox [10:18 PM]
commented on Oleksii Leshchenko’s snippet Untitled
Сейчас подебажил это хозяйство и таки да - должны. Просто берутся два итератора (от actual и expected) и поочередно сравниваются очередные результаты вызова `next()` на каждой коллекции.
dustnfox [10:19 PM]
  ```private boolean compareElementsOf(Iterable<T> actual, Iterable<T> other) {
    if (sizeOf(actual) != sizeOf(other)) return false;
    // compare their elements with elementComparator
    Iterator<T> iterator = other.iterator();
    for (T actualElement : actual) {
      T otherElement = iterator.next();
      if (elementComparator.compare(actualElement, otherElement) != 0) return false;
    }
    return true;
  }```
dustnfox [10:29 PM]
В общем, довольно ожидаемый результат. Думаю, если бы была какая-то экзотика, (например, сравнить поэлементно и если не равны, то отсортировать и сравнить снова) то это в явном виде описали бы в документации.


CRCx86 [10:59 PM]
Добрый вечер!
подскажите, что-то непонятное для меня творится c IDEA
добавляю проект, добавляю maven
переоткрываю заново IDEA, всё пусто

CRCx86 [11:01 PM]
uploaded this image: image.png 


CRCx86 [11:01 PM]
что может быть такое?

Viktor [11:02 PM]
закрой проект и покажи окно идеи, там где идет выбор проекта

CRCx86 [11:04 PM]
uploaded this image: image.png 


realcorwin [Yesterday at 11:18 PM]
in #hw7
Смотрю сейчас видео к патчам. REST - это у нас настройка над MVC, так?


2 replies
Oleksii Leshchenko [13 hours ago]
Нет. Просто ранее наши методы в контроллере перенаправляли на JSP и в результате клиенту выплевывали HTML. Rest - мы формируем json данные и отдаем клиенту. А уже клиент при помощи JavaScript будет с ними чтото делать...


realcorwin [1 hour ago]
O, так понятно :slightly_smiling_face:.


Oleksii Leshchenko [11:54 PM]
commented on Untitled
@dustnfox ясно, спасибо) 
Это на самом деле недостаток. Непонятно, чего в наших тестах рассчитывают на то, что порядок будет одинаковый. В Хармкрест есть метчеры, которые могут сравнивать неотсортированнын коллекции...


Arthur [Today at 1:13 AM]
in #hw7
Ребят, а у вас все патчи в этом уроке гладко легли?
У меня 2 и 9 патч дал коллизии. (edited)


3 replies
Oleksii Leshchenko [4 hours ago]
Без коллизий... Но были в прошлом уроке. Я накатывал изменения из гитхаба отсюда #project_change


Oleksii Leshchenko [4 hours ago]
Т. е.  Смерджил их мастер с моим по тем комитам... И были чегото конфликты при этом...


Arthur [3 hours ago]
ок, спасибо


aleksey [1:51 AM]
Привет всем
   1.2 ResourceControllerTest для style.css (проверить status и ContentType)
Это о чем вообще? В каком видео об этой штуке что-то упоминается?

Dzmitry Shalukhau [7:39 AM]
@CRCx86 У меня такое было когда ненароком imp файл прибил. Помогло удаление папки .idea в проекте и открытие заново

dustnfox [7:49 AM]
commented on CRCx86’s file image.png
Судя по пути, лежит на OneDrive. Это только версия, но вчера РКН положил по 15й маске часть адресов Microsoft. Большая часть относилась к Azure, т.е. к "облакам" MS. Возможно как-то и OneDrive зацепило, ибо черт его знает, кто и для чего эти облака использует.  У меня вот, например, вчера PSN вырубился после всех этих экспериментов роскомнадзоровских волшебников. 
Вообще, конечно папка OneDrive должна быть локально выкачана и прилетать только обновами, но если синхронизация первая или MS чего-то хитрого намудрил, то может и так глючить.

qf05 [10:11 AM]
Ну вот и у меня теперь слака через тор только пашет(((( 
В этом в роскомнадзоре совсем поехавшие деб..лы сидят? Какая же это всё х..ня, какой смысл? Каккие нафиг переписки террористов... Будто шахиды совсем тупые и не умеют гуглить как обходить блокировки?..  Да любой из нас уже может за пару дней, ну максимум за недельку накатать свой простенький мессенджер со своим шифрованием, я не говорю уже о сотнях вариантах готового кода по всему интернету... Да кому надо, тот может спокойно у себя в сарае атомную бомбу собрать... Да, у меня тут полигон артелирийский в 2-х км, можно вообще спокойно туда придти и из неразорвавшихся снарядов гегс..гена хоть тонну наковырять, у нас месные им костры в сырую погоду разводят))))

LeoJames [10:18 AM]
/*Чисто для протокола товарищу майору*/
"Да любой из нас..." звучит как то странно в таком контексте:grin:

qf05 [10:22 AM]
Любой из нас - в смысле что, все кто зесь проходит практику, уже имеют достаточную базу знаний, что бы реализовать обмен сообщений между двумя юзерами.

LeoJames [10:24 AM]
:thinking_face:Товарищ майор сказал, что поздно заднюю давать

qf05 [10:33 AM]
ушел в лес... пускай ищут...))))

qf05 [10:53 AM]
Для тех, у кого так же как у меня, не вызывается PostConstruct, надо добавить зависимость:
<dependency>
   <groupId>javax.annotation</groupId>
   <artifactId>javax.annotation-api</artifactId>
   <version>1.3.1</version>
</dependency>
Актуально для java 9.


Viktor [9:00 PM]
@qf05 думаю у тебя проблема со слаком локальная, я тоже из РФ, все спокойно запускается без проблем. Либо моему оператоору пофиг на блокировки :smiley: (edited)

druxa [9:12 PM]
@GetMapping("/owners/{ownerId}/pets/{petId}")
public Pet findPet(@PathVariable Long ownerId, @PathVariable Long petId) {
   // ...
} Если в @PathVariable не указано имя ("ownerId" и "petId") , то спринг подставляет имена по именам переменных?

Vyacheslav [6:29 PM]
Народ. SoapUI нормально качается? У меня что-то не прет.  https://www.soapui.org/downloads/thank-you-for-downloading-soapui.html
soapui.org
Download REST & SOAP Automated API Testing Tool | Open Source | SoapUI
Compare SoapUI Pro vs Open Source. Try out the most widely used API testing tool in the world today!

Ma3stro [8:12 PM]
После накатки всех патчей вылетает `ConflictingBeanDefinitionException: Annotation-specified bean name 'jspMealController'` и открываться ничего не хочет, как это исправить? (edited)


qf05 [Yesterday at 8:32 PM]
in #hw7
@Vyacheslav А что soap так и надо качать триал на 14 дней? Крякнутой нет?


3 replies
Vyacheslav [7 hours ago]
Да вроде нет. https://www.soapui.org/downloads/soapui.html
soapui.org
Download REST & SOAP Automated API Testing Tool | Open Source | SoapUI
Compare SoapUI Pro vs Open Source. Try out the most widely used API testing tool in the world today!


Vyacheslav [7 hours ago]
Заработала загрузка. Наверное опять Роскомнадзор гадит.


Grigory Kislin [5 hours ago]
я бесплатный ставил


realcorwin [8:38 PM]
В Идею вшит Test RESTful Web Service (в меню Tools)


realcorwin [Yesterday at 8:51 PM]
in #hw7
testDelete падает - статус 204, а не 200



9 replies
aleksey [6 hours ago]
у нас над delete аннотация
   @ResponseStatus(value = HttpStatus.NO_CONTENT)
https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204
так что он не падает, а успешно выполняется.
MDN Web Docs
204 No Content
The HTTP 204 No Content success status response code indicates that the request has succeeded, but that the client doesn't need to go away from its current page. A 204 response is cacheable by default. An ETag header is included in such a response.
 


realcorwin [6 hours ago]
это у вас аннотация, а у нас в патчах никакой аннотации нет :slightly_smiling_face:


aleksey [6 hours ago]
тоесть у меня какие-то другие патчи?

qf05 [6 hours ago]
я закоммитил эту аннотацию)


qf05 [6 hours ago]
теперь сижу и думаю, может раскомитить и в тестах изменение сделать?

realcorwin [6 hours ago]
пацаны, вы что издеваетесь? :slightly_smiling_face: что вы делаете с патчами Григория :slightly_smiling_face:


aleksey [6 hours ago]
черт, да, я же сам ее поставил, забыл уже :smiley:


realcorwin [6 hours ago]
короче, тесты изменяются, пока не дают правильный результат :slightly_smiling_face: предлагаю выпилить их нахрен :slightly_smiling_face: толку-то :slightly_smiling_face:


realcorwin [5 hours ago]
@aleksey не работает твоя аннотация. status().is2xxSuccessful() работает


Grigory Kislin [10:54 PM]
*В после патчей этого урока валятся AdminRestControllerTest.testDelete и ProfileRestControllerTest.testDelete (в контроллере поменялся код ответа)*
Моя бага, добавлю в ДЗ: починить. (edited)

realcorwin [10:55 PM]
Ага. Ну, я собственно уже спалил строчку починки

Grigory Kislin [10:56 PM]
:slightly_smiling_face:

realcorwin [11:35 PM]
Ребята, кто уже делал MealRestControllerTest, там можно метод contentJson реализовывать аналогично как для User только для Meal, или там есть какие-то свои хитрости? Я почти всё сделал, но тут уже начал уставать...

Ma3stro [11:38 PM]
И все же не могу понять в чём дело. Возникает сие при запуске приложения
В расшифровке ошибки сказано, что бин "jspMealController" из пакета ru.javawebinar.topjava.web.meal.JspMealController конфликтует с одноименным(!) бином из пакета ru.javawebinar.topjava.web.JspMealController, хотя в пакете .web нет такого класса вовсе, только в web.meal!!! Гугления мне не помогли:/
```ConflictingBeanDefinitionException: Annotation-specified bean name 'jspMealController' for bean class [ru.javawebinar.topjava.web.meal.JspMealController] conflicts with existing, non-compatible bean definition of same name and class [ru.javawebinar.topjava.web.JspMealController]```
(edited)

Ma3stro [11:44 PM]
Пришлось чинить это тем, что прописал отдельно сканы на web.meal и web.user

realcorwin [11:52 PM]
@Ma3stro это у тебя после твоих изменений такая бяка появилась?.. потому что в патчах такого нет
я бы покопался в *.xml файлах. где-то что-то не туда указывает, дублирует итп.

Grigory Kislin [12:33 AM]
@Ma3stro mvn clean попробуй
у тебя мог class остаться

realcorwin [1:51 AM]
ребята, кто-нибудь получал такую радость на тестах?

Cannot deserialize instance of `java.util.LinkedHashMap` out of START_ARRAY token

Вылетает у меня на testGet и testGetAll
для информации:

@test
   public void testGet() throws Exception {
       mockMvc.perform(get(REST_URL + MEAL1_ID))
               .andExpect(status().isOk())
               .andDo(print())
               .andExpect(content().contentTypeCompatibleWith(MediaType.APPLICATION_JSON))
               .andExpect(contentJson(MEAL1));
   }
-----------------
@Override
   @GetMapping("/{id}")
   public Meal get(@PathVariable("id") int id) {
       return super.get(id);
   }
-----------------
MockHttpServletResponse:
          Status = 200
   Error message = null
         Headers = {Content-Type=[application/json;charset=UTF-8]}
    Content type = application/json;charset=UTF-8
            Body = {"id":100002,"dateTime":"2015-05-30T10:00:00","description":"Завтрак","calories":500,"user":null} (edited)
---------------
Исключение вылетает на .andExpect(contentJson(MEAL1))
---------------
public static ResultMatcher contentJson(Meal... expected) {
      return content().json(writeIgnoreProps(expected, "user"));
  }


qf05 [11:06 AM]
помогите разобраться, сейчас мучаю Test RESTful Web Service, с get запросами всё работает, а вот с post и put не могу разобраться как в боди передать объект meal.
В HTTP method выбираю post, в Host/port: http://localhost:8080, в Path: /rest/meals, в requestBody: text: {"dateTime":2017-10-20T11:00,"description":qwerty,"calories":300}
пробовал в Path: /rest/meals?{"dateTime":2017-10-20T11:00,"description":qwerty,"calories":300}
На всё один ответ: The origin server is refusing to service the request because the payload is in a format not supported by this method on the target resource.

aleksey [5:39 PM]
Кто-нибудь уже делал optional? кастомные форматтеры? У меня проблема, может кто сможет помочь?
Я успешно создаю свои форматтеры, они даже работают в виде аннотаций, но при подключении
<mvc:annotation-driven conversion-service="conversionService" /> в spring-mvc.xml
у меня начинают валиться половина тестов с чем-то подобным:
*** java.lang.instrument ASSERTION FAILED ***: "!errorOutstanding" with message transform method call failed at JPLISAgent.c line: 844
*** java.lang.instrument ASSERTION FAILED ***: "!errorOutstanding" with message transform method call failed at JPLISAgent.c line: 844
*** java.lang.instrument ASSERTION FAILED ***: "!errorOutstanding" with message transform method call failed at JPLISAgent.c line: 844
17:34:46.738 WARN  o.s.w.s.m.support.DefaultHandlerExceptionResolver.handleHttpMessageNotWritable:442 - Failed to write HTTP message: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: Infinite recursion (StackOverflowError); nested exception is com.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (StackOverflowError) (through reference chain: ru.javawebinar.topjava.model
кто-нибудь понимает в чем причина? (edited)


alexey [6:43 PM]
added and commented on this Plain Text snippet: MealRestControllerTest.update 
org.springframework.http.InvalidMediaTypeException: Invalid mime type "{"id":100002,"dateTime":"2015-05-30T10:00:00","description":"Завтрак","calories":666}": does not contain '/'
  at org.springframework.http.MediaType.parseMediaType(MediaType.java:512)
  at org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder.contentType(MockHttpServletRequestBuilder.java:282)
  at ru.javawebinar.topjava.web.meal.MealRestControllerTest.TestUpdate(MealRestControllerTest.java:77)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:498)
  at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
  at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
  at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
  at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
  at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:73)
  at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:83)
  at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
  at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
  at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
  at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
  at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
  at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
  at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
  at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
  at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
  at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
  at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
  at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
  at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
  at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
  at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
  at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
  at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
  at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
  at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: org.springframework.util.InvalidMimeTypeException: Invalid mime type "{"id":100002,"dateTime":"2015-05-30T10:00:00","description":"Завтрак","calories":666}": does not contain '/'
  at org.springframework.util.MimeTypeUtils.parseMimeType(MimeTypeUtils.java:193)
  at org.springframework.http.MediaType.parseMediaType(MediaType.java:509)
  ... 33 more
Collapse 
Народ подскажите в куда смотреть, update валиться с ошибкой. Пол дня сижу туплю


roma [Today at 6:52 PM]
in #hw7
я так понял ни у одного меня soapUi open source не качается? (edited)


1 reply
alexey [5 hours ago]
такая же фигня(


roma [7:18 PM]
Может это как то связано с попыткой блокировки телеграма

roma [7:19 PM]
uploaded this image: image.png 


qf05 [7:21 PM]
у меня тоже не грузило, пока через тор не открыл))))

roma [7:24 PM]
с 15 этажа - красиво летит бумажный самолетик )

qf05 [7:54 PM]
блин, целый день убил, так и не понял как сформировать запрос на создание еды и юзера. например вот для юзера в боди пишу: {"name":"User2","email":"use2r@yandex.ru","password":"password","roles":["ROLE_USER"]}
что не так?


Grigory Kislin [21 hours ago]
попробуй описать свою проблему полностью. 
дополнил п. 1
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson01.md#-%D0%94%D0%BE%D0%BC%D0%B0%D1%88%D0%BD%D0%B5%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-hw01-%D0%B4%D0%B5%D0%BB%D0%B0%D0%B5%D0%BC-%D0%B2%D0%B5%D1%82%D0%BA%D1%83-hw01-%D0%BE%D1%82-%D0%BF%D0%BE%D1%81%D0%BB%D0%B5%D0%B4%D0%BD%D0%B5%D0%B3%D0%BE-%D0%BF%D0%B0%D1%82%D1%87%D0%B0-%D0%B2-master


Dzmitry Shalukhau [10:58 AM]
Только curl - только хардкор :slightly_smiling_face:


roma [Yesterday at 3:09 PM]
in #hw7
public class MediaType extends MimeType implements Serializable - тут нет константы для проверки css? Захаркодить будет норм?
```.andExpect(content().contentType("text/css"));```
(edited)


1 reply
Oleksii Leshchenko [23 hours ago]
я захардкодил


Ma3stro [Yesterday at 4:12 PM]
in #hw7
Кто как передавал данные для фильтрации? Через @PathVariable или Post'om?


6 replies
Oleksii Leshchenko [22 hours ago]
ты имеешь ввиду для getBetween()?


Ma3stro [22 hours ago]
Да


Oleksii Leshchenko [22 hours ago]
типа такого, если для optional части задания:
`@RequestParam(value = "startDate", required = false) String startDate`


Ma3stro [22 hours ago]
Я пока основную часть делаю:)


Oleksii Leshchenko [22 hours ago]
там тоже будет @RequestParam


Grigory Kislin [21 hours ago]
технически можно и так и так. я с формы обычно чз post отдаю (edited)


Grigory Kislin [4:58 PM]
commented on alexey’s snippet MealRestControllerTest.update
полагаю что с форматом чтото- либо @RequestBody либо MediaType.APPLICATION_JSON_VALUE отсутствуют


Ma3stro [Yesterday at 8:02 PM]
in #hw7
А как передать для getBetween LocalDate'ы и  LocalTime'ы соответствующие в запрос? В каком формате вообще их указывать? (edited)


14 replies
dustnfox [18 hours ago]
@Ma3stro Так все же написано :slightly_smiling_face:
>2.2 в параметрах getBetween принимать LocalDateTime (конвертировать через @DATETIMEFORMAT WITH JAVA 8 DATE-TIME API), а передавать в тестах в формате ISO_LOCAL_DATE_TIME (например '2011-12-03T10:15:30'). Вызывать super.getBetween() пока без проверки на null, используя toLocalDate()/toLocalTime() (см. Optional п.3)


dustnfox [18 hours ago]
То есть у тебя клиент будет плевать DateTime в виде указанной строки. А пресловутый @DATETIMEFORMAT будет тебе из него делать LocalDateTime


Gromov Vitaly [15 hours ago]
Вот не могу понять, куда аннотацию @DATETIMEFORMAT  прикрутить?


dustnfox [15 hours ago]
Так натрави ее на параметр, пусть она его и пережевывает :slightly_smiling_face:


dustnfox [15 hours ago]
https://www.petrikainulainen.net/programming/spring-framework/spring-from-the-trenches-parsing-date-and-time-information-from-a-request-parameter/
Petri Kainulainen
Spring From the Trenches: Parsing Date and Time Information From a Request Parameter
A few days ago I had to write a controller method that is used to upload files to a Spring web application. This is an easy task, but I had another requirement that turned out to be a problem: every file has an expiration date that must be given when the file is uploaded. What went wrong? The Probl…
Sep 28th, 2015 at 12:24 PM
 


dustnfox [15 hours ago]
Example 1 смотри


Gromov Vitaly [15 hours ago]
Ok! Спасибо!  По началу так и сделал, но не взлетает, видимо дело еще в чем то ))


dustnfox [15 hours ago]
Ну так если совсем никак, то напиши, в чем проблема. А то ведь "не взлетает" - так себе описание :wink:



Gromov Vitaly [15 hours ago]
OK. Пытаюсь для эксперемента получить дату из параметра:   
@PostMapping(value = "/filter")
   public String getFiltered(@RequestParam(value = "startDate", required = false) @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime startDateInpt) {
       return "date is "+startDateInpt;
   } (edited)


Gromov Vitaly [15 hours ago]
отправляю запрос POST с параметром startDate "2011-12-03T10:15:30", в ответ получаю "date is null"


dustnfox [15 hours ago]
Хм... Вроде все похоже. Может отправляешь что-то не так?


dustnfox [14 hours ago]
У меня была такая фигня, оказалось не то имя параметра в запрос писал


Gromov Vitaly [14 hours ago]
Я понял в чем проблема, я передавал в параметр в теле запроса, а нужно в URL


Gromov Vitaly [14 hours ago]
http://localhost:8080/topjava/rest/meals/filter?startdate=2011-12-03T10:15:30


Nedfrench [9:54 PM]
Добрый вечер, коллеги. 
Никто не поделится ссылками на статьи про mockMVC?

CRCx86 [7:52 AM]
uploaded this image: добрый день! почему вываливается эта ошибка? 


CRCx86 [7:53 AM]
настройки проекта

CRCx86 [7:53 AM]
uploaded this image: image.png 


CRCx86 [7:59 AM]
uploaded this image: с чем связана эта надпись? 


CRCx86 [Today at 8:02 AM]
in #hw7
При каждом перезапуске полностью слетают настройки IDEA. отвязывается DataBase, Maven, Facets в Project Structure. Уделение .idea не решает проблему. Что может быть не так?


2 replies
dustnfox [6 hours ago]
Ты не пробовал проект с OneDrive перенести в обычную папку?


dustnfox [6 hours ago]
РКН с прошлой недели блокирует часть IP адресов используемых Microsoft для организации облачных хранилищ.  Может проблема связана с этим.


Vladimir Gorbatenko [Today at 11:22 AM]
in #hw7
package ru.javawebinar.topjava;

import org.springframework.test.context.ActiveProfilesResolver;

public class AllActiveProfileResolver implements ActiveProfilesResolver {

   @Override
   public String[] resolve(Class<?> aClass) {
       return new String[]{Profiles.REPOSITORY_IMPLEMENTATION, Profiles.getActiveDbProfile()};
   }
}
Зачем в методе параметр Class<?> aClass? (edited)


1 reply
Grigory Kislin [2 hours ago]
зайди в исходники ActiveProfilesResolver  и почитай в javadoc @param testClass (idea предлагает загрузить исходники в правом верхнем углу) (edited)


Vladimir Gorbatenko [Today at 12:05 PM]
in #hw7
Уже несколько (3-4) уроков, после накатки патчей, идея как-то глючит при коммите, как будто не реагирует когда нажимаешь Commit and Push. Проверено на работе и дома. У всех так?


3 replies
Grigory Kislin [2 hours ago]
В version control поле git команды появляется вкладка console. Там можно посмотреть
либо отдать команду из терминала
у меня все ок (edited)


Dzmitry Shalukhau [32 minutes ago]
У меня также. Я не использую Default как namespace для changeset. Idea то ли по каким то причинам не может сделать changeset активным перед коммитом, то ли не может анализ неактивного changeset запустить. Лечится установкой changeset активным.


Oleksii Leshchenko [18 minutes ago]
Commit может сразу не реагировать, если включена оптимизация импортов и/или структуризация кода и/или анализ кода на ошибки... В первый раз оно все фиксет все и анализирует. И дает посмотреть результат. И со второго раза заливает...


roma [2:17 PM]
Народ я не совсем понимаю - как наше приложение понимает, что работает по REST через класс AdminRestContoller и ProfileRestContoller (а не через RootConroller) - соответственно не понимаю, что нужно сделать что бы оно работало с MealRestController а не с JspMealController (edited)


Ma3stro [1 day ago]
Не понял вопроса, но у нас есть аннотация @RestController, возможно ты про это


Oleksii Leshchenko [1 day ago]
Там разный URL. У Rest свой путь...



roma [1 day ago]
@Oleksii Leshchenko @Ma3stro То-есть я могу работать и по ресту и не по ресту???? и с мил тоже так? (edited)


roma [1 day ago]
cейчас в томкате из за jsp у нас все летит в JSPMealController - а c REST можно работать только через адресную строку и SOAPUI ? (edited)


Oleksii Leshchenko [1 day ago]
Можно работать одновременно. И думаю одновременно и через SoapUi и браузер!


roma [1 day ago]
но приложение наше если не пользоваться адресной строкой работает пока не через рест - правильно?


Oleksii Leshchenko [1 day ago]
Просто один контроллер вернет HTML (через JSP),  а второй json


Oleksii Leshchenko [1 day ago]
Да, приложение не использует Rest. Для этого надо делать frontend на JavaScript


Oleksii Leshchenko [1 day ago]
И возможно даже с полноценными Angular, React или Vue


roma [1 day ago]
Спасибо большое - немного прояснилось - пилю контроллер дальше....


Arthur [1 day ago]
Помойму Григорий в видео произнес такую фразу, что со временем мы от "нерэст" контроллера избавимся. Я это понимаю так - рэст подход, это современный подход реализации веб приложения, и мы дальше пойдем по этому пути. Через JSP и вообще через сервлеты - это подход предыдущего поколения, и мы его изучили для общего нашего развития.


Oleksii Leshchenko [1 day ago]
Да, это так. Единственное, такой подход может потребовать привлечения дополнительно фронт-энд девелопера в команду...


realcorwin [1 day ago]
@roma я тоже не сразу въехал, что rest контроллеры у нас не заменяют обычные, а работают параллельно. со стартовый страницы у нас грузятся jsp по ссылкам, обрабатываемым обычным контроллером. а если мы воспользуемся ссылкой, н-р, rest/admin/users, то за эту ссылку отвечает уже rest контроллер, и он пришлёт нам json



roma [1 day ago]
Всем большое спасибо )


Ma3stro [Apr 24th at 2:52 PM]
in #hw7
Почему мне выбрасывает 400 bad request?
    ```@PostMapping(value = "/filter")
    public List<MealWithExceed> getBetween(@RequestParam("startDate") @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime startDate, @RequestParam("startTime") @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)LocalDateTime startTime, @RequestParam("endDate") @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)LocalDateTime endDate, @RequestParam("endTime") @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME)LocalDateTime endTime) {
        return super.getBetween(startDate.toLocalDate(), startTime.toLocalTime(), endDate.toLocalDate(), endTime.toLocalTime());
    }```
С запроса `http://localhost:8080/topjava/rest/meals/filter?startDate=2011-12-03T10:15:30&startTime=2016-12-03T10:15:30&endDate=2011-12-03T10:15:30&endTime=2017-12-03T10:15:30`? (edited)


18 replies
Oleksii Leshchenko [1 day ago]
startTime и startDate имеют одинаковый и неправильный формат


Yevhen Maksymovych [1 day ago]
и тип респонса не указан...


Oleksii Leshchenko [1 day ago]
Там должно быть только время и только дата соотв


Ma3stro [1 day ago]
@Oleksii Leshchenko, у меня же дата и время соответственно конвертируются toLocalDate() и toLocalTime()


Oleksii Leshchenko [1 day ago]
Тогда не знаю)

Yevhen Maksymovych [1 day ago]
так погодь


Yevhen Maksymovych [1 day ago]
ты через браузер пытаешься вытянуть это дело?


Yevhen Maksymovych [1 day ago]
или через соапюи?

Yevhen Maksymovych [1 day ago]
если через браузер, вешай на гет, а не на пост


Yevhen Maksymovych [1 day ago]
вообще логика этого метода предполагает гет, он же не изменяет данные


Gromov Vitaly [1 day ago]
Добавляй параметры в метод последовательно, контролируя что они у тебя правильно приплетают по url


Ma3stro [1 day ago]
Сделал не post, а get, также поменял уже на LocalDate и LocalTime


Ma3stro [1 day ago]
Заработало


Yevhen Maksymovych [1 day ago]
:+1:

Gromov Vitaly [1 day ago]
А у меня через post работает, хотя get правильнее


Vladimir.M [1 day ago]
Вообще то не совсем верно. У тебя в запросе четыре параметра LocalDateTime, а должно быть два LocalDate и два LocalTime. @DateTimeFormat прекрасно конвертирует в оба формата (DateTimeFormat.ISO.DATE, DateTimeFormat.ISO.TIME)


Yevhen Maksymovych [1 day ago]
вообще, если он не делает опционал, там как раз надо использовать сплошные локалдэйттаймы


Yevhen Maksymovych [1 day ago]
```2.2 в параметрах getBetween принимать LocalDateTime (конвертировать через @DATETIMEFORMAT WITH JAVA 8 DATE-TIME API), а передавать в тестах в формате ISO_LOCAL_DATE_TIME (например '2011-12-03T10:15:30').``` 
(edited)


Vladimir.M [4:30 PM]
Всем у кого SoapUI не дает ответ на запрос в кодировке UTF-8 - http://automated-testing.info/t/otvet-na-asinhronnyj-zapros-dlya-soapui-v-kodirovke-utf-8/7734. Мне помогло. Плюс поменял шрифт отображения (Preference->Editor Setting->Editor Font) на Arial (edited)
automated-testing.info
Ответ на асинхронный запрос для SoapUI в кодировке UTF-8
Добрый день! Столкнулся на проекте с неприятной штукой. Для тестирования сервисов и написания авто-тестов выбрали SoapUI + HermesJMS (сервисы асинхронные через MQ-очереди). И все было радужно, пока в новой сборке разработчики не приделали новый механизм работы с кодировками. В итоге сообщения приходят в бинарном виде, парсятся, но почему-то не в UTF-8, а в Windows-1251 (в предыдущей версии как раз она использовалась). Причем ответ-то от сервисов вроде как приходит в верном формате, т.е. в UTF-...


Yevhen Maksymovych [Apr 24th at 4:47 PM]
in #hw7
а кто-то сделал кастомный форматтер для локалдейта?


14 replies
aleksey [1 day ago]
Я сделал


Vladimir.M [1 day ago]
:ballot_box_with_check:


Yevhen Maksymovych [1 day ago]
ты делал именно форматтер стринга в локалдейт?
```public class LocalDateCustomFormatter implements Formatter<LocalDate> {```


Vladimir.M [1 day ago]
Я делал через interface Converter<String, LocalDate>


Yevhen Maksymovych [1 day ago]
а как ты конвертил нулл в LocalDate.MIN/MAX?


Vladimir.M [1 day ago]
зачем


Yevhen Maksymovych [1 day ago]
а, всё, туплю, нам достаточно вернуть нулл, если что-то идёт не так, сервис сам разберётся что подставить


Vladimir.M [1 day ago]
у тебя в запросе либо приходит параметр дата/время, либо его нет


aleksey [1 day ago]
Тут уже похоже разобрались :smiley:

Yevhen Maksymovych [1 day ago]
а как этот конвертер теперь зарегить в контексте и нацепить на наше поле?


Yevhen Maksymovych [1 day ago]
conversionService?


aleksey [1 day ago]
Создать соответствующую аннотацию, заимплементить AnnotationFormatterFactory,
в spring-mvc добавить FormattingConversionServiceFactoryBean в котором добавить эти AnnotationFormatterFactory и добавить annotation-driven с этим бином
По крайней мере я так делал (edited)


Vladimir.M [1 day ago]
Да


Vladimir.M [1 day ago]
Также как цепляли JacksonObjectMapper


Alexander Shnaider [Apr 24th at 4:52 PM]
in #hw7
Друзья, подскажите как в MealRestControllerTest проверить что в моделе вся еда присутствует и сравнить её с тем что должно быть.
Я пытался так написать `.andExpect(model().attribute("meals", getWithExceeded(Arrays.asList( MEAL6, MEAL5, MEAL4, MEAL3, MEAL2, MEAL1), DEFAULT_CALORIES_PER_DAY)));` но тест не проходит


7 replies
Yevhen Maksymovych [1 day ago]
я вот так делал:
```mockMvc.perform(get(REST_URL))
                .andExpect(status().isOk())
                .andDo(print())
                .andExpect(contentJson(MealsUtil.getWithExceeded(MEALS, MealsUtil.DEFAULT_CALORIES_PER_DAY)));```


aleksey [1 day ago]
Там если глубже покопать, то сравнение проходит через такой примерно метод
public static boolean nullSafeEquals(@Nullable Object o1, @Nullable Object o2) {
        if (o1 == o2) {
            return true;
        }
        if (o1 == null || o2 == null) {
            return false;
        }
        if (o1.equals(o2)) {
            return true;
        }
        if (o1.getClass().isArray() && o2.getClass().isArray()) {
            return arrayEquals(o1, o2);
        }
        return false;
    }

нас инетресует сравнение вида
if (o1.equals(o2)) {
            return true;
        }
Поскольку у MealWithExceed у нас не переопределено equals, то он будет проверять по ссылке. Так что я переопределил equals в MealWithExeed и все заработало



dustnfox [1 day ago]
@aleksey они про REST говорят. Там приходит не MealWithExceed, а  JSON. Поэтому все ок.

aleksey [1 day ago]
@dustnfox я тоже
скопируй код Alexander Shnaider
и запусти. Посмотри куда идет и почему не работает.


dustnfox [1 day ago]
@aleksey Ах вон ты о чем :slightly_smiling_face: Извини, я не понял. Думал ты Женин код комментируешь. Если так, то да. Прав. Просто эта же история в Root тесте еще.


aleksey [1 day ago]
@dustnfox а тут похоже я не прав, увидел model, подумал что это в Root, а это в Rest. С телефона в транспорте не очень удобно вникать, буду внимательней


Alexander Shnaider [16 hours ago]
aleksey, точно, а я ведь додебажился до этого метода, а про иквалс с хешкодом не догадался, спасибо всем за подсказки


realcorwin [Apr 24th at 5:05 PM]
in #hw7
@Alexander Shnaider
   public void testGetAll() throws Exception {
       mockMvc.perform(get(REST_URL))
               .andExpect(status().isOk())
               .andDo(print())
               .andExpect(content().contentTypeCompatibleWith(MediaType.APPLICATION_JSON))
               .andExpect(contentJson(MEAL6, MEAL5, MEAL4, MEAL3, MEAL2, MEAL1));


2 replies
Yevhen Maksymovych [1 day ago]
но ведь это некорректно. get(REST_URL) тебе вернёт лист миловсэксидами, а ты проверяешь их на сериализацию жсона от мила


Yevhen Maksymovych [1 day ago]
хотя тест почему-то и проходится


qf05 [7:13 PM]
Народ кто сделал в RootControllerTest.testMeals экспект всех элементов?


Alexandr [Apr 24th at 9:04 PM]
in #hw7
Может кто-нибудь подсказать, почему мы в браузере вводим запрос http://localhost:8080/topjava/rest/admin/users? У нас же в контроллере прописано static final String REST_URL = "/rest/admin/users"; Откуда берется /topjava?


3 replies
alexey [1 day ago]
topjava добавляет TomCat


alexey [1 day ago]
когда его настраивали прописывали, что он будет стартовать с http://localhost:8080/topjava


Alexandr [1 day ago]
@alexey спасибо


Yevhen Maksymovych [9:05 PM]
ребята, я сдаюсь, покажите, плз, кто-нибудь, кто смол привязать кастомные форматтеры на датувремя
я уже полдня убил на это, но не выходит каменный цветок
в какую сторону копать вообще не понятно. сделал два форматтера, имплементировав org.springframework.format.Formatter
добавил бин org.springframework.format.support.FormattingConversionServiceFactoryBean в контекст, и добавил ему в список форматтеров эти два моих форматтера
засунул этот бин сюда:
```mvc:annotation-driven conversion-service="conversionService"```


Yevhen Maksymovych [Apr 24th at 9:09 PM]
in #hw7
но мои форматтеры не вызываются при  попытке перегнать из стринга в локалдейт/локалтайм


19 replies
jawinterod [1 day ago]
Над твоей кастомной аннотацией какие аннотации стоят? Которая @interface (edited)


Yevhen Maksymovych [1 day ago]
я не делал кастомную аннотацию, я так понял по условию, нам надо чтобы форматтеры работали не по аннотации, а подтягивались по типу


Yevhen Maksymovych [1 day ago]
там же написано
```Заменить @DateTimeFormat на свои LocalDate/LocalTime конверторы или форматтеры.```


Yevhen Maksymovych [1 day ago]
или имеется в виду, что надо сделать свою аннотацию вместо @DateTimeFormatter какой-нибудь @CustomDateFormatter / @CustomTimeFormatter?


jawinterod [1 day ago]
Ну, я так сделал)


ma1oyby [1 day ago]
https://www.petrikainulainen.net/programming/spring-framework/spring-from-the-trenches-parsing-date-and-time-information-from-a-request-parameter/
Petri Kainulainen
Spring From the Trenches: Parsing Date and Time Information From a Request Parameter
A few days ago I had to write a controller method that is used to upload files to a Spring web application. This is an easy task, but I had another requirement that turned out to be a problem: every file has an expiration date that must be given when the file is uploaded. What went wrong? The Probl…
Sep 28th, 2015 at 12:24 PM
 


ma1oyby [1 day ago]
если правильно понял вопрос


Yevhen Maksymovych [1 day ago]
нет, не то


Yevhen Maksymovych [1 day ago]
я спрашивал, как заставить конфершенфэктори выбирать кастомный конвертер, который мы создали сами, а не как указать нужный шаблон :slightly_smiling_face:


Yevhen Maksymovych [1 day ago]
так-то у меня и без кастомных конвертеров всё корректно отрабатывалось...


Vladimir.M [1 day ago]
Ты сколько форматерров делал? Один на LocalDateTime?


Yevhen Maksymovych [1 day ago]
два, один на LocalDate, второй на LocalTime


Vladimir.M [1 day ago]
А чего пишет в ответ?

Yevhen Maksymovych [1 day ago]
```22:07:55.895 WARN  o.s.w.s.m.support.DefaultHandlerExceptionResolver.handleTypeMismatch:396 - Failed to bind request element: org.springframework.web.method.annotation.MethodArgumentTypeMismatchException: Failed to convert value of type 'java.lang.String' to required type 'java.time.LocalTime'; nested exception is org.springframework.core.convert.ConversionFailedException: Failed to convert from type [java.lang.String] to type [@org.springframework.web.bind.annotation.RequestParam java.time.LocalTime] for value '00:00:00'; nested exception is java.lang.NullPointerException```


Yevhen Maksymovych [1 day ago]
пытается забиндить своими биндерами


Yevhen Maksymovych [1 day ago]
а не моими форматтерами


Vladimir.M [1 day ago]
1. А ты убрал @DateTimeFormat из запроса?
2. Чем ты парсишь строку в форматтере? У нас в DateTimeUtil есть методы...
3. Как ты локализуешь LocalDate/LocalTime (методы print) Смотри в торону java.time.format.DateTimeFormatter...
Я только что сделал свой форматтер (через org.springframework.format.Formatter) все прошло как по маслу
Если не получается лучше реализовать через Converter SPI (https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#core-convert-Converter-API), проще и понятнее.... (edited)


Grigory Kislin [1 day ago]
1. главное- посмотри- попадаешь ли в свой форматтер
2. если да- обрабатываешь ли null начения


Yevhen Maksymovych [1 day ago]
уже разобрался, в мой форматтер попадаю, но потом почему-то спринг прыгает в свой конвертер, и на этом падает эксепшен. исправил форматтеры на конвертеры (хоть это и нелогично, я же из стринга в локалдэйт/локалтайм делаю), после этого прошло, но я так и не понял, как его заставить довольствоваться форматтерами


roma [Apr 24th at 9:31 PM]
in #hw7
у меня вопрос как despetcherServlet отличет методы update, delete, get - ведь у них у всех один и тот же url
```http://localhost:8080/topjava/rest/admin/users/{id}```
и обрабатывает этот запрос (URL) в нужном методе????? (edited)


6 replies
alexey [1 day ago]
у них разные запросы(GET,POST,PUT,DELETE) по ним определяет


roma [1 day ago]
Тоесть их можно оттестить только через SOAPUI? -через адресную строку браузера сервлет не будет понимать что делать?


Yevhen Maksymovych [1 day ago]
да


Yevhen Maksymovych [1 day ago]
через адресную строку ты можешь только стандартный гет отправить


roma [1 day ago]
отлично - спасбио )


Grigory Kislin [1 day ago]
в уроке куча инструментов кроме soapui чем можно послать. curl самый распространенный. зщые можно в html из формы послать
ну и из js можно конечно ajax слать (след. урок) (edited)


CRCx86 [11:22 PM]
Большое спасибо, что никто не ответил. Видимо проблема действительно не решаема(


Alexander_Gubanow [Yesterday at 1:05 AM]
in #hw7
Как задать кодировку UTF-8  в curl команде при отправке json в методе post ?


1 reply
Vladimir.M [1 day ago]
curl -H 'Content-Type:application/json;charset=UTF-8'
https://curl.haxx.se/docs/manpage.html
https://curl.haxx.se/docs/manual.html (edited)


Джони [9:19 AM]
uploaded and commented on this image: image.png 

ребята, привет. после накатки патча столкнулся с исключением. в брузере пишет:
Message An exception occurred processing JSP page [/WEB-INF/jsp/index.jsp] at line [6]
Помогите, кто чем может.

Джони [9:20 AM]
патч 7_06 накатил

Yevhen Maksymovych [9:53 AM]
jstl в помнике подключен?

Grigory Kislin [10:30 AM]
commented on Джони’s file image.png
если в сторонке общий проект склонировать- есть ошибка?

Джони [11:26 AM]
да
Yevhen Maksymovych
jstl в помнике подключен?
Posted in #hw7Yesterday at 9:53 AM

Джони [11:34 AM]
commented on image.png
не совсем понял, что это значит... IDEA подсказывает, что настройки надо поменять. "Edit Hibernate QL Fragment" or "Language Injection Setting" or "Un-inject Language/Reference"

roma [11:37 AM]
Народ не могу осилить метод create ((( при такой реализации
    ```@PostMapping(consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity<Meal> createWithLocation(Meal meal) {
        Meal created = super.create(meal);

//        HttpHeaders httpHeaders = new HttpHeaders();
//        httpHeaders.setLocation(uriOfNewResource);

        URI uriOfNewResource = ServletUriComponentsBuilder.fromCurrentContextPath()
                .path(REST_URL_MEAL + "/{id}")
                .buildAndExpand(created.getId()).toUri();

        return ResponseEntity.created(uriOfNewResource).body(created);
    }```
ругается на меная
```Hibernate: 
    select
        nextval ('global_seq')
11:07:51.621 ERROR org.hibernate.internal.ExceptionMapperStandardImpl.mapManagedFlushFailure:39 - HHH000346: Error during managed flush [Validation failed for classes [ru.javawebinar.topjava.model.Meal] during persist time for groups [javax.validation.groups.Default, ]
List of constraint violations:[
    ConstraintViolationImpl{interpolatedMessage='РЅРµ РјРѕР¶РµС‚ Р±С‹С‚СЊ РїСѓСЃС‚Рѕ', propertyPath=description, rootBeanClass=class ru.javawebinar.topjava.model.Meal, messageTemplate='{javax.validation.constraints.NotBlank.message}'}
    ConstraintViolationImpl{interpolatedMessage='РґРѕР»Р¶РЅРѕ Р±С‹С‚СЊ РјРµР¶РґСѓ 10 Рё 5000', propertyPath=calories, rootBeanClass=class ru.javawebinar.topjava.model.Meal, messageTemplate='{org.hibernate.validator.constraints.Range.message}'}
    ConstraintViolationImpl{interpolatedMessage='РґРѕР»Р¶РЅРѕ Р±С‹С‚СЊ Р·Р°РґР°РЅРѕ', propertyPath=dateTime, rootBeanClass=class ru.javawebinar.topjava.model.Meal, messageTemplate='{javax.validation.constraints.NotNull.message}'}
]]
 11:07:51.623 DEBUG o.s.w.s.handler.AbstractHandlerExceptionResolver.resolveException:137 - Resolving exception from handler [public org.springframework.http.ResponseEntity<ru.javawebinar.topjava.model.Meal> ru.javawebinar.topjava.web.meal.MealRestController.createWithLocation(ru.javawebinar.topjava.model.Meal)]: org.springframework.transaction.TransactionSystemException: Could not commit JPA transaction; nested exception is javax.persistence.RollbackException: Error while committing the transaction```
(edited)

Yevhen Maksymovych [11:40 AM]
укажи, что мил у тебя берётся из реквеста, а то ты пытаешься сохранить ничего
понятно, что тебе констрейнты бд не дадут это сделать

roma [11:41 AM]
оуч )))) упустил анатацию - сейчас перекомпилюсь - отпишусь
@Yevhen Maksymovych Спасибо ))) большое заработало )

Yevhen Maksymovych [11:43 AM]
:+1:


Zhivchik [Yesterday at 11:47 AM]
in #hw7
1.2 ResourceControllerTest для style.css (проверить status и ContentType) - намекните ,что здесь требуется сделать


3 replies
ilya t. [24 hours ago]
сделать наподобие того что ты делал в RootControllerTest (edited)


Zhivchik [24 hours ago]
Нужно еще делать какой то ResourceController?


ilya t. [24 hours ago]
нет, просто добавить класс теста ResourceControllerTest


Джони [3:07 PM]
25-Apr-2018 18:57:40.944 SEVERE [http-nio-8080-exec-1] org.apache.catalina.core.StandardWrapperValve.invoke Servlet.service() for servlet [mvc-dispatcher] in context with path [/topjava] threw exception [An exception occurred processing JSP page [/WEB-INF/jsp/index.jsp] at line [6]

3: <%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
4: 
5: <html>
6: <jsp:include page="fragments/headTag.jsp"/>
7: <body>
8: <jsp:include page="fragments/bodyHeader.jsp"/>
9: <section>

Подскажите пожалуйста, что она от меня хочет...

roma [4:40 PM]
Народ а метод getBetween тоже все параметры должен джейсоном принимать?


Yevhen Maksymovych [Yesterday at 4:41 PM]
in #hw7
нет, принимать должен из реквеста


5 replies
roma [19 hours ago]
@RequestParam ?


roma [19 hours ago]
перед каждым параметром? (edited)


Yevhen Maksymovych [19 hours ago]
ага


roma [19 hours ago]
оки - так и начал делать - но чего то клинануло - "не надо ли это как то в виде джейсона принимать" ) (edited)


Yevhen Maksymovych [19 hours ago]
не, технически ты можешь это принять и из джейсона, если их положить в реквестбади, а не в реквестпарам, разницы особой не будет


Alexander_Gubanow [6:08 PM]
Кто сделал curl для updateMeal  и createMeal? Поделитесь, если не трудно, можно в личку. У меня под windows c cmd  и GitBash не получается отправить json с русскими символами. Вот так работает -d '{"dateTime":"2018-04-24T10:00:00","description":"NewEat","calories":600}', а вот так не работает -d '{"dateTime":"2018-04-24T10:00:00","description":"Новая еда","calories":600}'

Aleksei Kirillov [6:25 PM]
Я вынес json в отдельный файл с utf8 и использовал команду с -d @имя файла

Alexander_Gubanow [7:38 PM]
Да, через файл все работает.Спасибо


Nedfrench [Yesterday at 9:24 PM]
in #hw7
Коллеги, добрый вечер!
Проблема "@ResponseStatus(value = HttpStatus.NO_CONTENT)" уже обсуждалась, но так и не понял, что с этим делать? В тестах добавил, не помогает.


2 replies
Oleksii Leshchenko [14 hours ago]
что значит не помогает?
В контроллере поставили NO_CONTENT, значит статус вернется 204. В тестах проверяли на 200, надо было переправить


Nedfrench [14 hours ago]
Все ж на поверхности. Спасибо, Oleksii Leshchenko.


Vladimir Gorbatenko [10:05 PM]
Накатил все патчи, и локаль отвалилась:  No message found under code 'app.title' for locale 'ru_RU'.
При этом лог исправно пишется, т.е. с переменной TOPJAVA_ROOT все норм

Edgar Zed [8:13 AM]
@Grigory Kislin в JacksonObjectMapper, раздел wiki они видимо на гитхаб перенесли => ссылка http://wiki.fasterxml.com/JacksonHowToCustomSerializers изменилась на https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers

Vladimir Gorbatenko [10:18 AM]
как оказалось и "en" не видит...
Vladimir Gorbatenko
Накатил все патчи, и локаль отвалилась:  No message found under code 'app.title' for locale 'ru_RU'.
При этом лог исправно пишется, т.е. с переменной TOPJAVA_ROOT все норм
Posted in #hw7Yesterday at 10:05 PM


Pavel Klindziuk [2 days ago]
файл spring-mvc.xml :
<property name="basenames" value="file:///#{systemEnvironment['TOPJAVA_ROOT']}/config/messages/app"/>
Проверь - совпадает ли путь к твоим ресурсам с тем, что указал Григорий.
У меня к примеру не совпадает : 
<property name="basenames" value="file:///#{systemEnvironment['TOPJAVA_ROOT']}/topjava/config/messages/app"/>


roma [Apr 26th at 12:53 PM]
in #hw7
Народ а 8 занятие еще не выходило? (edited)


2 replies
realcorwin [2 days ago]
Есть уже


roma [2 days ago]
Спасибо) - ушел туда )


V-E-S-T [4:17 PM]
кто подскажет что могло приключиться - после последнего патча запускаю tomcat и Application Server was not connected before run configuration stop, reason: java.io.IOException: Failed to retrieve RMIServer stub: javax.naming.ServiceUnavailableException [Root exception is java.rmi.ConnectException: Connection refused to host: localhost; nested exception is: java.net.ConnectException: Connection refused: connect]
Error: Exception thrown by the agent : java.rmi.server.ExportException: Port already in use: 1099; nested exception is: 
    java.net.BindException: Address already in use: JVM_Bind

Arthur [4:19 PM]
у тебя прошлый запуск томката до сих пор крутится
томкат погаси

V-E-S-T [4:26 PM]
нет.  не в этом проблема. погасил всё - не помогло.

Arthur [4:27 PM]
он тебе же пишет, что порт занят, значит на нем кто-то сидит
посмотри кто сидит...

V-E-S-T [4:32 PM]
я вижу что пишет. но не вижу чтобы кто то сидел на нём

Valery.Shkerdin [4:36 PM]
@V-E-S-T пробуй netstat -ano, смотри чем занят порт

V-E-S-T [4:36 PM]
его и юзаю

Valery.Shkerdin [4:36 PM]
чисто?
не зянят в смысле ни чем?

V-E-S-T [4:38 PM]
чисто в смысле никто из выданных не занимает 1099

Valery.Shkerdin [4:38 PM]
в таких случаях всегда поступаю как профи, перезагружаюсь )

V-E-S-T [4:40 PM]
)) вариант

Arthur [4:40 PM]
если не поможет, есть более глобальные пути решения :slightly_smiling_face: (edited)

V-E-S-T [4:49 PM]
аллилуя)))) Перезагрузка воистину порой творит чудеса.

Dzmitry Shalukhau [5:13 PM]
Cannot resolve symbol 'con:RestService'. Ошибка в xml. Кто-нибудь встречал???

Grigory Kislin [12 days ago]
судя по ошибке- хрень в xml


Dzmitry Shalukhau [Yesterday at 6:35 PM]
in #hw7
Я на некоторое время выпал из обучения. Решил закончить. Накатил все патчи для lesson7, при запуске получаю:
Caused by: org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set
    at org.hibernate.engine.jdbc.dialect.internal.DialectFactoryImpl.determineDialect(DialectFactoryImpl.java:100)
    at org.hibernate.engine.jdbc.dialect.internal.DialectFactoryImpl.buildDialect(DialectFactoryImpl.java:54)
    at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:137)
    at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:35)
    at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:88)
    at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:259)
    ... 74 common frames omitted


3 replies
Grigory Kislin [17 hours ago]
нет коннекта к базе


Dzmitry Shalukhau [16 hours ago]
Я из консоли с теми же параметрами подключаюсь к базе :disappointed: Со стороны tomcat нужно настравивать pool?


Dzmitry Shalukhau [16 hours ago]
Из консоли стартануть удалось. Так что похоже подключение на стороне standalone tomcat сервера не настроено.


Dzmitry Shalukhau [6:35 PM]
Не может создать em. Возможно я что - то забыл за это время :disappointed:
Возможно я не указал профили для tomcat. Не помню, как это сделать...