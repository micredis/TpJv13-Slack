Grigory Kislin [1:54 AM]
joined #hw6.

Grigory Kislin [1:58 AM]
Готово 6-е занятие:
https://github.com/JavaWebinar/topjava/blob/doc/doc/lesson06.md
Начинаем изучать Spring-MVC и слой Web. 
Занятие и домашнее задание относительно большие, следующее занятие будет в четверг, 19.04 (edited)

Daniil Kulak [2:09 AM]
joined #hw6 along with 18 others.


Хэм [10:15 PM]
у кого не работают тесты? у меня не определяет говорит No qualifying bean of type 'ru.javawebinar.topjava.repository.MealRepository' available: expected single matching bean but found 2: dataJpaMealRepositoryImpl,jpaMealRepositoryImpl
ноэтой ошибки не должно же быть ведь у нас профили теперь все четко я не знаю почему он находит jdbc  он не активен у меня:tired_face:

Jan [10:54 PM]
А как ты запускаешь ? Консоль, ide ?

Хэм [1:54 AM]
через мавен

Tanya [1:55 AM]
пролема не в том, что нет jdbc, а в том находит два dataJpaMealRepositoryImpl, jpaMealRepositoryImpl когда нужен один


Yevhen Maksymovych [Today at 9:09 AM]
in #hw6
у меня одного это занятие вызывает какой-то ступор? до этого всё было просто и последовательно, а теперь мы напихали новых контекстов, хмл, чего-то наподключали, наотключали я дошёл до шестого ролика, и начал понимать, что джава, по всей видимости, не моё


6 replies
dustnfox [4 hours ago]
Ну вот чего ты меня раньше времени пугаешь? Я еще даже до шестого не дошел :disappointed:


Dmitry Neustupov [3 hours ago]
Не переживай - дальше будет её интереснее )


Arthur [3 hours ago]
А в чем ступор то?


Jan [3 hours ago]
https://github.com/google/guice а еще вместо спринга можно вот это использовать )
google/guice
Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.
Website
----------------
https://github.com/google/guice

Watchers
----------------
523

Stars
----------------
6526

Forks
----------------
1022

google/guiceMay 29th, 2014 at 2:18 AM Added by GitHub


Ilya [3 hours ago]
Вызывает ступор, что не очень плавно перешли - на 6-7-8 видосы. Я вот сейчас пересматривать буду - не сращиваю, у нас томкат теперь впилен в проект ? Томкат сам управляет пулом коннектов ? На каждый запрос в браузере будет даваться свой коннект ?


Arthur [2 hours ago]
если я правильно понимаю, в базовой поставке томката этой функциональности нет. Поэтому мы ее прикручиваем сбоку...


Yevhen Maksymovych [9:10 AM]
uploaded this image: image.png 


qf05 [Today at 11:05 AM]
in #hw6
Сейчас вроде разобрался с первыми двумя пунктами дз, на третьем ступор.
1) В каком пакете надо размещать JspMealController? web или meal?
2)От куда надо получать userId ? Из AuthorizedUser.id()?
3)Когда надо использовать @PostMapping, а когда @RequestMapping?
4)Что это вообще такое: RootController#setUser? что за решётка, что она означает ? Или это просто имеется в виду метод сетЮзер или это где то в джсп искать?
Возможно вопросы тупые, но в голове реально каша.

А ещё очень пугает фраза: "Если нет понимания этих основ, двигаться дальше нельзя" начал судорожно перебирать всё что знаю про спринг, но вроде первые два задания сделал быстро и всего по паре строчек кода, хоть и методом научного тыка. Все тесты работают, наверно что то я всё-таки уже знаю и можно двигаться дальше.


4 replies
Oleksii Leshchenko [1 hour ago]
3) Не принципиально что именно использовать. Они взаимозаменяемые


Oleksii Leshchenko [1 hour ago]
4) RootController#setUser - где это? Скорее всего это Spring Expression Language (SpEL)


qf05 [40 minutes ago]
это в дз пункт 1.3.1


Oleksii Leshchenko [37 minutes ago]
ДУмаю # ничего не значит... Могли и через точку написать RootController.setUser


qf05 [Today at 11:14 AM]
in #hw6
И почему то у меня в мавене в плагинах не хочет томкат появляться...


2 replies
Oleksii Leshchenko [2 hours ago]
Он там заменен на cargo plugin...


qf05 [2 hours ago]
спасибо


Ilya [Today at 11:41 AM]
in #hw6
поясните, плз, 
1.что еще за messages? Когда они используются ? 
2. У нас в проекте есть tomcat-servlet-api ? Зачем ? Где используется  ?
3. В чем смысл следующего бина ?
  <beans profile=“tomcat”>
       <jee:jndi-lookup id=“dataSource” jndi-name=“java:comp/env/jdbc/topjava”/>
       <context:property-placeholder location=“classpath:db/tomcat.properties” system-properties-mode=“OVERRIDE”/>
   </beans>


5 replies
Arthur [1 hour ago]
Мэсаджи используются на фронте, для интернализации сообщений. Это встроенный в Spring механизм. Можно его не использовать, тогда тебе ручками придется заниматься интернализацией. (edited)


Arthur [1 hour ago]
По поводу третьего твоего вопроса - если правильно понимаю, в веб серверах JNDI механизм есть в исходной поставке. У нас томкат(это не полноценный веб сервер). У него нет этого механизма. Поэтому мы его прикручиваем ручками.
Если я не прав в свих высказываниях, пусть меня поправят (edited)


Arthur [1 hour ago]
По поводу второго вопроса - помойму Григорий в каком-то видео отвечает на твой вопрос


Ilya [1 hour ago]
@Arthur да, но перебирать все видео сейчас лень) спасибо за ответы!


Oleksii Leshchenko [1 hour ago]
Если не ошибаюсь, то tomcat-servlet-api используем для организации пула коннектов к БД


qf05 [12:03 PM]
return "redirect:meals";
С этим вроде понятно, а как сделать форвард?


qf05 [1:55 PM]
что то с кодировкой не могу справиться, фильтр CharacterEncodingFilter не помогает.

Vitaly M. [6:06 PM]
У меня, после всех патчей вылетает ошибка
```javax.servlet.jsp.JspTagException: No message found under code 'app.title' for locale 'ru_RU'.```


Vitaly M. [Yesterday at 6:09 PM]
in #hw6
я так понимаю, для locale 'ru_RU' у нас app_ru.properties... и spring его не ассоциирует с ru_RU


6 replies
Grigory Kislin [23 hours ago]
скорее всего spring не видит config\messages\app_ru.properties
попробуй захардкодить без переменной окуржения TOPJAVA_ROOT и проверить


Vitaly M. [23 hours ago]
все верно...
не могу вспомнить на каком занятии мы TOPJAVA_ROOT устанавливали, чтоб найти куда проверить как оно у меня в идее прописано


Fedor [6 hours ago]
Получилось решить?


Vitaly M. [4 hours ago]
нет ) просто поставил абсолютный путь и забил пока... тут бы найти время все видео просмотреть и въехать )


Vitaly M. [2 hours ago]
я работаю в линуксе, поэтому я добавил переменную окружения в /etc/environment
Для windows это подробно описано в последнем видео текущего урока.


Fedor [2 hours ago]
Да, я наковырял, спасибо


qf05 [6:37 PM]
подскажите, а фильтр CharacterEncodingFilter надо же в web.xml вставить и всё, дальше оно само должно работать? никак не могу разобраться почему у меня вместо букв знаки вопроса. (edited)


Евгений [Yesterday at 10:08 PM]
in #hw6
Всем привет! Я немного отстал, и пересел за другой комп вдобавок. Как с помощью GIT клонировать ветку master, которая была перед началом занятия 5?


1 reply
Oleksii Leshchenko [19 hours ago]
А твой репозиторий на ГитХабе в каком щас состоянии?


Oleg K [Yesterday at 11:15 PM]
in #hw6
Коллеги, после патча 6_02 при запуске tomcat и переходе на страничку еды вылетает
```org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'ru.javawebinar.topjava.repository.MealRepository' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}```
Тесты проходят. Я криво накатываю патчи, или проблема в ином?


2 replies
Kirilo [17 hours ago]
починка в других патчах. Это же задание optional, здесь мы еще не прикручивали профили в tomcat


Oleg K [5 hours ago]
В самом деле. Спасибо!


Kirilo [1:36 AM]
Накотил три патча. Хотел спросить "почему не работают тесты с профилем postgres?" А после отката в начало, увидел, что в месте, где меняем профиль БД файл не изменялся патчами :slightly_smiling_face: (edited)

Ilya [4:01 AM]
Как это работает ? 
public void testValidation() throws Exception {
       validateRootCause(() -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), ”  “, 300), USER_ID), ConstraintViolationException.class);
   
public <T extends Throwable> void validateRootCause(Runnable runnable, Class<T> exceptionClass) {
       try {
           runnable.run();
           Assert.fail(“Expected ” + exceptionClass.getName());
       } catch (Exception e) {
           Assert.assertThat(getRootCause(e), instanceOf(exceptionClass));
       }
   }

т.е. одним потоком запустили процесс создания мила, а потом в главном потоке сами бросаем эксепшион, который проверяем ?

Tanya [7:53 AM]
создаем еду, если исключение вылетело - тест ок, если нет - то тест fail

vch [7:58 AM]
@Ilya Тут нет нового потока. Runnable (т.е. создание Meal) в данном случае выполняется в том же главном потоке. (edited)


alexey [2:59 PM]
added and commented on this Plain Text snippet: Patch 6_13 
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [Spring/spring-db.xml]: Invocation of init method failed; nested exception is javax.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1710)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:583)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:502)
  at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:312)
  at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:228)
  at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:310)
  at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
  at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1085)
  at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:858)
  at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:549)
  at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:409)
  at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:291)
  at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:103)
  at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4939)
  at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5434)
  at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)
  at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1559)
  at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1549)
  at java.util.concurrent.FutureTask.run(FutureTask.java:266)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  at java.lang.Thread.run(Thread.java:748)
Caused by: javax.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory
  at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.persistenceException(EntityManagerFactoryBuilderImpl.java:970)
  at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:895)
  at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:57)
  at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:365)
  at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:388)
  at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:377)
  at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:341)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1769)
  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1706)
  ... 21 more
Caused by: org.hibernate.cfg.beanvalidation.IntegrationException: Error activating Bean Validation integration
  at org.hibernate.cfg.beanvalidation.BeanValidationIntegrator.integrate(BeanValidationIntegrator.java:138)
  at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:281)
  at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:460)
  at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:892)
  ... 28 more
Caused by: java.lang.NoClassDefFoundError: javax/el/ELManager
  at org.hibernate.validator.messageinterpolation.ResourceBundleMessageInterpolator.buildExpressionFactory(ResourceBundleMessageInterpolator.java:88)
  at org.hibernate.validator.messageinterpolation.ResourceBundleMessageInterpolator.<init>(ResourceBundleMessageInterpolator.java:47)
  at org.hibernate.validator.internal.engine.ConfigurationImpl.getDefaultMessageInterpolator(ConfigurationImpl.java:474)
  at org.hibernate.validator.internal.engine.ConfigurationImpl.getDefaultMessageInterpolatorConfiguredWithClassLoader(ConfigurationImpl.java:650)
  at org.hibernate.validator.internal.engine.ConfigurationImpl.getMessageInterpolator(ConfigurationImpl.java:397)
  at org.hibernate.validator.internal.engine.ValidatorFactoryImpl.<init>(ValidatorFactoryImpl.java:183)
  at org.hibernate.validator.HibernateValidator.buildValidatorFactory(HibernateValidator.java:38)
  at org.hibernate.validator.internal.engine.ConfigurationImpl.buildValidatorFactory(ConfigurationImpl.java:364)
  at javax.validation.Validation.buildDefaultValidatorFactory(Validation.java:103)
  at org.hibernate.cfg.beanvalidation.TypeSafeActivator.getValidatorFactory(TypeSafeActivator.java:501)
  at org.hibernate.cfg.beanvalidation.TypeSafeActivator.activate(TypeSafeActivator.java:84)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:498)
  at org.hibernate.cfg.beanvalidation.BeanValidationIntegrator.integrate(BeanValidationIntegrator.java:132)
  ... 31 more
Caused by: java.lang.ClassNotFoundException: javax.el.ELManager
  at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1702)
  at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1547)
  ... 47 more
Collapse 
У всех Томкат через мавен плагин запускается? У меня вылетает с ошибкой. В чем может быть причина?


Alexander_Gubanow [Yesterday at 3:06 PM]
in #hw6
@Ilya Когда мы в классе сущности указываем аннотации для валидации полей (например @NotNull), Hibernate будет проверять эти поля при сохранении объекта в БД с помощью org.hibernate.cfg.beanvalidation.BeanValidationEventListener. В случае не соответствия указанному критерию он выкидывает ошибку – ConstraintViolationException. Чтобы проверить, что наше приложение работает правильно  - сделали тесты на валидацию вводимых данных. В базовом тестовом классе мы сделали
метод public <T extends Throwable> void validateRootCause(Runnable runnable, Class<T> exceptionClass) {
   try {
       runnable.run();
       Assert.fail("Expected " + exceptionClass.getName());
   } catch (Exception e) {
       Assert.assertThat(getRootCause(e), instanceOf(exceptionClass));
   }
}
В Assert.fail("Expected " +exceptionClass.getName())проверяем, что блок try отработал с ошибкой. В Assert.assertThat(getRootCause(e), instanceOf(exceptionClass)) проверяем, что аргумент getRootCause(e) удовлетворяет условию instanceOf(exceptionClass). В getRootCause(e) мы узнаем первопричину исключения.  Собственно в  тестовом субклассе вызываем validateRootCause() и передаем ему аргументы. Первый аргумент -  () -> service.create(new Meal(null, of(2015, Month.JUNE, 1, 18, 0), "  ", 300) записан в виде лямбда-выражении- реализации интерфейса Runnable "на ходу";
второй аргумент - ConstraintViolationException.class. (edited)



3 replies
EdK [4 hours ago]
Хотел немного поправить, мы запускаем задачу и если исключения не произошло, тогда мы говорим, что тест провален и сообщаем что ждали исключения ( Assert.fail("Expected " +exceptionClass.getName()). Ну а дальше все правильно. Только я так пока и не понял почему у нас в jdbc не выбрасывается исключение.


Ilya [3 hours ago]
@EdK вангую, потому что с jdbc работаем через API спринга, а валидация через хибернейт. Кстати, спасибо за корректировку! А то после первого прочтения в голове что-то не укладывалось.


EdK [3 hours ago]
Да, что нет хибернейта понял когда начал дебажить и увидел что данные добавляются в таблицу с неправильными полями.


Ma3stro [Yesterday at 6:26 PM]
in #hw6
Можно ли в контроллере в аргументах у методов указывать и model, и HttpServletRequest чтобы ловить action'ы и реализовывать функциональность из сервлета?


1 reply
pro [2 hours ago]
https://ru.stackoverflow.com/questions/604088/%D0%90%D0%BD%D0%B0%D0%BB%D0%BE%D0%B3-spring-controller-%D0%B2-java-servlet
ru.stackoverflow.com
Аналог Spring @Controller в Java Servlet
Спринговые контроллеры (@Controller) позволяют обрабатывать множество URL - паттернов. А как быть с сервлетами, один сервлет на один url? Спасибо.
 
 
 
pro [8:50 PM]
да

Vladimir Gorbatenko [11:32 PM]
Да, про сову очень четко. Очень много разорванной информации, не только в HW6, но и ранее. Это как изучать математику, учимся считать 1,2,3 а потом фигак и сразу логарифмы. И ты такой - эй, уважаемый, а где же яйца? Может это я такой непонятливый, хотя спринг и хибернейт ранее сам пытался штудировать, т.е. инфа отчасти знакомая, а все равно достаточно часто не понимаю что требуется сделать. И еще мне так кажется, что видео пора обновить, с 2014 года в проекте было сделано не мало изменений, например в тех же именах классов, иногда просто запутывает. Это не претензии. Информации действительно много. Но возможно так и надо кормить информацией... (edited)

saudabaew [7:03 AM]
uploaded and commented on this image: image.png 

При накате первого патча вышло предупреждение, что означает?

Yevhen Maksymovych [7:28 AM]
не по-русски написано, но вроде кто-то пропустил три хука слева


saudabaew [Today at 7:46 AM]
in #hw6
ну да, это я перевел) но что это значит?)


3 replies
alexey [3 hours ago]
это значит что твой мастер отличается от мастера григория (т.е. мастер после патча 5_8) и эти 3 куска кода не будут добавлены в твою версию. откатывайся на 5_8 и ищи отличия


saudabaew [2 hours ago]
а, понял в чем ошибка. спасибо большое!


pro [2 hours ago]
я бы просто сделал ctrl+prtScr этого диффа и добавил бы затем эти фрагменты вручную))


saudabaew [7:46 AM]
просто первый раз такое


alexey [Today at 8:47 AM]
in #hw6
кто дошел до установки патча 6_13?


2 replies
Yevhen Maksymovych [2 hours ago]
я только что поставил


alexey [1 hour ago]
TomCat как у тебя запускается? Из плагина запускается или только из командной


VadimSimonov [Today at 10:04 AM]
in #hw6
народ подскажите комнату обсуждения выпускного проекта


1 reply
Oleksii Leshchenko [1 hour ago]
#graduation


qf05 [1:09 PM]
Подскажите, где я что пропустил. Томкат из плагина не запускается, пишет:
Failed to execute goal org.codehaus.cargo:cargo-maven2-plugin:1.6.7:run (default-cli) on project topjava: Execution default-cli of goal org.codehaus.cargo:cargo-maven2-plugin:1.6.7:run failed: Failed to create deployable with implementation class org.codehaus.cargo.container.tomcat.TomcatWAR for the parameters (container [id = [tomcat8x]], deployable type [war]). InvocationTargetException: Failed to parse Tomcat WAR file in [C:\Project\qf05\topjava\target\topjava.war]: Failed to find file [C:\Project\qf05\topjava\target\topjava.war]: C:\Project\qf05\topjava\target\topjava.war (Не удается найти указанный файл) -> [Help 1]